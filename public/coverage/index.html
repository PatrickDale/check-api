<!DOCTYPE html>
<html xmlns='http://www.w3.org/1999/xhtml'>
  <head>
    <title>Code coverage for Checkdesk</title>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <script src='./assets/0.10.0/application.js' type='text/javascript'></script>    
    <link href='./assets/0.10.0/application.css' media='screen, projection, print' rel='stylesheet' type='text/css'>
    <link rel="shortcut icon" type="image/png" href="./assets/0.10.0/favicon_green.png" />
    <link rel="icon" type="image/png" href="./assets/0.10.0/favicon.png" />
  </head>
  
  <body>
    <div id="loading">
      <img src="./assets/0.10.0/loading.gif" alt="loading"/>
    </div>
    <div id="wrapper" style="display:none;">
      <div class="timestamp">Generated <abbr class="timeago" title="2016-11-14T17:51:47-03:00">2016-11-14T17:51:47-03:00</abbr></div>
      <ul class="group_tabs"></ul>

      <div id="content">
        <div class="file_list_container" id="AllFiles">
  <h2>
    <span class="group_name">All Files</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         208.75
       </span>
    </span> hits/line)
  </h2>
  <a name="AllFiles"></a>
  <div>
    <b>86</b> files in total.
    <b>2433</b> relevant lines. 
    <span class="green"><b>2433</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#835734272587eb23e8c421c504b48ea68e9c4e07" class="src_link" title="app/controllers/api/v1/base_api_controller.rb">app/controllers/api/v1/base_api_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>103</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>116.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d59a06f23186d68cc46c3ce58aa84fd8f4c04e1b" class="src_link" title="app/controllers/api/v1/graphql_controller.rb">app/controllers/api/v1/graphql_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>59</td>
        <td>39</td>
        <td>39</td>
        <td>0</td>
        <td>47.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d291f45d1b7194643ee7554141d0c00417754fce" class="src_link" title="app/controllers/api/v1/omniauth_callbacks_controller.rb">app/controllers/api/v1/omniauth_callbacks_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>44</td>
        <td>26</td>
        <td>26</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f142a2021f202ff9ef87c020194f1caf5e42a38d" class="src_link" title="app/controllers/api/v1/registrations_controller.rb">app/controllers/api/v1/registrations_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>59</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f755bbd5fc61f8d733b36cc8b3af8370ffcdc27b" class="src_link" title="app/controllers/api/v1/sessions_controller.rb">app/controllers/api/v1/sessions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>27</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2906d077ba5da67c22dd9057a51ac7ecfeb7625b" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>5.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5dcb6471c5c9d242564d37e9e38f385e763a3de" class="src_link" title="app/controllers/concerns/facebook_authentication.rb">app/controllers/concerns/facebook_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a063c46ffa728a4cd14e6cbf2a94f697a9451b0d" class="src_link" title="app/controllers/concerns/slack_authentication.rb">app/controllers/concerns/slack_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0961319bf3b08d566dde6ef2ccd4c66adfb870fb" class="src_link" title="app/controllers/concerns/twitter_authentication.rb">app/controllers/concerns/twitter_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4b5b05532bb76e1f8a27101a38f38cb3fb5ed1ad" class="src_link" title="app/graph/mutations/account_mutations.rb">app/graph/mutations/account_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c9d2daf3d3d3427933d836a24c4a07a6a2ebe304" class="src_link" title="app/graph/mutations/annotation_mutations.rb">app/graph/mutations/annotation_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adcd36f9afd4f01986562b5da8a458f1a06792fc" class="src_link" title="app/graph/mutations/comment_mutations.rb">app/graph/mutations/comment_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#867bf36dbca0ced5757888b13044c6368c8bbb33" class="src_link" title="app/graph/mutations/contact_mutations.rb">app/graph/mutations/contact_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#700cbb923ed40814b7040fdf980a6af01b7af6ff" class="src_link" title="app/graph/mutations/flag_mutations.rb">app/graph/mutations/flag_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#96de21b8afb70e6133f7879766dc8c84fdbc2f3e" class="src_link" title="app/graph/mutations/graphql_crud_operations.rb">app/graph/mutations/graphql_crud_operations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>221</td>
        <td>117</td>
        <td>117</td>
        <td>0</td>
        <td>14.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2172bb46f7629bb8d7293dab0e686809ef0c4170" class="src_link" title="app/graph/mutations/media_mutations.rb">app/graph/mutations/media_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ce5fcd49b988c930dafc4d50bfd5c5128629b500" class="src_link" title="app/graph/mutations/project_mutations.rb">app/graph/mutations/project_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3cb309f131912a9e2db0a0435c4546f8c853a35c" class="src_link" title="app/graph/mutations/project_source_mutations.rb">app/graph/mutations/project_source_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#916f05c16c3aef1c889acdc4754b1b88056806f3" class="src_link" title="app/graph/mutations/source_mutations.rb">app/graph/mutations/source_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ec9b89efb05aa823f9c24a3e03b92b86135e2ac1" class="src_link" title="app/graph/mutations/status_mutations.rb">app/graph/mutations/status_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99f56c1da02fbac6f211e7015dce938ba9392e37" class="src_link" title="app/graph/mutations/tag_mutations.rb">app/graph/mutations/tag_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a758daef557c63a5a152f76cf9dbb6c8ad02bc44" class="src_link" title="app/graph/mutations/team_mutations.rb">app/graph/mutations/team_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e878aacdc5463815014d0fb07124735fc913e023" class="src_link" title="app/graph/mutations/team_user_mutations.rb">app/graph/mutations/team_user_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bddf1c2e730fc3301571be699b03bd95c3416f20" class="src_link" title="app/graph/mutations/user_mutations.rb">app/graph/mutations/user_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cb7d76f03f258c9f6f329fc795488b9ae0121229" class="src_link" title="app/graph/types/about_type.rb">app/graph/types/about_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3cf2dff043f627e34e84debf16cf760c459ddc70" class="src_link" title="app/graph/types/account_type.rb">app/graph/types/account_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d51021f72c7882c21602e0b1a0544f7115eb4276" class="src_link" title="app/graph/types/annotation_type.rb">app/graph/types/annotation_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c575a7bfc80c31049ccf931ffbf9b7bda66bf0b3" class="src_link" title="app/graph/types/annotator_type.rb">app/graph/types/annotator_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#438c1053b08ae9b7495b9994385a7d5489721ca8" class="src_link" title="app/graph/types/check_search_type.rb">app/graph/types/check_search_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6b68cce524f402b4a5ab2dd25bcb5e19da95fb8" class="src_link" title="app/graph/types/comment_type.rb">app/graph/types/comment_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c3ade8b3034a3a59d931749acce28880ca9c8734" class="src_link" title="app/graph/types/contact_type.rb">app/graph/types/contact_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b92e46ac87cc605fab93a1fe9accee104c1ecce9" class="src_link" title="app/graph/types/flag_type.rb">app/graph/types/flag_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b7244b04417d56e9b6e07635d834c9822afd6a75" class="src_link" title="app/graph/types/media_type.rb">app/graph/types/media_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>85</td>
        <td>50</td>
        <td>50</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e104aae766e58875c50510a807998bbfe9b42cae" class="src_link" title="app/graph/types/mutation_type.rb">app/graph/types/mutation_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#604f784573d5865c3f5bd4209fecfff53522d215" class="src_link" title="app/graph/types/node_identification.rb">app/graph/types/node_identification.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ab31674541ee49a9e1a59f66f149713500a0a457" class="src_link" title="app/graph/types/project_source_type.rb">app/graph/types/project_source_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0e19c9d6575c6772e3656db8913702a9c79e37f0" class="src_link" title="app/graph/types/project_type.rb">app/graph/types/project_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>41</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2fab1d8471ae3c69b6e67d8958b85b6d089740be" class="src_link" title="app/graph/types/public_team_type.rb">app/graph/types/public_team_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6ab47c22f73b1afb97f11e3b1a5eb5bc02e94b44" class="src_link" title="app/graph/types/query_type.rb">app/graph/types/query_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>67</td>
        <td>67</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#113a2258848ab5962e09ea18193f8737391a13e4" class="src_link" title="app/graph/types/root_level_type.rb">app/graph/types/root_level_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>73</td>
        <td>44</td>
        <td>44</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6caf93d3a3eff846209e8a82789b0e4e9c977e7b" class="src_link" title="app/graph/types/source_type.rb">app/graph/types/source_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5298730e0c53991c119cccb759f056e59b30872e" class="src_link" title="app/graph/types/status_type.rb">app/graph/types/status_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5c144664968dfc0ede325f1e378e8edcfe4e489b" class="src_link" title="app/graph/types/tag_type.rb">app/graph/types/tag_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#86263f6d83626f26d603930d03c5f31eecb85a15" class="src_link" title="app/graph/types/team_type.rb">app/graph/types/team_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>40</td>
        <td>40</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#59c3a54231ff82d5ce330be616008a1fee99b180" class="src_link" title="app/graph/types/team_user_type.rb">app/graph/types/team_user_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a87618d4cd26e612873db0edeb2c9bdcc113592b" class="src_link" title="app/graph/types/user_type.rb">app/graph/types/user_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#83e8e14d76ec514f749d39d08cfad3e9c717425a" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e3cf83716d4f1fb6b4cf6d1338e7407c9c9991fc" class="src_link" title="app/mailers/registration_mailer.rb">app/mailers/registration_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d6836e973872adbe02b9daf3f095f2b820310453" class="src_link" title="app/mailers/team_user_mailer.rb">app/mailers/team_user_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>112.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1589d90639abc68633ccbc5c9693315bc2d870ad" class="src_link" title="app/models/ability.rb">app/models/ability.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>175</td>
        <td>108</td>
        <td>108</td>
        <td>0</td>
        <td>174.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d4a3209be737d9cf4863ca6d425dbaa916d3a4db" class="src_link" title="app/models/account.rb">app/models/account.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>69</td>
        <td>44</td>
        <td>44</td>
        <td>0</td>
        <td>46.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a56f1204bc7b1a193ada502b921f73e62eeaf24d" class="src_link" title="app/models/annotations/annotation.rb">app/models/annotations/annotation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>181.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d8958341f9603d50b8237a72f4019672ef7cc0a8" class="src_link" title="app/models/annotations/comment.rb">app/models/annotations/comment.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>60</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>44.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8112d3e9da628f597358c46561ad5c73cb4fa314" class="src_link" title="app/models/annotations/embed.rb">app/models/annotations/embed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>100.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#57496f9a6466dcc2909442d03bb0aa9eabb77f4c" class="src_link" title="app/models/annotations/flag.rb">app/models/annotations/flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc5a30c5a70cc0e37030606b7f0bea9119d8a4af" class="src_link" title="app/models/annotations/status.rb">app/models/annotations/status.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>91</td>
        <td>53</td>
        <td>53</td>
        <td>0</td>
        <td>229.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f5cadf1f2c0488fee9307824c1ab4f84fe7e5068" class="src_link" title="app/models/annotations/tag.rb">app/models/annotations/tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>15.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#12f3a743395a5763d8cff3db7fe8339e32e240e0" class="src_link" title="app/models/api_key.rb">app/models/api_key.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>29</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>3.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7f985d79dadc651cdebf7e9693a510a08b984513" class="src_link" title="app/models/bot.rb">app/models/bot.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bbcb987bb5d3b5ee1044844318eb3ce9b7b976a8" class="src_link" title="app/models/concerns/annotation_base.rb">app/models/concerns/annotation_base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>376</td>
        <td>217</td>
        <td>217</td>
        <td>0</td>
        <td>934.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eb028b454ca60e1573e195f1829ec036a6b81af3" class="src_link" title="app/models/concerns/checkdesk_elastic_search_model.rb">app/models/concerns/checkdesk_elastic_search_model.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>323.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#32b95d772fe6b3f9e9dcee786fcbe617a74e4396" class="src_link" title="app/models/concerns/media_information.rb">app/models/concerns/media_information.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>82</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>92.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad8104e28d4e9063e838ea863f42803874b249eb" class="src_link" title="app/models/contact.rb">app/models/contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#95dd7eb1bf720832205d2878edbfa6d329fd7900" class="src_link" title="app/models/media.rb">app/models/media.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>198</td>
        <td>128</td>
        <td>128</td>
        <td>0</td>
        <td>104.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2ff7b80c00a5ff7cf5f01a879f83114dd3dd19cf" class="src_link" title="app/models/project.rb">app/models/project.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>86</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>260.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0a7be7c0297d29217017a8fe3b4027cb126debd0" class="src_link" title="app/models/project_media.rb">app/models/project_media.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>78.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28c562ab4f62fc6de3885f6bdc4454bb9efa42c9" class="src_link" title="app/models/project_source.rb">app/models/project_source.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>11.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#942b3b7a41e308986ea96418186940f10e0403c7" class="src_link" title="app/models/root_level.rb">app/models/root_level.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0f854e7758b6b180753f93614b80fb9442eb5ba1" class="src_link" title="app/models/source.rb">app/models/source.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>52</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>5.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c3b580a8e85fe2ecc67a93da50f020707d6b2ac" class="src_link" title="app/models/team.rb">app/models/team.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>164</td>
        <td>97</td>
        <td>97</td>
        <td>0</td>
        <td>154.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53de79526c85ee9e7f09fb0bca9ad269824b0e4a" class="src_link" title="app/models/team_user.rb">app/models/team_user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>69</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>50.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b0537800926380b7cdf65d6d3ffdafb22f58f28c" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>200</td>
        <td>113</td>
        <td>113</td>
        <td>0</td>
        <td>519.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e7ae00f2fff863f10826ae9cac50e31e7031020e" class="src_link" title="app/uploaders/image_uploader.rb">app/uploaders/image_uploader.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>23</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>825.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f3b23561a9fcf2345abfa09b39f63d04c3d61fd4" class="src_link" title="lib/api_constraints.rb">lib/api_constraints.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>167.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#31f9451ecbc63c7a488abf4fc5cd289b19926677" class="src_link" title="lib/check_search.rb">lib/check_search.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>261</td>
        <td>148</td>
        <td>148</td>
        <td>0</td>
        <td>46.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7eb2c6f064613e949685ee0e7007136ca797bf6b" class="src_link" title="lib/checkdesk_notifications/pusher.rb">lib/checkdesk_notifications/pusher.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>679.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a9bb98762266d03027e7aa1d80cac7f2981b8ad2" class="src_link" title="lib/checkdesk_notifications/slack.rb">lib/checkdesk_notifications/slack.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>87</td>
        <td>46</td>
        <td>46</td>
        <td>0</td>
        <td>207.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3576ac61feea84965940cf4a5fe49e3434da3509" class="src_link" title="lib/checkdesk_permissions.rb">lib/checkdesk_permissions.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>112</td>
        <td>65</td>
        <td>65</td>
        <td>0</td>
        <td>338.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94205aaea0069904f3ccc0d3f0b5cdfc53f3fa28" class="src_link" title="lib/checkdesk_settings.rb">lib/checkdesk_settings.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1676.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#debf438822ec05ab1cfa495e0a9ad2ba633736af" class="src_link" title="lib/elasticsearch_relation.rb">lib/elasticsearch_relation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>189.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5df55892d31f2442e9ab62a4f1675fb46e807bf6" class="src_link" title="lib/error_codes.rb">lib/error_codes.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a75ad0f04f8e207e652252e25bb23901ca19da3c" class="src_link" title="lib/included_validator.rb">lib/included_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>150.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c8de647c1f40167ae57f62658c920c14da08f39d" class="src_link" title="lib/lapis_webhook.rb">lib/lapis_webhook.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#582157495b5e8c8d9770329f955152ad9285292a" class="src_link" title="lib/pender_data.rb">lib/pender_data.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>580.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1aa5c011ec09e9aa836d38fafb63758aeb8c32f0" class="src_link" title="lib/size_validator.rb">lib/size_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1408.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9cd5dfed828d46b47f5dd444b1e7a4eae80aa3ed" class="src_link" title="lib/uniqueness_validator.rb">lib/uniqueness_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>65.6</td>
      </tr>
      
    </tbody>
  </table>
</div>


        
          <div class="file_list_container" id="Controllers">
  <h2>
    <span class="group_name">Controllers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         45.95
       </span>
    </span> hits/line)
  </h2>
  <a name="Controllers"></a>
  <div>
    <b>9</b> files in total.
    <b>195</b> relevant lines. 
    <span class="green"><b>195</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#835734272587eb23e8c421c504b48ea68e9c4e07" class="src_link" title="app/controllers/api/v1/base_api_controller.rb">app/controllers/api/v1/base_api_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>103</td>
        <td>58</td>
        <td>58</td>
        <td>0</td>
        <td>116.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d59a06f23186d68cc46c3ce58aa84fd8f4c04e1b" class="src_link" title="app/controllers/api/v1/graphql_controller.rb">app/controllers/api/v1/graphql_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>59</td>
        <td>39</td>
        <td>39</td>
        <td>0</td>
        <td>47.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d291f45d1b7194643ee7554141d0c00417754fce" class="src_link" title="app/controllers/api/v1/omniauth_callbacks_controller.rb">app/controllers/api/v1/omniauth_callbacks_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>44</td>
        <td>26</td>
        <td>26</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f142a2021f202ff9ef87c020194f1caf5e42a38d" class="src_link" title="app/controllers/api/v1/registrations_controller.rb">app/controllers/api/v1/registrations_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>59</td>
        <td>32</td>
        <td>32</td>
        <td>0</td>
        <td>2.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f755bbd5fc61f8d733b36cc8b3af8370ffcdc27b" class="src_link" title="app/controllers/api/v1/sessions_controller.rb">app/controllers/api/v1/sessions_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>27</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2906d077ba5da67c22dd9057a51ac7ecfeb7625b" class="src_link" title="app/controllers/application_controller.rb">app/controllers/application_controller.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>13</td>
        <td>13</td>
        <td>0</td>
        <td>5.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d5dcb6471c5c9d242564d37e9e38f385e763a3de" class="src_link" title="app/controllers/concerns/facebook_authentication.rb">app/controllers/concerns/facebook_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a063c46ffa728a4cd14e6cbf2a94f697a9451b0d" class="src_link" title="app/controllers/concerns/slack_authentication.rb">app/controllers/concerns/slack_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0961319bf3b08d566dde6ef2ccd4c66adfb870fb" class="src_link" title="app/controllers/concerns/twitter_authentication.rb">app/controllers/concerns/twitter_authentication.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.8</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Models">
  <h2>
    <span class="group_name">Models</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         317.88
       </span>
    </span> hits/line)
  </h2>
  <a name="Models"></a>
  <div>
    <b>23</b> files in total.
    <b>1132</b> relevant lines. 
    <span class="green"><b>1132</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#1589d90639abc68633ccbc5c9693315bc2d870ad" class="src_link" title="app/models/ability.rb">app/models/ability.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>175</td>
        <td>108</td>
        <td>108</td>
        <td>0</td>
        <td>174.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d4a3209be737d9cf4863ca6d425dbaa916d3a4db" class="src_link" title="app/models/account.rb">app/models/account.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>69</td>
        <td>44</td>
        <td>44</td>
        <td>0</td>
        <td>46.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a56f1204bc7b1a193ada502b921f73e62eeaf24d" class="src_link" title="app/models/annotations/annotation.rb">app/models/annotations/annotation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>19</td>
        <td>10</td>
        <td>10</td>
        <td>0</td>
        <td>181.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d8958341f9603d50b8237a72f4019672ef7cc0a8" class="src_link" title="app/models/annotations/comment.rb">app/models/annotations/comment.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>60</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>44.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#8112d3e9da628f597358c46561ad5c73cb4fa314" class="src_link" title="app/models/annotations/embed.rb">app/models/annotations/embed.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>100.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#57496f9a6466dcc2909442d03bb0aa9eabb77f4c" class="src_link" title="app/models/annotations/flag.rb">app/models/annotations/flag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#fc5a30c5a70cc0e37030606b7f0bea9119d8a4af" class="src_link" title="app/models/annotations/status.rb">app/models/annotations/status.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>91</td>
        <td>53</td>
        <td>53</td>
        <td>0</td>
        <td>229.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#f5cadf1f2c0488fee9307824c1ab4f84fe7e5068" class="src_link" title="app/models/annotations/tag.rb">app/models/annotations/tag.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>19</td>
        <td>19</td>
        <td>0</td>
        <td>15.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#12f3a743395a5763d8cff3db7fe8339e32e240e0" class="src_link" title="app/models/api_key.rb">app/models/api_key.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>29</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>3.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7f985d79dadc651cdebf7e9693a510a08b984513" class="src_link" title="app/models/bot.rb">app/models/bot.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bbcb987bb5d3b5ee1044844318eb3ce9b7b976a8" class="src_link" title="app/models/concerns/annotation_base.rb">app/models/concerns/annotation_base.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>376</td>
        <td>217</td>
        <td>217</td>
        <td>0</td>
        <td>934.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#eb028b454ca60e1573e195f1829ec036a6b81af3" class="src_link" title="app/models/concerns/checkdesk_elastic_search_model.rb">app/models/concerns/checkdesk_elastic_search_model.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>323.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#32b95d772fe6b3f9e9dcee786fcbe617a74e4396" class="src_link" title="app/models/concerns/media_information.rb">app/models/concerns/media_information.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>82</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>92.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ad8104e28d4e9063e838ea863f42803874b249eb" class="src_link" title="app/models/contact.rb">app/models/contact.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#95dd7eb1bf720832205d2878edbfa6d329fd7900" class="src_link" title="app/models/media.rb">app/models/media.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>198</td>
        <td>128</td>
        <td>128</td>
        <td>0</td>
        <td>104.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2ff7b80c00a5ff7cf5f01a879f83114dd3dd19cf" class="src_link" title="app/models/project.rb">app/models/project.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>86</td>
        <td>49</td>
        <td>49</td>
        <td>0</td>
        <td>260.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0a7be7c0297d29217017a8fe3b4027cb126debd0" class="src_link" title="app/models/project_media.rb">app/models/project_media.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>78.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#28c562ab4f62fc6de3885f6bdc4454bb9efa42c9" class="src_link" title="app/models/project_source.rb">app/models/project_source.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>11</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>11.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#942b3b7a41e308986ea96418186940f10e0403c7" class="src_link" title="app/models/root_level.rb">app/models/root_level.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>7</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0f854e7758b6b180753f93614b80fb9442eb5ba1" class="src_link" title="app/models/source.rb">app/models/source.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>52</td>
        <td>31</td>
        <td>31</td>
        <td>0</td>
        <td>5.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#4c3b580a8e85fe2ecc67a93da50f020707d6b2ac" class="src_link" title="app/models/team.rb">app/models/team.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>164</td>
        <td>97</td>
        <td>97</td>
        <td>0</td>
        <td>154.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#53de79526c85ee9e7f09fb0bca9ad269824b0e4a" class="src_link" title="app/models/team_user.rb">app/models/team_user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>69</td>
        <td>36</td>
        <td>36</td>
        <td>0</td>
        <td>50.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b0537800926380b7cdf65d6d3ffdafb22f58f28c" class="src_link" title="app/models/user.rb">app/models/user.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>200</td>
        <td>113</td>
        <td>113</td>
        <td>0</td>
        <td>519.0</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Mailers">
  <h2>
    <span class="group_name">Mailers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         82.04
       </span>
    </span> hits/line)
  </h2>
  <a name="Mailers"></a>
  <div>
    <b>3</b> files in total.
    <b>33</b> relevant lines. 
    <span class="green"><b>33</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#83e8e14d76ec514f749d39d08cfad3e9c717425a" class="src_link" title="app/mailers/application_mailer.rb">app/mailers/application_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>4</td>
        <td>3</td>
        <td>3</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e3cf83716d4f1fb6b4cf6d1338e7407c9c9991fc" class="src_link" title="app/mailers/registration_mailer.rb">app/mailers/registration_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.5</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d6836e973872adbe02b9daf3f095f2b820310453" class="src_link" title="app/mailers/team_user_mailer.rb">app/mailers/team_user_mailer.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>35</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>112.3</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Helpers">
  <h2>
    <span class="group_name">Helpers</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Helpers"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Jobs">
  <h2>
    <span class="group_name">Jobs</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="red">
         0.0
       </span>
    </span> hits/line)
  </h2>
  <a name="Jobs"></a>
  <div>
    <b>0</b> files in total.
    <b>0.0</b> relevant lines. 
    <span class="green"><b>0.0</b> lines covered</span> and
    <span class="red"><b>0.0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Libraries">
  <h2>
    <span class="group_name">Libraries</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         302.42
       </span>
    </span> hits/line)
  </h2>
  <a name="Libraries"></a>
  <div>
    <b>13</b> files in total.
    <b>417</b> relevant lines. 
    <span class="green"><b>417</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#f3b23561a9fcf2345abfa09b39f63d04c3d61fd4" class="src_link" title="lib/api_constraints.rb">lib/api_constraints.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>8</td>
        <td>8</td>
        <td>0</td>
        <td>167.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#31f9451ecbc63c7a488abf4fc5cd289b19926677" class="src_link" title="lib/check_search.rb">lib/check_search.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>261</td>
        <td>148</td>
        <td>148</td>
        <td>0</td>
        <td>46.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#7eb2c6f064613e949685ee0e7007136ca797bf6b" class="src_link" title="lib/checkdesk_notifications/pusher.rb">lib/checkdesk_notifications/pusher.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>78</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>679.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a9bb98762266d03027e7aa1d80cac7f2981b8ad2" class="src_link" title="lib/checkdesk_notifications/slack.rb">lib/checkdesk_notifications/slack.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>87</td>
        <td>46</td>
        <td>46</td>
        <td>0</td>
        <td>207.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3576ac61feea84965940cf4a5fe49e3434da3509" class="src_link" title="lib/checkdesk_permissions.rb">lib/checkdesk_permissions.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>112</td>
        <td>65</td>
        <td>65</td>
        <td>0</td>
        <td>338.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#94205aaea0069904f3ccc0d3f0b5cdfc53f3fa28" class="src_link" title="lib/checkdesk_settings.rb">lib/checkdesk_settings.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>34</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1676.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#debf438822ec05ab1cfa495e0a9ad2ba633736af" class="src_link" title="lib/elasticsearch_relation.rb">lib/elasticsearch_relation.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>28</td>
        <td>15</td>
        <td>15</td>
        <td>0</td>
        <td>189.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5df55892d31f2442e9ab62a4f1675fb46e807bf6" class="src_link" title="lib/error_codes.rb">lib/error_codes.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>12</td>
        <td>12</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a75ad0f04f8e207e652252e25bb23901ca19da3c" class="src_link" title="lib/included_validator.rb">lib/included_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>8</td>
        <td>5</td>
        <td>5</td>
        <td>0</td>
        <td>150.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c8de647c1f40167ae57f62658c920c14da08f39d" class="src_link" title="lib/lapis_webhook.rb">lib/lapis_webhook.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>17</td>
        <td>17</td>
        <td>0</td>
        <td>1.3</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#582157495b5e8c8d9770329f955152ad9285292a" class="src_link" title="lib/pender_data.rb">lib/pender_data.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>23</td>
        <td>23</td>
        <td>0</td>
        <td>580.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#1aa5c011ec09e9aa836d38fafb63758aeb8c32f0" class="src_link" title="lib/size_validator.rb">lib/size_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1408.9</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#9cd5dfed828d46b47f5dd444b1e7a4eae80aa3ed" class="src_link" title="lib/uniqueness_validator.rb">lib/uniqueness_validator.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>15</td>
        <td>11</td>
        <td>11</td>
        <td>0</td>
        <td>65.6</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
          <div class="file_list_container" id="Ungrouped">
  <h2>
    <span class="group_name">Ungrouped</span>
    (<span class="covered_percent"><span class="green">100.0%</span></span>
     covered at
     <span class="covered_strength">
       <span class="green">
         15.65
       </span>
    </span> hits/line)
  </h2>
  <a name="Ungrouped"></a>
  <div>
    <b>38</b> files in total.
    <b>656</b> relevant lines. 
    <span class="green"><b>656</b> lines covered</span> and
    <span class="red"><b>0</b> lines missed </span>
  </div>
  <table class="file_list">
    <thead>
      <tr>
        <th>File</th>
        <th>% covered</th>
        <th>Lines</th>
        <th>Relevant Lines</th>
        <th>Lines covered</th>
        <th>Lines missed</th>
        <th>Avg. Hits / Line</th>
      </tr>
    </thead>
    <tbody>
      
      <tr>
        <td class="strong"><a href="#4b5b05532bb76e1f8a27101a38f38cb3fb5ed1ad" class="src_link" title="app/graph/mutations/account_mutations.rb">app/graph/mutations/account_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>16</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c9d2daf3d3d3427933d836a24c4a07a6a2ebe304" class="src_link" title="app/graph/mutations/annotation_mutations.rb">app/graph/mutations/annotation_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>22</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#adcd36f9afd4f01986562b5da8a458f1a06792fc" class="src_link" title="app/graph/mutations/comment_mutations.rb">app/graph/mutations/comment_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#867bf36dbca0ced5757888b13044c6368c8bbb33" class="src_link" title="app/graph/mutations/contact_mutations.rb">app/graph/mutations/contact_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#700cbb923ed40814b7040fdf980a6af01b7af6ff" class="src_link" title="app/graph/mutations/flag_mutations.rb">app/graph/mutations/flag_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#96de21b8afb70e6133f7879766dc8c84fdbc2f3e" class="src_link" title="app/graph/mutations/graphql_crud_operations.rb">app/graph/mutations/graphql_crud_operations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>221</td>
        <td>117</td>
        <td>117</td>
        <td>0</td>
        <td>14.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2172bb46f7629bb8d7293dab0e686809ef0c4170" class="src_link" title="app/graph/mutations/media_mutations.rb">app/graph/mutations/media_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ce5fcd49b988c930dafc4d50bfd5c5128629b500" class="src_link" title="app/graph/mutations/project_mutations.rb">app/graph/mutations/project_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3cb309f131912a9e2db0a0435c4546f8c853a35c" class="src_link" title="app/graph/mutations/project_source_mutations.rb">app/graph/mutations/project_source_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>14</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#916f05c16c3aef1c889acdc4754b1b88056806f3" class="src_link" title="app/graph/mutations/source_mutations.rb">app/graph/mutations/source_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ec9b89efb05aa823f9c24a3e03b92b86135e2ac1" class="src_link" title="app/graph/mutations/status_mutations.rb">app/graph/mutations/status_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#99f56c1da02fbac6f211e7015dce938ba9392e37" class="src_link" title="app/graph/mutations/tag_mutations.rb">app/graph/mutations/tag_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>20</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a758daef557c63a5a152f76cf9dbb6c8ad02bc44" class="src_link" title="app/graph/mutations/team_mutations.rb">app/graph/mutations/team_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>26</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e878aacdc5463815014d0fb07124735fc913e023" class="src_link" title="app/graph/mutations/team_user_mutations.rb">app/graph/mutations/team_user_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>18</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#bddf1c2e730fc3301571be699b03bd95c3416f20" class="src_link" title="app/graph/mutations/user_mutations.rb">app/graph/mutations/user_mutations.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>4</td>
        <td>4</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#cb7d76f03f258c9f6f329fc795488b9ae0121229" class="src_link" title="app/graph/types/about_type.rb">app/graph/types/about_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#3cf2dff043f627e34e84debf16cf760c459ddc70" class="src_link" title="app/graph/types/account_type.rb">app/graph/types/account_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>38</td>
        <td>24</td>
        <td>24</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#d51021f72c7882c21602e0b1a0544f7115eb4276" class="src_link" title="app/graph/types/annotation_type.rb">app/graph/types/annotation_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c575a7bfc80c31049ccf931ffbf9b7bda66bf0b3" class="src_link" title="app/graph/types/annotator_type.rb">app/graph/types/annotator_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>9</td>
        <td>7</td>
        <td>7</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#438c1053b08ae9b7495b9994385a7d5489721ca8" class="src_link" title="app/graph/types/check_search_type.rb">app/graph/types/check_search_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>10</td>
        <td>6</td>
        <td>6</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e6b68cce524f402b4a5ab2dd25bcb5e19da95fb8" class="src_link" title="app/graph/types/comment_type.rb">app/graph/types/comment_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#c3ade8b3034a3a59d931749acce28880ca9c8734" class="src_link" title="app/graph/types/contact_type.rb">app/graph/types/contact_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>24</td>
        <td>16</td>
        <td>16</td>
        <td>0</td>
        <td>1.1</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b92e46ac87cc605fab93a1fe9accee104c1ecce9" class="src_link" title="app/graph/types/flag_type.rb">app/graph/types/flag_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#b7244b04417d56e9b6e07635d834c9822afd6a75" class="src_link" title="app/graph/types/media_type.rb">app/graph/types/media_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>85</td>
        <td>50</td>
        <td>50</td>
        <td>0</td>
        <td>4.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e104aae766e58875c50510a807998bbfe9b42cae" class="src_link" title="app/graph/types/mutation_type.rb">app/graph/types/mutation_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>58</td>
        <td>42</td>
        <td>42</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#604f784573d5865c3f5bd4209fecfff53522d215" class="src_link" title="app/graph/types/node_identification.rb">app/graph/types/node_identification.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>36</td>
        <td>25</td>
        <td>25</td>
        <td>0</td>
        <td>8.7</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#ab31674541ee49a9e1a59f66f149713500a0a457" class="src_link" title="app/graph/types/project_source_type.rb">app/graph/types/project_source_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>30</td>
        <td>18</td>
        <td>18</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#0e19c9d6575c6772e3656db8913702a9c79e37f0" class="src_link" title="app/graph/types/project_type.rb">app/graph/types/project_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>41</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#2fab1d8471ae3c69b6e67d8958b85b6d089740be" class="src_link" title="app/graph/types/public_team_type.rb">app/graph/types/public_team_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>12</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6ab47c22f73b1afb97f11e3b1a5eb5bc02e94b44" class="src_link" title="app/graph/types/query_type.rb">app/graph/types/query_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>110</td>
        <td>67</td>
        <td>67</td>
        <td>0</td>
        <td>2.6</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#113a2258848ab5962e09ea18193f8737391a13e4" class="src_link" title="app/graph/types/root_level_type.rb">app/graph/types/root_level_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>73</td>
        <td>44</td>
        <td>44</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#6caf93d3a3eff846209e8a82789b0e4e9c977e7b" class="src_link" title="app/graph/types/source_type.rb">app/graph/types/source_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>66</td>
        <td>38</td>
        <td>38</td>
        <td>0</td>
        <td>4.8</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5298730e0c53991c119cccb759f056e59b30872e" class="src_link" title="app/graph/types/status_type.rb">app/graph/types/status_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#5c144664968dfc0ede325f1e378e8edcfe4e489b" class="src_link" title="app/graph/types/tag_type.rb">app/graph/types/tag_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>1</td>
        <td>1</td>
        <td>1</td>
        <td>0</td>
        <td>1.0</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#86263f6d83626f26d603930d03c5f31eecb85a15" class="src_link" title="app/graph/types/team_type.rb">app/graph/types/team_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>63</td>
        <td>40</td>
        <td>40</td>
        <td>0</td>
        <td>1.4</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#59c3a54231ff82d5ce330be616008a1fee99b180" class="src_link" title="app/graph/types/team_user_type.rb">app/graph/types/team_user_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>31</td>
        <td>20</td>
        <td>20</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#a87618d4cd26e612873db0edeb2c9bdcc113592b" class="src_link" title="app/graph/types/user_type.rb">app/graph/types/user_type.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>42</td>
        <td>27</td>
        <td>27</td>
        <td>0</td>
        <td>1.2</td>
      </tr>
      
      <tr>
        <td class="strong"><a href="#e7ae00f2fff863f10826ae9cac50e31e7031020e" class="src_link" title="app/uploaders/image_uploader.rb">app/uploaders/image_uploader.rb</a></td>
        <td class="green strong">100.0 %</td>
        <td>23</td>
        <td>9</td>
        <td>9</td>
        <td>0</td>
        <td>825.1</td>
      </tr>
      
    </tbody>
  </table>
</div>

        
      </div>
    
      <div id="footer">
        Generated by <a href="http://github.com/colszowka/simplecov">simplecov</a> v0.12.0 
        and simplecov-html v0.10.0<br/>
        using MiniTest
      </div>
    
      <div class="source_files">
      
        <div class="source_table" id="835734272587eb23e8c421c504b48ea68e9c4e07">
  <div class="header">
    <h3>app/controllers/api/v1/base_api_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>58</b> relevant lines. 
      <span class="green"><b>58</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;error_codes&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module Api</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  module V1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    class BaseApiController &lt; ApplicationController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      include BaseDoc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      before_filter :remove_empty_params_and_headers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">      before_filter :set_custom_response_headers</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      before_filter :authenticate_from_token!, except: [:me, :options]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      # Verify payload for webhook methods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      # before_filter :verify_payload!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      respond_to :json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      def version</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">        name = &quot;#{Rails.application.class.parent_name} v#{VERSION}&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">        render_success &#39;version&#39;, name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">      def me</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">        header = CONFIG[&#39;authorization_header&#39;] || &#39;X-Token&#39;</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="24">
          <span class="hits">5</span>
          
          <code class="ruby">        token = request.headers[header]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="26">
          <span class="hits">5</span>
          
          <code class="ruby">        if session[&#39;checkdesk.error&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          message = session[&#39;checkdesk.error&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">          reset_session</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">          render_error(message, &#39;UNKNOWN&#39;) and return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="32">
          <span class="hits">4</span>
          
          <code class="ruby">        if token</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">          render_user User.where(token: token).last, &#39;token&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">          render_user current_api_user, &#39;session&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">      # Needed for pre-flight check</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">      def options</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">        render text: &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      def render_user(user = nil, source = nil)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">        unless user.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="48">
          <span class="hits">3</span>
          
          <code class="ruby">          user = user.as_json</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="49">
          <span class="hits">3</span>
          
          <code class="ruby">          user[:source] = source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="52">
          <span class="hits">4</span>
          
          <code class="ruby">        render_success &#39;user&#39;, user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">      def authenticate_from_token!</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="56">
          <span class="hits">8</span>
          
          <code class="ruby">        header = CONFIG[&#39;authorization_header&#39;] || &#39;X-Token&#39;</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="57">
          <span class="hits">8</span>
          
          <code class="ruby">        token = request.headers[header]</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="58">
          <span class="hits">8</span>
          
          <code class="ruby">        key = ApiKey.where(access_token: token).where(&#39;expire_at &gt; ?&#39;, Time.now).exists?</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="59">
          <span class="hits">8</span>
          
          <code class="ruby">        (render_unauthorized and return false) unless key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      # User token or session</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">      def authenticate_user!</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="64">
          <span class="hits">97</span>
          
          <code class="ruby">        header = CONFIG[&#39;authorization_header&#39;] || &#39;X-Token&#39;</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="65">
          <span class="hits">97</span>
          
          <code class="ruby">        token = request.headers[header].to_s</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="66">
          <span class="hits">97</span>
          
          <code class="ruby">        user = User.where(token: token).last</code>
        </li>
      
        <li class="covered" data-hits="97" data-linenumber="67">
          <span class="hits">97</span>
          
          <code class="ruby">        (token &amp;&amp; user) ? sign_in(user, store: false) : authenticate_api_user!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      def verify_payload!</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="71">
          <span class="hits">3</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="72">
          <span class="hits">3</span>
          
          <code class="ruby">          payload = request.raw_post</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="73">
          <span class="hits">3</span>
          
          <code class="ruby">          if verify_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">            @payload = JSON.parse(payload)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="76">
          <span class="hits">1</span>
          
          <code class="ruby">            render_unauthorized and return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        rescue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">          render_error(&#39;Could not verify payload&#39;, &#39;UNKNOWN&#39;) and return</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">      def verify_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="84">
          <span class="hits">3</span>
          
          <code class="ruby">        signature = &#39;sha1=&#39; + OpenSSL::HMAC.hexdigest(OpenSSL::Digest.new(&#39;sha1&#39;), CONFIG[&#39;secret_token&#39;].to_s, payload)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="85">
          <span class="hits">2</span>
          
          <code class="ruby">        Rack::Utils.secure_compare(signature, request.headers[&#39;X-Signature&#39;].to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">      def get_params</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="89">
          <span class="hits">7</span>
          
          <code class="ruby">        params.reject{ |k, _v| [&#39;id&#39;, &#39;action&#39;, &#39;controller&#39;, &#39;format&#39;].include?(k) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="92">
          <span class="hits">1</span>
          
          <code class="ruby">      def remove_empty_params_and_headers</code>
        </li>
      
        <li class="covered" data-hits="442" data-linenumber="93">
          <span class="hits">442</span>
          
          <code class="ruby">        params.reject!{ |_k, v| v.blank? }</code>
        </li>
      
        <li class="covered" data-hits="5602" data-linenumber="94">
          <span class="hits">5602</span>
          
          <code class="ruby">        request.headers.each{ |k, v| request.headers[k] = nil if (k =~ /HTTP_/).present? &amp;&amp; v.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">      def set_custom_response_headers</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="98">
          <span class="hits">114</span>
          
          <code class="ruby">        response.headers[&#39;X-Build&#39;] = BUILD</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="99">
          <span class="hits">114</span>
          
          <code class="ruby">        response.headers[&#39;Accept&#39;] ||= ApiConstraints.accept(1)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d59a06f23186d68cc46c3ce58aa84fd8f4c04e1b">
  <div class="header">
    <h3>app/controllers/api/v1/graphql_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>39</b> relevant lines. 
      <span class="green"><b>39</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module V1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class GraphqlController &lt; Api::V1::BaseApiController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      include GraphqlDoc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      skip_before_filter :authenticate_from_token!</code>
        </li>
      
        <li class="covered" data-hits="98" data-linenumber="7">
          <span class="hits">98</span>
          
          <code class="ruby">      before_action :authenticate_user!, only: [:create], if: -&gt; { params[:query].to_s.match(/^query About \{about/).nil? }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      before_action :load_context_team, :set_current_team, :load_context_project, :load_ability</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def create</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="11">
          <span class="hits">96</span>
          
          <code class="ruby">        query_string = params[:query]</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="12">
          <span class="hits">96</span>
          
          <code class="ruby">        query_variables = params[:variables] || {}</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="13">
          <span class="hits">96</span>
          
          <code class="ruby">        query_variables = {} if query_variables == &#39;null&#39;</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="14">
          <span class="hits">96</span>
          
          <code class="ruby">        debug = !!CONFIG[&#39;graphql_debug&#39;]</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="15">
          <span class="hits">96</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="16">
          <span class="hits">96</span>
          
          <code class="ruby">          query = GraphQL::Query.new(RelayOnRailsSchema, query_string, variables: query_variables, debug: debug, context: { current_user: current_api_user, context_team: @context_team, origin: request.headers[&#39;origin&#39;], context_project: @context_project, ability: @ability })</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="17">
          <span class="hits">96</span>
          
          <code class="ruby">          render json: query.result</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">        rescue ActiveRecord::RecordInvalid, RuntimeError, ActiveRecord::RecordNotUnique =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">          render json: { error: e.message }, status: 400</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">        rescue CheckdeskPermissions::AccessDenied =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">          render json: { error: e.message }, status: 403</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        rescue ActiveRecord::RecordNotFound =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="23">
          <span class="hits">3</span>
          
          <code class="ruby">          render json: { error: e.message }, status: 404</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">      private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">      def load_ability</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="30">
          <span class="hits">96</span>
          
          <code class="ruby">        @ability = Ability.new(current_api_user, @context_team) if current_api_user.present? &amp;&amp; @context_team.present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      def load_context_project</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="34">
          <span class="hits">96</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="35">
          <span class="hits">96</span>
          
          <code class="ruby">          path = URI.parse(request.referrer).path</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">          matches = path.match(/^\/project\/([^\/]+)/)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">          @context_project = Project.where(id: matches[1]).last unless matches.nil?</code>
        </li>
      
        <li class="covered" data-hits="95" data-linenumber="38">
          <span class="hits">95</span>
          
          <code class="ruby">        rescue URI::InvalidURIError</code>
        </li>
      
        <li class="covered" data-hits="95" data-linenumber="39">
          <span class="hits">95</span>
          
          <code class="ruby">          @context_project = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">      def load_context_team</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="44">
          <span class="hits">96</span>
          
          <code class="ruby">        @context_team = nil</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="45">
          <span class="hits">96</span>
          
          <code class="ruby">        subdomain = Regexp.new(CONFIG[&#39;checkdesk_client&#39;]).match(request.headers[&#39;origin&#39;])</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="46">
          <span class="hits">96</span>
          
          <code class="ruby">        @context_team = Team.where(subdomain: subdomain[1]).first unless subdomain.nil?</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="47">
          <span class="hits">96</span>
          
          <code class="ruby">        log = @context_team.nil? ? &#39;No context team&#39; : &quot;Context team is #{@context_team.name}&quot;</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="48">
          <span class="hits">96</span>
          
          <code class="ruby">        Rails.logger.info log</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">      def set_current_team</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="52">
          <span class="hits">96</span>
          
          <code class="ruby">        if !current_api_user.nil? &amp;&amp; !@context_team.nil? &amp;&amp; current_api_user.is_member_of?(@context_team) &amp;&amp; current_api_user.current_team_id != @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="53">
          <span class="hits">8</span>
          
          <code class="ruby">          current_api_user.current_team_id = @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="54">
          <span class="hits">8</span>
          
          <code class="ruby">          current_api_user.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d291f45d1b7194643ee7554141d0c00417754fce">
  <div class="header">
    <h3>app/controllers/api/v1/omniauth_callbacks_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>26</b> relevant lines. 
      <span class="green"><b>26</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Api</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module V1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    class OmniauthCallbacksController &lt; Devise::OmniauthCallbacksController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">      include TwitterAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">      include FacebookAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      include SlackAuthentication</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      def logout</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">        sign_out current_api_user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">        destination = params[:destination] || &#39;/&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">        redirect_to destination</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      def failure</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">        redirect_to &#39;/close.html&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      def start_session_and_redirect</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="21">
          <span class="hits">11</span>
          
          <code class="ruby">        auth = request.env[&#39;omniauth.auth&#39;]</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="22">
          <span class="hits">11</span>
          
          <code class="ruby">        user = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="24">
          <span class="hits">11</span>
          
          <code class="ruby">        begin</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="25">
          <span class="hits">11</span>
          
          <code class="ruby">          user = User.from_omniauth(auth)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">        rescue ActiveRecord::RecordInvalid =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">          session[&#39;checkdesk.error&#39;] = e.message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="30">
          <span class="hits">11</span>
          
          <code class="ruby">        unless user.nil?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="31">
          <span class="hits">10</span>
          
          <code class="ruby">          session[&#39;checkdesk.current_user_id&#39;] = user.id</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="32">
          <span class="hits">10</span>
          
          <code class="ruby">          sign_in(user)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="35">
          <span class="hits">11</span>
          
          <code class="ruby">        destination = params[:destination] || &#39;/api&#39;</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="36">
          <span class="hits">11</span>
          
          <code class="ruby">        if request.env.has_key?(&#39;omniauth.params&#39;)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">          destination = request.env[&#39;omniauth.params&#39;][&#39;destination&#39;] unless request.env[&#39;omniauth.params&#39;][&#39;destination&#39;].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="40">
          <span class="hits">11</span>
          
          <code class="ruby">        redirect_to destination</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f142a2021f202ff9ef87c020194f1caf5e42a38d">
  <div class="header">
    <h3>app/controllers/api/v1/registrations_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>32</b> relevant lines. 
      <span class="green"><b>32</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Api::V1::RegistrationsController &lt; Devise::RegistrationsController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :configure_sign_up_params, only: [:create]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :configure_account_update_params, only: [:update]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  respond_to :json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  include RegistrationsDoc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # POST /resource</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    # super</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="12">
          <span class="hits">7</span>
          
          <code class="ruby">    build_resource(sign_up_params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="14">
          <span class="hits">7</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="15">
          <span class="hits">7</span>
          
          <code class="ruby">      resource.save!</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">      sign_up(resource_name, resource)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">      render_success &#39;user&#39;, resource</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="18">
          <span class="hits">5</span>
          
          <code class="ruby">    rescue ActiveRecord::RecordInvalid =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="19">
          <span class="hits">5</span>
          
          <code class="ruby">      clean_up_passwords resource</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="20">
          <span class="hits">5</span>
          
          <code class="ruby">      set_minimum_password_length</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="21">
          <span class="hits">5</span>
          
          <code class="ruby">      render_error e.message.gsub(/^Validation failed: Email /, &#39;&#39;), &#39;INVALID_VALUE&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  # PUT /resource</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def update</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    # super</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="28">
          <span class="hits">2</span>
          
          <code class="ruby">    self.resource = resource_class.to_adapter.get!(send(:&quot;current_#{resource_name}&quot;).to_key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">    resource_updated = update_resource(resource, account_update_params)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">    if resource_updated</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      sign_in resource, scope: resource_name, bypass_sign_in: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      render_success &#39;user&#39;, resource</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">      clean_up_passwords resource</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      render_error &#39;Could not update user: &#39; + resource.errors.full_messages.join(&#39;, &#39;), &#39;INVALID_VALUE&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  # DELETE /resource</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    # super</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">    resource.destroy</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    Devise.sign_out_all_scopes ? sign_out : sign_out(resource_name)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    render_success</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  # If you have extra params to permit, append them to the sanitizer.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="51">
          <span class="hits">1</span>
          
          <code class="ruby">  def configure_sign_up_params</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="52">
          <span class="hits">7</span>
          
          <code class="ruby">    devise_parameter_sanitizer.permit(:sign_up, keys: [:name, :login, :password, :password_confirmation, :image])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  # If you have extra params to permit, append them to the sanitizer.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def configure_account_update_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="57">
          <span class="hits">2</span>
          
          <code class="ruby">    devise_parameter_sanitizer.permit(:account_update, keys: [:name, :password, :password_confirmation, :current_password])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f755bbd5fc61f8d733b36cc8b3af8370ffcdc27b">
  <div class="header">
    <h3>app/controllers/api/v1/sessions_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Api::V1::SessionsController &lt; Devise::SessionsController</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  before_action :configure_sign_in_params, only: [:create]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include SessionsDoc</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  # POST /resource/sign_in</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # super</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">    self.resource = warden.authenticate!(auth_options)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    sign_in(resource_name, resource)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    render_success &#39;user&#39;, current_api_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # DELETE /resource/sign_out</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    # super</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    signed_out = (Devise.sign_out_all_scopes ? sign_out : sign_out(resource_name))</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    signed_out ? render_success : render_error(&#39;Could not logout&#39;, &#39;AUTH&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  # If you have extra params to permit, append them to the sanitizer.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def configure_sign_in_params</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">    devise_parameter_sanitizer.permit(:sign_in, keys: [:login, :password])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2906d077ba5da67c22dd9057a51ac7ecfeb7625b">
  <div class="header">
    <h3>app/controllers/application_controller.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>13</b> relevant lines. 
      <span class="green"><b>13</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;error_codes&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationController &lt; ActionController::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  protect_from_forgery with: :exception</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  skip_before_filter :verify_authenticity_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_success(type = &#39;success&#39;, object = nil)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="10">
          <span class="hits">14</span>
          
          <code class="ruby">    json = { type: type }</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="11">
          <span class="hits">14</span>
          
          <code class="ruby">    json[:data] = object unless object.nil?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="12">
          <span class="hits">14</span>
          
          <code class="ruby">    render json: json, status: 200</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_error(message, code, status = 400)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="16">
          <span class="hits">14</span>
          
          <code class="ruby">    render json: { type: &#39;error&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                   data: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">                     message: message,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">                     code: LapisConstants::ErrorCodes::const_get(code)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">                   }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">                 },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">                 status: status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def render_unauthorized</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="26">
          <span class="hits">6</span>
          
          <code class="ruby">    render_error &#39;Unauthorized&#39;, &#39;UNAUTHORIZED&#39;, 401</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d5dcb6471c5c9d242564d37e9e38f385e763a3de">
  <div class="header">
    <h3>app/controllers/concerns/facebook_authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module FacebookAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # OAuth callback</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def facebook</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="6">
          <span class="hits">5</span>
          
          <code class="ruby">    request.env[&#39;omniauth.auth&#39;][&#39;url&#39;] = &#39;https://facebook.com/&#39; + request.env[&#39;omniauth.auth&#39;].uid</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="7">
          <span class="hits">5</span>
          
          <code class="ruby">    start_session_and_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a063c46ffa728a4cd14e6cbf2a94f697a9451b0d">
  <div class="header">
    <h3>app/controllers/concerns/slack_authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SlackAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # OAuth callback</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def slack</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">    start_session_and_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0961319bf3b08d566dde6ef2ccd4c66adfb870fb">
  <div class="header">
    <h3>app/controllers/concerns/twitter_authentication.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TwitterAuthentication</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  # OAuth callback</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  def twitter</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="6">
          <span class="hits">3</span>
          
          <code class="ruby">    request.env[&#39;omniauth.auth&#39;][&#39;url&#39;] = &#39;https://twitter.com/&#39; + request.env[&#39;omniauth.auth&#39;].info.nickname</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="7">
          <span class="hits">3</span>
          
          <code class="ruby">    start_session_and_redirect</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4b5b05532bb76e1f8a27101a38f38cb3fb5ed1ad">
  <div class="header">
    <h3>app/graph/mutations/account_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AccountMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    url: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    source_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    user_id: &#39;int&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    url: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    source_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    user_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;account&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c9d2daf3d3d3427933d836a24c4a07a6a2ebe304">
  <div class="header">
    <h3>app/graph/mutations/annotation_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AnnotationMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    content: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    annotation_type: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    content: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    annotation_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;annotation&#39;, create_fields, update_fields, [&#39;source&#39;, &#39;media&#39;, &#39;project&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="adcd36f9afd4f01986562b5da8a458f1a06792fc">
  <div class="header">
    <h3>app/graph/mutations/comment_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CommentMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    text: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    text: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;comment&#39;, create_fields, update_fields, [&#39;media&#39;, &#39;source&#39;, &#39;project&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="867bf36dbca0ced5757888b13044c6368c8bbb33">
  <div class="header">
    <h3>app/graph/mutations/contact_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ContactMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    location: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    phone: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    web: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    team_id: &#39;int&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    location: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    phone: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    web: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    team_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;contact&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="700cbb923ed40814b7040fdf980a6af01b7af6ff">
  <div class="header">
    <h3>app/graph/mutations/flag_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module FlagMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    flag: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    flag: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;flag&#39;, create_fields, update_fields, [&#39;media&#39;, &#39;source&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="96de21b8afb70e6133f7879766dc8c84fdbc2f3e">
  <div class="header">
    <h3>app/graph/mutations/graphql_crud_operations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>117</b> relevant lines. 
      <span class="green"><b>117</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class GraphqlCrudOperations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.safe_save(obj, attrs, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="3">
          <span class="hits">25</span>
          
          <code class="ruby">    attrs.each do |key, value|</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="4">
          <span class="hits">44</span>
          
          <code class="ruby">      obj.send(&quot;#{key}=&quot;, value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="6">
          <span class="hits">25</span>
          
          <code class="ruby">    obj.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="8">
          <span class="hits">24</span>
          
          <code class="ruby">    name = obj.class.name.underscore</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="9">
          <span class="hits">24</span>
          
          <code class="ruby">    ret = { name.to_sym =&gt; obj }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="11">
          <span class="hits">24</span>
          
          <code class="ruby">    parents.each do |parent_name|</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="12">
          <span class="hits">16</span>
          
          <code class="ruby">      child, parent = obj, obj.send(parent_name)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="13">
          <span class="hits">16</span>
          
          <code class="ruby">      unless parent.nil?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="14">
          <span class="hits">14</span>
          
          <code class="ruby">        parent.no_cache = true</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="15">
          <span class="hits">14</span>
          
          <code class="ruby">        parent.project_id = child.context_id if parent_name.to_s == &#39;media&#39; &amp;&amp; child.context_type == &#39;Project&#39; &amp;&amp; parent.respond_to?(:project_id)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="16">
          <span class="hits">14</span>
          
          <code class="ruby">        ret[&quot;#{name}Edge&quot;.to_sym] = GraphQL::Relay::Edge.between(child, parent)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="17">
          <span class="hits">14</span>
          
          <code class="ruby">        ret[parent_name.to_sym] = parent</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="21">
          <span class="hits">24</span>
          
          <code class="ruby">    ret</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.create(type, inputs, ctx, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="25">
          <span class="hits">16</span>
          
          <code class="ruby">    obj = type.camelize.constantize.new</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="26">
          <span class="hits">16</span>
          
          <code class="ruby">    obj.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="27">
          <span class="hits">16</span>
          
          <code class="ruby">    obj.context_team = ctx[:context_team]</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="28">
          <span class="hits">16</span>
          
          <code class="ruby">    obj.origin = ctx[:origin] if obj.respond_to?(&#39;origin=&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="30">
          <span class="hits">16</span>
          
          <code class="ruby">    attrs = inputs.keys.inject({}) do |memo, key|</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="31">
          <span class="hits">51</span>
          
          <code class="ruby">      memo[key] = inputs[key] unless key == &quot;clientMutationId&quot;</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="32">
          <span class="hits">51</span>
          
          <code class="ruby">      memo</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="35">
          <span class="hits">16</span>
          
          <code class="ruby">    self.safe_save(obj, attrs, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.update(_type, inputs, ctx, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="39">
          <span class="hits">9</span>
          
          <code class="ruby">    obj = NodeIdentification.object_from_id(inputs[:id], ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="41">
          <span class="hits">9</span>
          
          <code class="ruby">    attrs = inputs.keys.inject({}) do |memo, key|</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="42">
          <span class="hits">27</span>
          
          <code class="ruby">      memo[key] = inputs[key] unless key == &quot;clientMutationId&quot; || key == &#39;id&#39;</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="43">
          <span class="hits">27</span>
          
          <code class="ruby">      memo</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="46">
          <span class="hits">9</span>
          
          <code class="ruby">    self.safe_save(obj, attrs, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.destroy(inputs, ctx, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="50">
          <span class="hits">10</span>
          
          <code class="ruby">    type, id = NodeIdentification.from_global_id(inputs[:id])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="51">
          <span class="hits">10</span>
          
          <code class="ruby">    obj = type.constantize.find(id)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="52">
          <span class="hits">10</span>
          
          <code class="ruby">    obj.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="53">
          <span class="hits">10</span>
          
          <code class="ruby">    obj.context_team = ctx[:context_team]</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="54">
          <span class="hits">10</span>
          
          <code class="ruby">    obj.destroy</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="56">
          <span class="hits">10</span>
          
          <code class="ruby">    ret = { deletedId: inputs[:id] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="58">
          <span class="hits">22</span>
          
          <code class="ruby">    parents.each { |parent| ret[parent.to_sym] = obj.send(parent) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="60">
          <span class="hits">10</span>
          
          <code class="ruby">    ret</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_create(type, create_fields, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="64">
          <span class="hits">14</span>
          
          <code class="ruby">    self.define_create_or_update(&#39;create&#39;, type, create_fields, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="67">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_update(type, update_fields, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="68">
          <span class="hits">14</span>
          
          <code class="ruby">    self.define_create_or_update(&#39;update&#39;, type, update_fields, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_create_or_update(action, type, fields, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="72">
          <span class="hits">28</span>
          
          <code class="ruby">    GraphQL::Relay::Mutation.define do</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="73">
          <span class="hits">28</span>
          
          <code class="ruby">      mapping = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">        &#39;str&#39;  =&gt; types.String,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">        &#39;!str&#39; =&gt; !types.String,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">        &#39;int&#39;  =&gt; types.Int,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">        &#39;!int&#39; =&gt; !types.Int,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">        &#39;id&#39;   =&gt; types.ID,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">        &#39;!id&#39;  =&gt; !types.ID,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">        &#39;bool&#39; =&gt; types.Boolean</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="83">
          <span class="hits">28</span>
          
          <code class="ruby">      name &quot;#{action.camelize}#{type.camelize}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="85">
          <span class="hits">28</span>
          
          <code class="ruby">      fields.each do |field_name, field_type|</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="86">
          <span class="hits">148</span>
          
          <code class="ruby">        input_field field_name, mapping[field_type]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="89">
          <span class="hits">28</span>
          
          <code class="ruby">      klass = &quot;#{type.camelize}Type&quot;.constantize</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="90">
          <span class="hits">28</span>
          
          <code class="ruby">      return_field type.to_sym, klass</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="92">
          <span class="hits">28</span>
          
          <code class="ruby">      parents.each do |parent|</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="93">
          <span class="hits">28</span>
          
          <code class="ruby">        return_field &quot;#{type}Edge&quot;.to_sym, klass.edge_type</code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="94">
          <span class="hits">28</span>
          
          <code class="ruby">        return_field parent.to_sym, &quot;#{parent.camelize}Type&quot;.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="28" data-linenumber="97">
          <span class="hits">28</span>
          
          <code class="ruby">      resolve -&gt; (inputs, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="98">
          <span class="hits">25</span>
          
          <code class="ruby">        GraphqlCrudOperations.send(action, type, inputs, ctx, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_destroy(type, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="104">
          <span class="hits">14</span>
          
          <code class="ruby">    GraphQL::Relay::Mutation.define do</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="105">
          <span class="hits">14</span>
          
          <code class="ruby">      name &quot;Destroy#{type.camelize}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="107">
          <span class="hits">14</span>
          
          <code class="ruby">      input_field :id, !types.ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="109">
          <span class="hits">14</span>
          
          <code class="ruby">      return_field :deletedId, types.ID</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="110">
          <span class="hits">14</span>
          
          <code class="ruby">      parents.each do |parent|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="111">
          <span class="hits">14</span>
          
          <code class="ruby">        return_field parent.to_sym, &quot;#{parent.camelize}Type&quot;.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="114">
          <span class="hits">14</span>
          
          <code class="ruby">      resolve -&gt; (inputs, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="115">
          <span class="hits">10</span>
          
          <code class="ruby">        GraphqlCrudOperations.destroy(inputs, ctx, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_crud_operations(type, create_fields, update_fields = {}, parents = [])</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="121">
          <span class="hits">14</span>
          
          <code class="ruby">    update_fields = create_fields if update_fields.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    [</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="123">
          <span class="hits">14</span>
          
          <code class="ruby">      GraphqlCrudOperations.define_create(type, create_fields, parents),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">      GraphqlCrudOperations.define_update(type, update_fields, parents),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="125">
          
          
          <code class="ruby">      GraphqlCrudOperations.define_destroy(type, parents)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_default_type(&amp;block)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="130">
          <span class="hits">11</span>
          
          <code class="ruby">    GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="131">
          <span class="hits">11</span>
          
          <code class="ruby">      field :permissions, types.String do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="132">
          <span class="hits">11</span>
          
          <code class="ruby">        resolve -&gt; (obj, _args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="133">
          <span class="hits">21</span>
          
          <code class="ruby">          obj.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="134">
          <span class="hits">21</span>
          
          <code class="ruby">          obj.project_id ||= ctx[:context_project].id if obj.is_a?(Media) &amp;&amp; ctx[:context_project].present?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="135">
          <span class="hits">21</span>
          
          <code class="ruby">          obj.permissions(ctx[:ability])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="139">
          <span class="hits">11</span>
          
          <code class="ruby">      instance_eval(&amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.field_with_context</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="144">
          <span class="hits">4</span>
          
          <code class="ruby">    proc do |name, field_type = types.String, method = nil|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="145">
          <span class="hits">4</span>
          
          <code class="ruby">      field name do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="146">
          <span class="hits">4</span>
          
          <code class="ruby">        type field_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="148">
          <span class="hits">4</span>
          
          <code class="ruby">        argument :context_id, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="150">
          <span class="hits">4</span>
          
          <code class="ruby">        resolve -&gt; (media, args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="151">
          <span class="hits">10</span>
          
          <code class="ruby">          call_method_from_context(media, method.blank? ? name : method, args, ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.field_verification_statuses</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="158">
          <span class="hits">2</span>
          
          <code class="ruby">    proc do |classname|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="159">
          <span class="hits">2</span>
          
          <code class="ruby">      field :verification_statuses do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="160">
          <span class="hits">2</span>
          
          <code class="ruby">        type types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="162">
          <span class="hits">2</span>
          
          <code class="ruby">        resolve -&gt;(_obj, _args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="163">
          <span class="hits">2</span>
          
          <code class="ruby">          team = ctx[:context_team] || Team.new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="164">
          <span class="hits">2</span>
          
          <code class="ruby">          team.verification_statuses(classname)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="170">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_annotation_fields</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="171">
          <span class="hits">5</span>
          
          <code class="ruby">    [:annotation_type, :updated_at, :created_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">     :context_id, :context_type, :annotated_id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">     :annotated_type, :content, :dbid ]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="176">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.define_annotation_type(type, fields = {})</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="177">
          <span class="hits">5</span>
          
          <code class="ruby">    GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="178">
          <span class="hits">5</span>
          
          <code class="ruby">      name type.capitalize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="180">
          <span class="hits">5</span>
          
          <code class="ruby">      interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="182">
          <span class="hits">5</span>
          
          <code class="ruby">      field :id, field: GraphQL::Relay::GlobalIdField.new(type.capitalize)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="184">
          <span class="hits">5</span>
          
          <code class="ruby">      GraphqlCrudOperations.define_annotation_fields.each do |name|</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="185">
          <span class="hits">45</span>
          
          <code class="ruby">        field name, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="188">
          <span class="hits">5</span>
          
          <code class="ruby">      field :permissions, types.String do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="189">
          <span class="hits">5</span>
          
          <code class="ruby">        resolve -&gt; (annotation, _args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="190">
          <span class="hits">21</span>
          
          <code class="ruby">          annotation.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="191">
          <span class="hits">21</span>
          
          <code class="ruby">          annotation.permissions(ctx[:ability])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="195">
          <span class="hits">5</span>
          
          <code class="ruby">      fields.each do |name, _field_type|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="196">
          <span class="hits">5</span>
          
          <code class="ruby">        field name, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="199">
          <span class="hits">5</span>
          
          <code class="ruby">      field :annotator do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="200">
          <span class="hits">5</span>
          
          <code class="ruby">        type AnnotatorType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="202">
          <span class="hits">5</span>
          
          <code class="ruby">        resolve -&gt; (annotation, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="203">
          <span class="hits">2</span>
          
          <code class="ruby">          annotation.annotator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="207">
          <span class="hits">6</span>
          
          <code class="ruby">      connection :medias, -&gt; { MediaType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="208">
          <span class="hits">5</span>
          
          <code class="ruby">        resolve -&gt;(annotation, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="209">
          <span class="hits">1</span>
          
          <code class="ruby">          annotation.entity_objects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="214">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="215">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.load_if_can(klass, id, ctx)</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="216">
          <span class="hits">16</span>
          
          <code class="ruby">    obj = klass.find_if_can(id, ctx[:current_user], ctx[:context_team], ctx[:ability])</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="217">
          <span class="hits">13</span>
          
          <code class="ruby">    obj.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="218">
          <span class="hits">13</span>
          
          <code class="ruby">    obj.context_team = ctx[:context_team]</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="219">
          <span class="hits">13</span>
          
          <code class="ruby">    obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="221">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2172bb46f7629bb8d7293dab0e686809ef0c4170">
  <div class="header">
    <h3>app/graph/mutations/media_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module MediaMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    url: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    account_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    project_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    user_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    information: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    url: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    account_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    project_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    user_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    information: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;media&#39;, create_fields, update_fields, [&#39;project&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ce5fcd49b988c930dafc4d50bfd5c5128629b500">
  <div class="header">
    <h3>app/graph/mutations/project_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ProjectMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    lead_image: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    description: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    title: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    team_id: &#39;int&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    lead_image: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    description: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    title: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    set_slack_channel: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;project&#39;, create_fields, update_fields, [&#39;team&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3cb309f131912a9e2db0a0435c4546f8c853a35c">
  <div class="header">
    <h3>app/graph/mutations/project_source_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module ProjectSourceMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    source_id: &#39;!int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    project_id: &#39;!int&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    source_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    project_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;project_source&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="916f05c16c3aef1c889acdc4754b1b88056806f3">
  <div class="header">
    <h3>app/graph/mutations/source_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module SourceMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    avatar: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    slogan: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    name: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    user_id: &#39;int&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    avatar: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    slogan: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    name: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    user_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;source&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ec9b89efb05aa823f9c24a3e03b92b86135e2ac1">
  <div class="header">
    <h3>app/graph/mutations/status_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module StatusMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    status: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    status: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;status&#39;, create_fields, update_fields, [&#39;media&#39;, &#39;source&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="99f56c1da02fbac6f211e7015dce938ba9392e37">
  <div class="header">
    <h3>app/graph/mutations/tag_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TagMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    tag: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    tag: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    context_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    context_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    annotated_id: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    annotated_type: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;tag&#39;, create_fields, update_fields, [&#39;source&#39;, &#39;media&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a758daef557c63a5a152f76cf9dbb6c8ad02bc44">
  <div class="header">
    <h3>app/graph/mutations/team_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TeamMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    archived: &#39;bool&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    private: &#39;bool&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    logo: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    name: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    subdomain: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    description: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    contact: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    archived: &#39;bool&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    private: &#39;bool&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    logo: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    name: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    description: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    set_slack_notifications_enabled: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    set_slack_webhook: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    set_slack_channel: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    contact: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;team&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e878aacdc5463815014d0fb07124735fc913e023">
  <div class="header">
    <h3>app/graph/mutations/team_user_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module TeamUserMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    user_id: &#39;!int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    team_id: &#39;!int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    status: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    role: &#39;str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    user_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    team_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    status: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    role: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;team_user&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bddf1c2e730fc3301571be699b03bd95c3416f20">
  <div class="header">
    <h3>app/graph/mutations/user_mutations.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module UserMutations</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  create_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">    email: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    profile_image: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    login: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    name: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    current_team_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    password: &#39;!str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    password_confirmation: &#39;!str&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  update_fields = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    email: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">    profile_image: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    login: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    name: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    current_team_id: &#39;int&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    password: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    password_confirmation: &#39;str&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    id: &#39;!id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  Create, Update, Destroy = GraphqlCrudOperations.define_crud_operations(&#39;user&#39;, create_fields, update_fields)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="cb7d76f03f258c9f6f329fc795488b9ae0121229">
  <div class="header">
    <h3>app/graph/types/about_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">AboutType = GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;About&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Information about the application&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  global_id_field :id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, types.String, &#39;Application name&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :version, types.String, &#39;Application version&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :tos, types.String, &#39;Terms of Service&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :privacy_policy, types.String, &#39;Privacy Policy&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3cf2dff043f627e34e84debf16cf760c459ddc70">
  <div class="header">
    <h3>app/graph/types/account_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">AccountType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Account&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Account type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Account&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :data, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :url, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :provider, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :user_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  field :user do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    type UserType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (account, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">      account.user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    type -&gt; { SourceType }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (account, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">      account.source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :medias, -&gt; { MediaType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(account, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">      account.medias</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"># End of fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d51021f72c7882c21602e0b1a0544f7115eb4276">
  <div class="header">
    <h3>app/graph/types/annotation_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">AnnotationType = GraphqlCrudOperations.define_annotation_type(&#39;annotation&#39;, { content: &#39;str&#39; })</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c575a7bfc80c31049ccf931ffbf9b7bda66bf0b3">
  <div class="header">
    <h3>app/graph/types/annotator_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">AnnotatorType = GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Annotator&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Information about an annotator&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]      </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  global_id_field :id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :profile_image, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="438c1053b08ae9b7495b9994385a7d5489721ca8">
  <div class="header">
    <h3>app/graph/types/check_search_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">CheckSearchType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;CheckSearch&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;CheckSearch type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :number_of_results, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :medias, MediaType.connection_type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e6b68cce524f402b4a5ab2dd25bcb5e19da95fb8">
  <div class="header">
    <h3>app/graph/types/comment_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">CommentType = GraphqlCrudOperations.define_annotation_type(&#39;comment&#39;, { text: &#39;str&#39; })</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c3ade8b3034a3a59d931749acce28880ca9c8734">
  <div class="header">
    <h3>app/graph/types/contact_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ContactType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Contact&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Contact type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Contact&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :location, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :phone, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :web, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">    type -&gt; { TeamType }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (contact, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="19">
          <span class="hits">2</span>
          
          <code class="ruby">      contact.team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"># End of fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b92e46ac87cc605fab93a1fe9accee104c1ecce9">
  <div class="header">
    <h3>app/graph/types/flag_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">FlagType = GraphqlCrudOperations.define_annotation_type(&#39;flag&#39;, { flag: &#39;str&#39; })</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b7244b04417d56e9b6e07635d834c9822afd6a75">
  <div class="header">
    <h3>app/graph/types/media_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>50</b> relevant lines. 
      <span class="green"><b>50</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">MediaType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Media&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Media type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    type types.ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (media, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="11">
          <span class="hits">4</span>
          
          <code class="ruby">      media.relay_id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  field :url, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  field :account_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  field :project_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  field :dbid, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  field :domain, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  field :pusher_channel, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  field :account do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    type -&gt; { AccountType }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (media, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">      media.account</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :projects, -&gt; { ProjectType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (media, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">      media.projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :annotations, -&gt; { AnnotationType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :context_id, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(media, args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="41">
          <span class="hits">22</span>
          
          <code class="ruby">      media.cached_annotations(annotation_types, media_context(media, args, ctx))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  field :annotations_count do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    type types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :context_id, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(media, args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">      media.cached_annotations(annotation_types, media_context(media, args, ctx)).size</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :tags, -&gt; { TagType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :context_id, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(media, args, ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">      call_method_from_context(media, :tags, args, ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="62">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :media, &amp;GraphqlCrudOperations.field_verification_statuses</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :jsondata, &amp;GraphqlCrudOperations.field_with_context</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :last_status, &amp;GraphqlCrudOperations.field_with_context</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :published, &amp;GraphqlCrudOperations.field_with_context</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :user, UserType, :user_in_context, &amp;GraphqlCrudOperations.field_with_context</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">def annotation_types</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="70">
          <span class="hits">23</span>
          
          <code class="ruby">  [&#39;comment&#39;, &#39;status&#39;, &#39;tag&#39;, &#39;flag&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">def media_context(media, args, ctx)</code>
        </li>
      
        <li class="covered" data-hits="23" data-linenumber="74">
          <span class="hits">23</span>
          
          <code class="ruby">  get_context(args, ctx) || media.project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">def get_context(args = {}, ctx = {})</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="78">
          <span class="hits">34</span>
          
          <code class="ruby">  return ctx[:context_project] unless ctx[:context_project].nil?</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="79">
          <span class="hits">34</span>
          
          <code class="ruby">  args[&#39;context_id&#39;].nil? ? nil : Project.find_if_can(args[&#39;context_id&#39;], ctx[:current_user], ctx[:context_team], ctx[:ability])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">def call_method_from_context(media, method, args, ctx)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="83">
          <span class="hits">11</span>
          
          <code class="ruby">  context = get_context(args, ctx)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="84">
          <span class="hits">11</span>
          
          <code class="ruby">  media.send(method, context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e104aae766e58875c50510a807998bbfe9b42cae">
  <div class="header">
    <h3>app/graph/types/mutation_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">MutationType = GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;MutationType&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createComment, field: CommentMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateComment, field: CommentMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyComment, field: CommentMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createProjectSource, field: ProjectSourceMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateProjectSource, field: ProjectSourceMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyProjectSource, field: ProjectSourceMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createSource, field: SourceMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateSource, field: SourceMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroySource, field: SourceMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createTeamUser, field: TeamUserMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateTeamUser, field: TeamUserMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyTeamUser, field: TeamUserMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createTeam, field: TeamMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateTeam, field: TeamMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyTeam, field: TeamMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createAccount, field: AccountMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateAccount, field: AccountMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyAccount, field: AccountMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createMedia, field: MediaMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateMedia, field: MediaMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyMedia, field: MediaMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createProject, field: ProjectMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateProject, field: ProjectMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyProject, field: ProjectMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createUser, field: UserMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateUser, field: UserMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyUser, field: UserMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createTag, field: TagMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateTag, field: TagMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyTag, field: TagMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createStatus, field: StatusMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateStatus, field: StatusMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyStatus, field: StatusMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createFlag, field: FlagMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateFlag, field: FlagMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyFlag, field: FlagMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  # field :createAnnotation, field: AnnotationMutations::Create.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  # field :updateAnnotation, field: AnnotationMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyAnnotation, field: AnnotationMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  field :createContact, field: ContactMutations::Create.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updateContact, field: ContactMutations::Update.field</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  field :destroyContact, field: ContactMutations::Destroy.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="604f784573d5865c3f5bd4209fecfff53522d215">
  <div class="header">
    <h3>app/graph/types/node_identification.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>25</b> relevant lines. 
      <span class="green"><b>25</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">GraphQL::Relay::GlobalNodeIdentification.instance_variable_set(:@instance, nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">NodeIdentification = GraphQL::Relay::GlobalNodeIdentification.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  object_from_id -&gt; (id, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="4">
          <span class="hits">11</span>
          
          <code class="ruby">    type_name, id = NodeIdentification.from_global_id(id)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="5">
          <span class="hits">11</span>
          
          <code class="ruby">    obj = nil</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="6">
          <span class="hits">11</span>
          
          <code class="ruby">    if type_name == &#39;About&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">      name = Rails.application.class.parent_name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">      obj = OpenStruct.new({ name: name, version: VERSION, id: 1, type: &#39;About&#39; })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    elsif type_name == &#39;CheckSearch&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      obj = CheckSearch.new(id, ctx[:context_team]) </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="12">
          <span class="hits">9</span>
          
          <code class="ruby">      obj = type_name.constantize.find_if_can(id, ctx[:current_user], ctx[:context_team])</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="13">
          <span class="hits">9</span>
          
          <code class="ruby">      obj.current_user = ctx[:current_user]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="14">
          <span class="hits">9</span>
          
          <code class="ruby">      obj.context_team = ctx[:context_team]</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="15">
          <span class="hits">9</span>
          
          <code class="ruby">      obj.origin = ctx[:origin] if obj.respond_to?(&#39;origin=&#39;)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="16">
          <span class="hits">9</span>
          
          <code class="ruby">      obj.project_id ||= ctx[:context_project].id if obj.respond_to?(&#39;project_id=&#39;) &amp;&amp; ctx[:context_project].present?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="18">
          <span class="hits">11</span>
          
          <code class="ruby">    obj</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  type_from_object -&gt; (object) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">    klass = object.respond_to?(:type) ? object.type : object.class.name</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">    &quot;#{klass}Type&quot;.constantize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  to_global_id -&gt; (type_name, id) do</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="27">
          <span class="hits">31</span>
          
          <code class="ruby">    Base64.encode64(&quot;#{type_name}/#{id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  from_global_id -&gt; (global_id) do</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="31">
          <span class="hits">21</span>
          
          <code class="ruby">    id_parts  = Base64.decode64(global_id).split(&quot;/&quot;)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="32">
          <span class="hits">21</span>
          
          <code class="ruby">    type_name = id_parts[0]</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="33">
          <span class="hits">21</span>
          
          <code class="ruby">    id        = id_parts[1]</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="34">
          <span class="hits">21</span>
          
          <code class="ruby">    [type_name, id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ab31674541ee49a9e1a59f66f149713500a0a457">
  <div class="header">
    <h3>app/graph/types/project_source_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ProjectSourceType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;ProjectSource&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;ProjectSource type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;ProjectSource&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :project_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :project do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">    type -&gt; { ProjectType }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (project_source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">      project_source.project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">    type -&gt; { SourceType }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (project_source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      project_source.source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"># End of fields</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0e19c9d6575c6772e3656db8913702a9c79e37f0">
  <div class="header">
    <h3>app/graph/types/project_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">ProjectType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Project&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Project type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Project&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :avatar, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :description, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :title, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :dbid, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :get_slack_channel, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :pusher_channel, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :medias_count, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    type TeamType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (project, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">      team = project.team</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="22">
          <span class="hits">2</span>
          
          <code class="ruby">      team.context_team = project.context_team</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">      team.current_user = project.current_user</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">      team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :medias, MediaType.connection_type, property: :eager_loaded_medias</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :sources, -&gt; { SourceType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(project, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">      project.sources</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="36">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :annotations, -&gt; { AnnotationType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(project, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      project.annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2fab1d8471ae3c69b6e67d8958b85b6d089740be">
  <div class="header">
    <h3>app/graph/types/public_team_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">PublicTeamType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;PublicTeam&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Public team type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Team&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :subdomain, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :description, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :dbid, types.Int</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6ab47c22f73b1afb97f11e3b1a5eb5bc02e94b44">
  <div class="header">
    <h3>app/graph/types/query_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>67</b> relevant lines. 
      <span class="green"><b>67</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">QueryType = GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &quot;Query&quot;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &quot;The query root of this schema&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  field :node, field: NodeIdentification.field</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :root, RootLevelType do</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="8">
          <span class="hits">30</span>
          
          <code class="ruby">    resolve -&gt; (_obj, _args, _ctx) { RootLevel::STATIC }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :about do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    type AboutType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Information about the application&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, _args, _ctx) do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="15">
          <span class="hits">3</span>
          
          <code class="ruby">      OpenStruct.new({ name: Rails.application.class.parent_name, version: VERSION, id: 1, type: &#39;About&#39;, tos: CONFIG[&#39;terms_of_service&#39;], privacy_policy: CONFIG[&#39;privacy_policy&#39;] })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  field :me do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    type UserType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Information about the current user&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, _args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="23">
          <span class="hits">5</span>
          
          <code class="ruby">      ctx[:current_user]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  # Get team by id or subdomain</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    type TeamType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Information about the context team or the team from given id&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :id, types.ID</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="34">
          <span class="hits">4</span>
          
          <code class="ruby">      tid = args[&#39;id&#39;].to_i</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="35">
          <span class="hits">4</span>
          
          <code class="ruby">      if tid === 0 &amp;&amp; !ctx[:context_team].blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">        tid = ctx[:context_team].id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="38">
          <span class="hits">4</span>
          
          <code class="ruby">      GraphqlCrudOperations.load_if_can(Team, tid, ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  # Get public team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  field :public_team do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">    type PublicTeamType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Public information about the current team&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, _args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">      id = ctx[:context_team].blank? ? 0 : ctx[:context_team].id</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="50">
          <span class="hits">2</span>
          
          <code class="ruby">      Team.find(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">  field :project do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    type ProjectType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Information about a project, given its id and its team id&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :id, !types.ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="61">
          <span class="hits">2</span>
          
          <code class="ruby">      tid = ctx[:context_team].blank? ? 0 : ctx[:context_team].id</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="62">
          <span class="hits">2</span>
          
          <code class="ruby">      project = Project.where(id: args[&#39;id&#39;], team_id: tid).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="63">
          <span class="hits">2</span>
          
          <code class="ruby">      id = project.nil? ? 0 : project.id</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="64">
          <span class="hits">2</span>
          
          <code class="ruby">      GraphqlCrudOperations.load_if_can(Project, id, ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  field :media do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    type MediaType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Information about a media item. The argument should be given like this: &quot;media_id,project_id&quot;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :ids, !types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="75">
          <span class="hits">6</span>
          
          <code class="ruby">      mid, pid = args[&#39;ids&#39;].split(&#39;,&#39;).map(&amp;:to_i)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="76">
          <span class="hits">6</span>
          
          <code class="ruby">      tid = ctx[:context_team].blank? ? 0 : ctx[:context_team].id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="77">
          <span class="hits">6</span>
          
          <code class="ruby">      project = Project.where(id: pid, team_id: tid).last</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="78">
          <span class="hits">6</span>
          
          <code class="ruby">      pid = project.nil? ? 0 : project.id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="79">
          <span class="hits">6</span>
          
          <code class="ruby">      project_media = ProjectMedia.where(project_id: pid, media_id: mid).last</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="80">
          <span class="hits">6</span>
          
          <code class="ruby">      mid = project_media.nil? ? 0 : project_media.media_id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="81">
          <span class="hits">6</span>
          
          <code class="ruby">      media = GraphqlCrudOperations.load_if_can(Media, mid, ctx)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="82">
          <span class="hits">5</span>
          
          <code class="ruby">      media.project_id = pid if media</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="83">
          <span class="hits">5</span>
          
          <code class="ruby">      media</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  field :search do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="88">
          <span class="hits">1</span>
          
          <code class="ruby">    type CheckSearchType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">    description &#39;Search medias, The argument should be given like this: &quot;{\&quot;keyword\&quot;:\&quot;search keyword\&quot;}&quot;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">    argument :query, !types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (_obj, args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="94">
          <span class="hits">4</span>
          
          <code class="ruby">      CheckSearch.new(args[&#39;query&#39;], ctx[:context_team])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">  # Getters by ID</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="100">
          <span class="hits">1</span>
          
          <code class="ruby">  [:source, :user].each do |type|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="101">
          <span class="hits">2</span>
          
          <code class="ruby">    field type do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="102">
          <span class="hits">2</span>
          
          <code class="ruby">      type &quot;#{type.to_s.camelize}Type&quot;.constantize</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="103">
          <span class="hits">2</span>
          
          <code class="ruby">      description &quot;Information about the #{type} with given id&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="104">
          <span class="hits">2</span>
          
          <code class="ruby">      argument :id, !types.ID</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="105">
          <span class="hits">2</span>
          
          <code class="ruby">      resolve -&gt; (_obj, args, ctx) do</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="106">
          <span class="hits">4</span>
          
          <code class="ruby">        GraphqlCrudOperations.load_if_can(type.to_s.camelize.constantize, args[&#39;id&#39;], ctx)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="113a2258848ab5962e09ea18193f8737391a13e4">
  <div class="header">
    <h3>app/graph/types/root_level_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">RootLevelType = GraphQL::ObjectType.define do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;RootLevel&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Unassociated root object queries&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;RootLevel&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :comments, CommentType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      Comment.all_sorted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :project_sources, ProjectSourceType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">      ProjectSource.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :sources, SourceType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">      Source.order(&#39;created_at DESC&#39;).all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :team_users, TeamUserType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">      TeamUser.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :teams, TeamType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="30">
          <span class="hits">2</span>
          
          <code class="ruby">      Team.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :accounts, AccountType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">      Account.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :medias, MediaType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="40">
          <span class="hits">5</span>
          
          <code class="ruby">      Media.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :projects, ProjectType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="45">
          <span class="hits">3</span>
          
          <code class="ruby">      Project.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :users, UserType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="50">
          <span class="hits">3</span>
          
          <code class="ruby">      User.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :annotations, AnnotationType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">      Annotation.all_sorted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :tags, TagType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">      Tag.all_sorted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :statuses, StatusType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">      Status.all_sorted</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  connection :contacts, ContactType.connection_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(_object, _args, _ctx){</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">      Contact.all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="6caf93d3a3eff846209e8a82789b0e4e9c977e7b">
  <div class="header">
    <h3>app/graph/types/source_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>38</b> relevant lines. 
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">SourceType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Source&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Source type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Source&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :image, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :description, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :dbid, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :user_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :accounts, -&gt; { AccountType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="19">
          <span class="hits">18</span>
          
          <code class="ruby">      source.accounts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :project_sources, -&gt; { ProjectSourceType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="25">
          <span class="hits">18</span>
          
          <code class="ruby">      source.project_sources</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :projects, -&gt; { ProjectType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="31">
          <span class="hits">18</span>
          
          <code class="ruby">      source.projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :annotations, -&gt; { AnnotationType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="37">
          <span class="hits">18</span>
          
          <code class="ruby">      source.annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="41">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :medias, -&gt; { MediaType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="43">
          <span class="hits">18</span>
          
          <code class="ruby">      source.medias</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="47">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :collaborators, -&gt; { UserType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="49">
          <span class="hits">18</span>
          
          <code class="ruby">      source.collaborators</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :comments, -&gt; { CommentType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="54">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="55">
          <span class="hits">18</span>
          
          <code class="ruby">      source.comments</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="59">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :tags, -&gt; { TagType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(source, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="61">
          <span class="hits">18</span>
          
          <code class="ruby">      source.tags</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="65">
          <span class="hits">1</span>
          
          <code class="ruby">  instance_exec :source, &amp;GraphqlCrudOperations.field_verification_statuses</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5298730e0c53991c119cccb759f056e59b30872e">
  <div class="header">
    <h3>app/graph/types/status_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">StatusType = GraphqlCrudOperations.define_annotation_type(&#39;status&#39;, { status: &#39;str&#39; })</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5c144664968dfc0ede325f1e378e8edcfe4e489b">
  <div class="header">
    <h3>app/graph/types/tag_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>1</b> relevant lines. 
      <span class="green"><b>1</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">TagType = GraphqlCrudOperations.define_annotation_type(&#39;tag&#39;, { tag: &#39;str&#39; })</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="86263f6d83626f26d603930d03c5f31eecb85a15">
  <div class="header">
    <h3>app/graph/types/team_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>40</b> relevant lines. 
      <span class="green"><b>40</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">TeamType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;Team&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;Team type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;Team&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :archived, types.Boolean</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :private, types.Boolean</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :avatar, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :subdomain, !types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :description, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  field :dbid, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  field :members_count, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  field :get_slack_notifications_enabled, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  field :get_slack_webhook, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  field :get_slack_channel, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  field :pusher_channel, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  field :media_verification_statuses do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    type types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      team.verification_statuses(:media)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source_verification_statuses do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    type types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">      team.verification_statuses(:source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="40">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :team_users, -&gt; { TeamUserType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="42">
          <span class="hits">4</span>
          
          <code class="ruby">      team.team_users</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="46">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :users, -&gt; { UserType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="48">
          <span class="hits">4</span>
          
          <code class="ruby">      team.users</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :contacts, -&gt; { ContactType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="54">
          <span class="hits">4</span>
          
          <code class="ruby">      team.contacts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="58">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :projects, -&gt; { ProjectType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(team, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="60">
          <span class="hits">4</span>
          
          <code class="ruby">      team.recent_projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="59c3a54231ff82d5ce330be616008a1fee99b180">
  <div class="header">
    <h3>app/graph/types/team_user_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>20</b> relevant lines. 
      <span class="green"><b>20</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">TeamUserType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;TeamUser&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;TeamUser type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;TeamUser&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :updated_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :created_at, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :user_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :status, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :role, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  field :team do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    type TeamType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team_user, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="20">
          <span class="hits">3</span>
          
          <code class="ruby">      team_user.team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  field :user do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    type UserType</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (team_user, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="28">
          <span class="hits">3</span>
          
          <code class="ruby">      team_user.user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a87618d4cd26e612873db0edeb2c9bdcc113592b">
  <div class="header">
    <h3>app/graph/types/user_type.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">UserType = GraphqlCrudOperations.define_default_type do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  name &#39;User&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  description &#39;User type&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  interfaces [NodeIdentification.interface]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  field :id, field: GraphQL::Relay::GlobalIdField.new(&#39;User&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  field :email, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  field :provider, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  field :uuid, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  field :profile_image, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  field :login, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  field :name, types.String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  field :current_team_id, types.Int</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  field :permissions, types.String</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  field :source do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">    type SourceType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (user, _args, _ctx) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">      user.source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  field :current_team do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    type TeamType</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt; (user, _args, _ctx) do</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="27">
          <span class="hits">2</span>
          
          <code class="ruby">      user.current_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="31">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :teams, -&gt; { TeamType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(user, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">      user.teams</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="37">
          <span class="hits">2</span>
          
          <code class="ruby">  connection :team_users, -&gt; { TeamUserType.connection_type } do</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">    resolve -&gt;(user, _args, _ctx) {</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">      user.team_users</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="83e8e14d76ec514f749d39d08cfad3e9c717425a">
  <div class="header">
    <h3>app/mailers/application_mailer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>3</b> relevant lines. 
      <span class="green"><b>3</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApplicationMailer &lt; ActionMailer::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  default from: CONFIG[&#39;default_mail&#39;]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  layout &#39;mailer&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e3cf83716d4f1fb6b4cf6d1338e7407c9c9991fc">
  <div class="header">
    <h3>app/mailers/registration_mailer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RegistrationMailer &lt; ApplicationMailer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def welcome_email(user)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="5">
          <span class="hits">2</span>
          
          <code class="ruby">    @user = user</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="6">
          <span class="hits">2</span>
          
          <code class="ruby">    @url = CONFIG[&#39;checkdesk_client&#39;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="7">
          <span class="hits">2</span>
          
          <code class="ruby">    mail(to: @user.email, subject: &#39;New account for you on Check&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d6836e973872adbe02b9daf3f095f2b820310453">
  <div class="header">
    <h3>app/mailers/team_user_mailer.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>24</b> relevant lines. 
      <span class="green"><b>24</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TeamUserMailer &lt; ApplicationMailer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  layout nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def request_to_join(team, requestor, origin)</code>
        </li>
      
        <li class="covered" data-hits="327" data-linenumber="5">
          <span class="hits">327</span>
          
          <code class="ruby">    if team &amp;&amp; requestor</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="6">
          <span class="hits">325</span>
          
          <code class="ruby">      @team = team</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="7">
          <span class="hits">325</span>
          
          <code class="ruby">      @requestor = requestor</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="8">
          <span class="hits">325</span>
          
          <code class="ruby">      @url = origin.blank? ? &#39;&#39; : URI.join(origin, &quot;/members&quot;)</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="9">
          <span class="hits">325</span>
          
          <code class="ruby">      @handle = requestor.handle</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="10">
          <span class="hits">325</span>
          
          <code class="ruby">      recipients = team.recipients(requestor)</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="11">
          <span class="hits">325</span>
          
          <code class="ruby">      self.send_email_to_recipients(recipients, &quot;#{requestor.name} wants to join the #{team.name} team on Check&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def request_to_join_processed(team, requestor, accepted, origin)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="16">
          <span class="hits">4</span>
          
          <code class="ruby">    if team &amp;&amp; requestor &amp;&amp; !requestor.email.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="17">
          <span class="hits">4</span>
          
          <code class="ruby">      @team = team</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="18">
          <span class="hits">4</span>
          
          <code class="ruby">      @requestor = requestor</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="19">
          <span class="hits">4</span>
          
          <code class="ruby">      @accepted = accepted</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="20">
          <span class="hits">4</span>
          
          <code class="ruby">      @url = origin.blank? ? &#39;&#39; : URI.join(origin, &quot;/&quot;)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="21">
          <span class="hits">4</span>
          
          <code class="ruby">      Rails.logger.info &quot;Sending e-mail to #{requestor.email}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="22">
          <span class="hits">4</span>
          
          <code class="ruby">      status = accepted ? &quot;accepted&quot; : &quot;rejected&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="23">
          <span class="hits">4</span>
          
          <code class="ruby">      self.send_email_to_recipients(requestor.email, &quot;Your request to join #{team.name} on Check was #{status}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_email_to_recipients(recipients, subject)</code>
        </li>
      
        <li class="covered" data-hits="329" data-linenumber="30">
          <span class="hits">329</span>
          
          <code class="ruby">    unless recipients.empty?</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="31">
          <span class="hits">25</span>
          
          <code class="ruby">      Rails.logger.info &quot;Sending e-mail to #{recipients}&quot;</code>
        </li>
      
        <li class="covered" data-hits="25" data-linenumber="32">
          <span class="hits">25</span>
          
          <code class="ruby">      mail(to: recipients, subject: subject) if Rails.env.test?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1589d90639abc68633ccbc5c9693315bc2d870ad">
  <div class="header">
    <h3>app/models/ability.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>108</b> relevant lines. 
      <span class="green"><b>108</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Ability</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include CanCan::Ability</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(user, context_team)</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="5">
          <span class="hits">395</span>
          
          <code class="ruby">    alias_action :create, :update, :destroy, :to =&gt; :cud</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="6">
          <span class="hits">395</span>
          
          <code class="ruby">    @user = user ||= User.new</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="7">
          <span class="hits">395</span>
          
          <code class="ruby">    @context_team = context_team ||= @user.current_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    # Define User abilities</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="9">
          <span class="hits">395</span>
          
          <code class="ruby">    extra_perms_for_all_users</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="10">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.id</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="11">
          <span class="hits">395</span>
          
          <code class="ruby">      authenticated_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="13">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.role? :contributor, context_team</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="14">
          <span class="hits">319</span>
          
          <code class="ruby">      contributor_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="16">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.role? :journalist, context_team</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="17">
          <span class="hits">249</span>
          
          <code class="ruby">      journalist_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="19">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.role? :editor, context_team</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="20">
          <span class="hits">205</span>
          
          <code class="ruby">      editor_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="22">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.role? :owner, context_team</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="23">
          <span class="hits">174</span>
          
          <code class="ruby">      owner_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="25">
          <span class="hits">395</span>
          
          <code class="ruby">    if user.role? :admin, context_team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">      global_admin_perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def global_admin_perms</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    can :manage, :all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def owner_perms</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="37">
          <span class="hits">174</span>
          
          <code class="ruby">    can [:update, :destroy], User, :team_users =&gt; { :team_id =&gt; @context_team.id, role: [&#39;owner&#39;, &#39;editor&#39;, &#39;journalist&#39;, &#39;contributor&#39;] }</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="38">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, Team, :id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="39">
          <span class="hits">174</span>
          
          <code class="ruby">    can :create, TeamUser, :team_id =&gt; @context_team.id, role: [&#39;owner&#39;]</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="40">
          <span class="hits">174</span>
          
          <code class="ruby">    can :update, TeamUser do |obj|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="41">
          <span class="hits">5</span>
          
          <code class="ruby">      roles = %w[owner journalist contributor editor]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="42">
          <span class="hits">5</span>
          
          <code class="ruby">      user_role = obj.user.role @context_team</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="43">
          <span class="hits">5</span>
          
          <code class="ruby">      obj.team_id == @context_team.id and obj.user_id != @user.id and roles.include? obj.role and (roles.include? user_role or user_role.nil?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="45">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, Contact, :team_id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="46">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, Project, :team_id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="47">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, Media do |obj|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="48">
          <span class="hits">11</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="50">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, [ProjectMedia, ProjectSource] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="53">
          <span class="hits">174</span>
          
          <code class="ruby">    can :destroy, [Annotation, Comment, Tag, Status, Flag] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="54">
          <span class="hits">17</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="58">
          <span class="hits">1</span>
          
          <code class="ruby">  def editor_perms</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="59">
          <span class="hits">205</span>
          
          <code class="ruby">    can :update, User, :team_users =&gt; { :team_id =&gt; @context_team.id, role: [&#39;editor&#39;] }</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="60">
          <span class="hits">205</span>
          
          <code class="ruby">    can :update, Team, :id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="61">
          <span class="hits">205</span>
          
          <code class="ruby">    can :create, TeamUser, :team_id =&gt; @context_team.id, role: [&#39;editor&#39;]</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="62">
          <span class="hits">205</span>
          
          <code class="ruby">    can :update, TeamUser do |obj|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="63">
          <span class="hits">6</span>
          
          <code class="ruby">      roles = %w[editor journalist contributor]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">      user_role = obj.user.role @context_team</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">      obj.team_id == @context_team.id and obj.user_id != @user.id and roles.include? obj.role and (roles.include? user_role or user_role.nil?)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="67">
          <span class="hits">205</span>
          
          <code class="ruby">    can [:create, :update], Contact, :team_id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="68">
          <span class="hits">205</span>
          
          <code class="ruby">    can :update, Project, :team_id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="69">
          <span class="hits">205</span>
          
          <code class="ruby">    can [:create, :update], [ProjectMedia, ProjectSource] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="45" data-linenumber="70">
          <span class="hits">45</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="205" data-linenumber="72">
          <span class="hits">205</span>
          
          <code class="ruby">    can :update, [Comment, Flag, Annotation] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="73">
          <span class="hits">11</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  def journalist_perms</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="78">
          <span class="hits">249</span>
          
          <code class="ruby">    can :update, User, :team_users =&gt; { :team_id =&gt; @context_team.id, role: [&#39;journalist&#39;, &#39;contributor&#39;] }</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="79">
          <span class="hits">249</span>
          
          <code class="ruby">    can :create, TeamUser, :team_id =&gt; @context_team.id, role: [&#39;journalist&#39;, &#39;contributor&#39;]</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="80">
          <span class="hits">249</span>
          
          <code class="ruby">    can :create, Project, :team_id =&gt; @context_team.id</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="81">
          <span class="hits">249</span>
          
          <code class="ruby">    can :update, Project, :team_id =&gt; @context_team.id, :user_id =&gt; @user.id</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="82">
          <span class="hits">249</span>
          
          <code class="ruby">    can :update, Media do |obj|</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="83">
          <span class="hits">31</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="85">
          <span class="hits">249</span>
          
          <code class="ruby">    can :create, Flag do |flag|</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="86">
          <span class="hits">10</span>
          
          <code class="ruby">      flag.get_team.include? @context_team.id and (flag.flag.to_s == &#39;Mark as graphic&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="88">
          <span class="hits">249</span>
          
          <code class="ruby">    can :update, Flag do |flag|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="89">
          <span class="hits">2</span>
          
          <code class="ruby">      flag.get_team.include? @context_team.id and (flag.annotator_id.to_i == @user.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="91">
          <span class="hits">249</span>
          
          <code class="ruby">    can :create, [Status, Tag] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="92">
          <span class="hits">36</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  def contributor_perms</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="97">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, User, :id =&gt; @user.id</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="98">
          <span class="hits">319</span>
          
          <code class="ruby">    can :create, [Media, Account, Source, Comment, Embed]</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="99">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, Media, :user_id =&gt; @user.id</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="100">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, Media do |obj|</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="101">
          <span class="hits">37</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id and (obj.user_id == @user.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="103">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, [Account, Source]</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="104">
          <span class="hits">319</span>
          
          <code class="ruby">    can [:create, :update], ProjectSource do |obj|</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="105">
          <span class="hits">19</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id and (obj.source.user_id == @user.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="107">
          <span class="hits">319</span>
          
          <code class="ruby">    can :create, ProjectMedia do |obj|</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="108">
          <span class="hits">44</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="110">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, ProjectMedia do |obj|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="111">
          <span class="hits">14</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id and (obj.media.user_id == @user.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="113">
          <span class="hits">319</span>
          
          <code class="ruby">    can :update, Comment do |obj|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="114">
          <span class="hits">9</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id and (obj.annotator_id.to_i == @user.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="116">
          <span class="hits">319</span>
          
          <code class="ruby">    can :create, Flag do |flag|</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="117">
          <span class="hits">36</span>
          
          <code class="ruby">      flag.get_team.include? @context_team.id and ([&#39;Spam&#39;, &#39;Graphic content&#39;].include?flag.flag.to_s)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="119">
          <span class="hits">319</span>
          
          <code class="ruby">    can :create, Tag do |obj|</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="120">
          <span class="hits">31</span>
          
          <code class="ruby">      (obj.get_team.include? @context_team.id and obj.annotated_type === &#39;Media&#39; and obj.annotated.user_id.to_i === @user.id) or obj.annotated_type === &#39;Source&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="122">
          <span class="hits">319</span>
          
          <code class="ruby">    can :destroy, TeamUser do |obj|</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="123">
          <span class="hits">11</span>
          
          <code class="ruby">      obj.user_id === @user.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="124">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="319" data-linenumber="125">
          <span class="hits">319</span>
          
          <code class="ruby">    can :destroy, Tag do |obj|</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="126">
          <span class="hits">8</span>
          
          <code class="ruby">      obj.get_team.include? @context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  def authenticated_perms</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="131">
          <span class="hits">395</span>
          
          <code class="ruby">    can :create, Team</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="132">
          <span class="hits">395</span>
          
          <code class="ruby">    can :create, TeamUser, :user_id =&gt; @user.id, status: [&#39;member&#39;, &#39;requested&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">  # Extra permissions for all users</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">  def extra_perms_for_all_users</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="137">
          <span class="hits">395</span>
          
          <code class="ruby">    can :create, User</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="138">
          <span class="hits">395</span>
          
          <code class="ruby">    can :read, Team, :private =&gt; false</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="139">
          <span class="hits">395</span>
          
          <code class="ruby">    can :read, Team, :private =&gt; true, :team_users =&gt; { :user_id =&gt; @user.id, :status =&gt; &#39;member&#39; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">    # A @user can read a user if:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">    # 1) @user is the same as target user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    # 2) target user is a member of at least one public team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">    # 3) @user is a member of at least one same team as the target user</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="145">
          <span class="hits">395</span>
          
          <code class="ruby">    can :read, User do |obj|</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="146">
          <span class="hits">14</span>
          
          <code class="ruby">      @user.id == obj.id || obj.teams.where(&#39;teams.private&#39; =&gt; false).exists? || @user.is_a_colleague_of?(obj)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">    # A @user can read contact, project or team user if:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    # 1) team is private and @user is a member of that team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    # 2) team user is not private</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="152">
          <span class="hits">395</span>
          
          <code class="ruby">    can :read, [Contact, Project, TeamUser] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="153">
          <span class="hits">34</span>
          
          <code class="ruby">      team = obj.team</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="154">
          <span class="hits">34</span>
          
          <code class="ruby">      !team.private || @user.is_member_of?(team)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    # A @user can read any of those objects if:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby">    # 1) it&#39;s a source related to him/her or not related to any user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">    # 2) it&#39;s related to at least one public team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby">    # 3) it&#39;s related to a private team which the @user has access to</code>
        </li>
      
        <li class="covered" data-hits="395" data-linenumber="161">
          <span class="hits">395</span>
          
          <code class="ruby">    can :read, [Account, Source, Media, ProjectMedia, ProjectSource, Comment, Flag, Status, Tag, Embed] do |obj|</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="162">
          <span class="hits">105</span>
          
          <code class="ruby">      if obj.is_a?(Source) &amp;&amp; obj.respond_to?(:user_id)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="163">
          <span class="hits">13</span>
          
          <code class="ruby">        obj.user_id == @user.id || obj.user_id.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="165">
          <span class="hits">92</span>
          
          <code class="ruby">        team_ids = obj.get_team</code>
        </li>
      
        <li class="covered" data-hits="138" data-linenumber="166">
          <span class="hits">138</span>
          
          <code class="ruby">        teams = obj.respond_to?(:get_team_objects) ? obj.get_team_objects.reject{ |t| t.private } : Team.where(id: team_ids, private: false)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="167">
          <span class="hits">92</span>
          
          <code class="ruby">        if teams.empty?</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="168">
          <span class="hits">22</span>
          
          <code class="ruby">          TeamUser.where(user_id: @user.id, team_id: team_ids, status: &#39;member&#39;).exists?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="70" data-linenumber="170">
          <span class="hits">70</span>
          
          <code class="ruby">          teams.any?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d4a3209be737d9cf4863ca6d425dbaa916d3a4db">
  <div class="header">
    <h3>app/models/account.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>44</b> relevant lines. 
      <span class="green"><b>44</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Account &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include PenderData</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_paper_trail on: [:create, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :source</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :medias</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  has_annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :url</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :validate_pender_result, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :pender_result_is_a_profile, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :url_is_unique, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :set_pender_result_as_annotation, :create_source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def provider</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    self.data[&#39;provider&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="26">
          <span class="hits">2</span>
          
          <code class="ruby">    user_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="29">
          <span class="hits">1</span>
          
          <code class="ruby">  def source_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">    source = Source.where(name: value).last</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    source.nil? ? nil : source.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="35">
          <span class="hits">9</span>
          
          <code class="ruby">    s = self.source</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="36">
          <span class="hits">9</span>
          
          <code class="ruby">    s.get_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def data</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="40">
          <span class="hits">3</span>
          
          <code class="ruby">    em = self.annotations(&#39;embed&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="41">
          <span class="hits">3</span>
          
          <code class="ruby">    JSON.parse(em.embed)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_source</code>
        </li>
      
        <li class="covered" data-hits="304" data-linenumber="47">
          <span class="hits">304</span>
          
          <code class="ruby">    if self.source.nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="48">
          <span class="hits">5</span>
          
          <code class="ruby">      data = self.pender_data</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="49">
          <span class="hits">5</span>
          
          <code class="ruby">      source = Source.new</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="50">
          <span class="hits">5</span>
          
          <code class="ruby">      source.avatar = data[&#39;picture&#39;]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="51">
          <span class="hits">5</span>
          
          <code class="ruby">      source.name = data[&#39;title&#39;].blank? ? &#39;Untitled&#39; : data[&#39;title&#39;]</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="52">
          <span class="hits">5</span>
          
          <code class="ruby">      source.slogan = data[&#39;description&#39;].to_s</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="53">
          <span class="hits">5</span>
          
          <code class="ruby">      source.save!</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="54">
          <span class="hits">5</span>
          
          <code class="ruby">      self.source = source</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="55">
          <span class="hits">5</span>
          
          <code class="ruby">      self.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def pender_result_is_a_profile</code>
        </li>
      
        <li class="covered" data-hits="550" data-linenumber="60">
          <span class="hits">550</span>
          
          <code class="ruby">    errors.add(:base, &#39;Sorry, this is not a profile&#39;) if !self.pender_data.nil? &amp;&amp; self.pender_data[&#39;provider&#39;] != &#39;page&#39; &amp;&amp; self.pender_data[&#39;type&#39;] != &#39;profile&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_is_unique</code>
        </li>
      
        <li class="covered" data-hits="550" data-linenumber="64">
          <span class="hits">550</span>
          
          <code class="ruby">    existing = Account.where(url: self.url).where(&#39;source_id IS NOT NULL&#39;).first</code>
        </li>
      
        <li class="covered" data-hits="550" data-linenumber="65">
          <span class="hits">550</span>
          
          <code class="ruby">    unless existing.nil?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="66">
          <span class="hits">4</span>
          
          <code class="ruby">      errors.add(:base, &quot;Account with this URL exists and has source id #{existing.source_id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a56f1204bc7b1a193ada502b921f73e62eeaf24d">
  <div class="header">
    <h3>app/models/annotations/annotation.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>10</b> relevant lines. 
      <span class="green"><b>10</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Annotation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :cant_instantiate_abstract_class</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def load</code>
        </li>
      
        <li class="covered" data-hits="904" data-linenumber="7">
          <span class="hits">904</span>
          
          <code class="ruby">    begin</code>
        </li>
      
        <li class="covered" data-hits="904" data-linenumber="8">
          <span class="hits">904</span>
          
          <code class="ruby">      self.annotation_type.camelize.constantize.find(self.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    rescue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def cant_instantiate_abstract_class</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    raise &#39;You cannot instantiate this abstract class&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="d8958341f9603d50b8237a72f4019672ef7cc0a8">
  <div class="header">
    <h3>app/models/annotations/comment.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>38</b> relevant lines. 
      <span class="green"><b>38</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Comment</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :text, String, presence: true, mapping: { analyzer: &#39;hashtag&#39; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :text</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :extract_check_entities</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_slack on: :save,</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="10">
          <span class="hits">179</span>
          
          <code class="ruby">                 if: proc { |c| c.should_notify? },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">                 message: proc { |c| data = c.annotated.data(c.context); &quot;*#{c.current_user.name}* added a note on &lt;#{c.origin}/project/#{c.context_id}/media/#{c.annotated_id}|#{data[&#39;title&#39;]}&gt;\n&gt; #{c.text}&quot; },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">                 channel: proc { |c| c.context.setting(:slack_channel) || c.current_team.setting(:slack_channel) },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">                 webhook: proc { |c| c.current_team.setting(:slack_webhook) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="16">
          <span class="hits">5</span>
          
          <code class="ruby">    { text: self.text }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="20">
          <span class="hits">2</span>
          
          <code class="ruby">    user = User.where(email: value).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="21">
          <span class="hits">2</span>
          
          <code class="ruby">    user.nil? ? nil : user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def target_id_callback(value, mapping_ids)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract_check_urls</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="31">
          <span class="hits">179</span>
          
          <code class="ruby">    urls = []</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="32">
          <span class="hits">179</span>
          
          <code class="ruby">    team = self.context_type === &#39;Project&#39; ? self.context.team : nil</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="33">
          <span class="hits">179</span>
          
          <code class="ruby">    if team</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="34">
          <span class="hits">39</span>
          
          <code class="ruby">      words = self.text.to_s.split(/\s+/)</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="35">
          <span class="hits">39</span>
          
          <code class="ruby">      pattern = Regexp.new(CONFIG[&#39;checkdesk_client&#39;])</code>
        </li>
      
        <li class="covered" data-hits="39" data-linenumber="36">
          <span class="hits">39</span>
          
          <code class="ruby">      words.each do |word|</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="37">
          <span class="hits">52</span>
          
          <code class="ruby">        match = word.match(pattern)</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="38">
          <span class="hits">52</span>
          
          <code class="ruby">        if !match.nil? &amp;&amp; match[1] == team.subdomain</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="39">
          <span class="hits">2</span>
          
          <code class="ruby">          urls &lt;&lt; word</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="43">
          <span class="hits">179</span>
          
          <code class="ruby">    urls</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  # Supports only media for the time being</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def extract_check_entities</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="50">
          <span class="hits">179</span>
          
          <code class="ruby">    ids = []</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="51">
          <span class="hits">179</span>
          
          <code class="ruby">    self.extract_check_urls.each do |url|</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="52">
          <span class="hits">2</span>
          
          <code class="ruby">      match = url.match(/\/project\/([0-9]+)\/media\/([0-9]+)/)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="53">
          <span class="hits">2</span>
          
          <code class="ruby">      unless match.nil?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="54">
          <span class="hits">2</span>
          
          <code class="ruby">        pm = ProjectMedia.where(project_id: match[1], media_id: match[2]).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="55">
          <span class="hits">2</span>
          
          <code class="ruby">        ids &lt;&lt; pm.id unless pm.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="179" data-linenumber="58">
          <span class="hits">179</span>
          
          <code class="ruby">    self.entities = ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="8112d3e9da628f597358c46561ad5c73cb4fa314">
  <div class="header">
    <h3>app/models/annotations/embed.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Embed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :title, String, mapping: { analyzer: &#39;hashtag&#39; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :description, String, mapping: { analyzer: &#39;hashtag&#39; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :quote, String, mapping: { analyzer: &#39;hashtag&#39; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :embed, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :username, String</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :published_at, Integer</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :search_context, Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :validate_quote_for_media_with_empty_url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      title: self.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      description: self.description,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">      username: self.username,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">      published_at: self.published_at,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      quote: self.quote,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      embed: self.embed</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">    }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_quote_for_media_with_empty_url</code>
        </li>
      
        <li class="covered" data-hits="850" data-linenumber="29">
          <span class="hits">850</span>
          
          <code class="ruby">    unless self.annotated.nil?</code>
        </li>
      
        <li class="covered" data-hits="846" data-linenumber="30">
          <span class="hits">846</span>
          
          <code class="ruby">      if self.annotated_type == &#39;Media&#39; and self.annotated.url.blank? and self.quote.blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:base, &quot;quote can&#39;t be blank&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="57496f9a6466dcc2909442d03bb0aa9eabb77f4c">
  <div class="header">
    <h3>app/models/annotations/flag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Flag</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :flag, String, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :flag</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :annotated_type, included: { values: [&#39;Media&#39;, nil] }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :flag, included: { values: [&#39;Spam&#39;, &#39;Graphic content&#39;, &#39;Needing fact-checking&#39;, &#39;Needing deletion&#39;, &#39;Follow story&#39;, &#39;Mark as graphic&#39;] }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    { flag: self.flag }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="15">
          <span class="hits">2</span>
          
          <code class="ruby">    user = User.where(email: value).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="16">
          <span class="hits">2</span>
          
          <code class="ruby">    user.nil? ? nil : user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def target_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def flag_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">    flags = Hash[</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      &#39;spam&#39; =&gt; &#39;Spam&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      &#39;graphic_journalist&#39; =&gt; &#39;Graphic content&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">      &#39;factcheck_journalist&#39; =&gt; &#39;Needing fact-checking&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">      &#39;graphic&#39; =&gt; &#39;Graphic content&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">      &#39;factcheck&#39; =&gt; &#39;Needing fact-checking&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      &#39;delete&#39; =&gt; &#39;Needing deletion&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      &#39;follow_story&#39; =&gt; &#39;Follow story&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    ]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="33">
          <span class="hits">2</span>
          
          <code class="ruby">    flags[value].nil? ? value : flags[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="fc5a30c5a70cc0e37030606b7f0bea9119d8a4af">
  <div class="header">
    <h3>app/models/annotations/status.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>53</b> relevant lines. 
      <span class="green"><b>53</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Status</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :status, String, presence: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :status</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :annotated_type, included: { values: [&#39;Media&#39;, &#39;Source&#39;, nil] }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :status_is_valid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_slack on: :save,</code>
        </li>
      
        <li class="covered" data-hits="282" data-linenumber="11">
          <span class="hits">282</span>
          
          <code class="ruby">                 if: proc { |s| s.should_notify? },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">                 message: proc { |s| data = s.annotated.data(s.context); &quot;*#{s.current_user.name}* changed the verification status on &lt;#{s.origin}/project/#{s.context_id}/media/#{s.annotated_id}|#{data[&#39;title&#39;]}&gt; from *#{s.id_to_label(s.previous_annotated_status)}* to *#{s.id_to_label(s.status)}*&quot; },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="13">
          <span class="hits">2</span>
          
          <code class="ruby">                 channel: proc { |s| s.context.setting(:slack_channel) || s.current_team.setting(:slack_channel) },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="14">
          <span class="hits">2</span>
          
          <code class="ruby">                 webhook: proc { |s| s.current_team.setting(:slack_webhook) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :store_previous_status, :normalize_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.core_verification_statuses(annotated_type)</code>
        </li>
      
        <li class="covered" data-hits="749" data-linenumber="19">
          <span class="hits">749</span>
          
          <code class="ruby">    core_statuses = YAML.load_file(File.join(Rails.root, &#39;config&#39;, &#39;core_statuses.yml&#39;))</code>
        </li>
      
        <li class="covered" data-hits="749" data-linenumber="20">
          <span class="hits">749</span>
          
          <code class="ruby">    key = &quot;#{annotated_type.upcase}_CORE_VERIFICATION_STATUSES&quot;</code>
        </li>
      
        <li class="covered" data-hits="749" data-linenumber="21">
          <span class="hits">749</span>
          
          <code class="ruby">    statuses = core_statuses.has_key?(key) ? core_statuses[key] : [{ id: &#39;undetermined&#39;, label: &#39;Undetermined&#39;, description: &#39;Undetermined&#39;, style: &#39;&#39; }]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      label: &#39;Status&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">      default: &#39;undetermined&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      statuses: statuses</code>
        </li>
      
        <li class="covered" data-hits="749" data-linenumber="27">
          <span class="hits">749</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def store_previous_status</code>
        </li>
      
        <li class="covered" data-hits="289" data-linenumber="31">
          <span class="hits">289</span>
          
          <code class="ruby">    self.previous_annotated_status = self.annotated.last_status(self.context) if self.annotated.respond_to?(:last_status)</code>
        </li>
      
        <li class="covered" data-hits="289" data-linenumber="32">
          <span class="hits">289</span>
          
          <code class="ruby">    self.previous_annotated_status ||= Status.default_id(self.annotated, self.context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def previous_annotated_status</code>
        </li>
      
        <li class="covered" data-hits="291" data-linenumber="36">
          <span class="hits">291</span>
          
          <code class="ruby">    @previous_annotated_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def previous_annotated_status=(status)</code>
        </li>
      
        <li class="covered" data-hits="283" data-linenumber="40">
          <span class="hits">283</span>
          
          <code class="ruby">    @previous_annotated_status = status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="44">
          <span class="hits">2</span>
          
          <code class="ruby">    { status: self.status }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">    user = User.where(email: value).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">    user.nil? ? nil : user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="52">
          <span class="hits">1</span>
          
          <code class="ruby">  def target_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="56">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotated_type_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">    value.camelize</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def normalize_status</code>
        </li>
      
        <li class="covered" data-hits="289" data-linenumber="61">
          <span class="hits">289</span>
          
          <code class="ruby">    self.status = self.status.tr(&#39; &#39;, &#39;_&#39;).downcase unless self.status.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="64">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.default_id(annotated, context = nil)</code>
        </li>
      
        <li class="covered" data-hits="458" data-linenumber="65">
          <span class="hits">458</span>
          
          <code class="ruby">    return nil if annotated.nil?</code>
        </li>
      
        <li class="covered" data-hits="454" data-linenumber="66">
          <span class="hits">454</span>
          
          <code class="ruby">    statuses = Status.possible_values(annotated, context)</code>
        </li>
      
        <li class="covered" data-hits="454" data-linenumber="67">
          <span class="hits">454</span>
          
          <code class="ruby">    statuses[:default].blank? ? statuses[:statuses].first[:id] : statuses[:default]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.possible_values(annotated, context = nil)</code>
        </li>
      
        <li class="covered" data-hits="745" data-linenumber="71">
          <span class="hits">745</span>
          
          <code class="ruby">    type = annotated.class.name</code>
        </li>
      
        <li class="covered" data-hits="745" data-linenumber="72">
          <span class="hits">745</span>
          
          <code class="ruby">    statuses = Status.core_verification_statuses(type)</code>
        </li>
      
        <li class="covered" data-hits="745" data-linenumber="73">
          <span class="hits">745</span>
          
          <code class="ruby">    getter = &quot;get_#{type.downcase}_verification_statuses&quot;</code>
        </li>
      
        <li class="covered" data-hits="745" data-linenumber="74">
          <span class="hits">745</span>
          
          <code class="ruby">    statuses = context.team.send(getter) if context &amp;&amp; context.respond_to?(:team) &amp;&amp; context.team &amp;&amp; context.team.send(getter)</code>
        </li>
      
        <li class="covered" data-hits="745" data-linenumber="75">
          <span class="hits">745</span>
          
          <code class="ruby">    statuses</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  def id_to_label(id)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="79">
          <span class="hits">6</span>
          
          <code class="ruby">    values = Status.possible_values(self.annotated, self.context)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="80">
          <span class="hits">30</span>
          
          <code class="ruby">    values[:statuses].select{ |s| s[:id] === id }.first[:label]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="85">
          <span class="hits">1</span>
          
          <code class="ruby">  def status_is_valid</code>
        </li>
      
        <li class="covered" data-hits="289" data-linenumber="86">
          <span class="hits">289</span>
          
          <code class="ruby">    if !self.annotated_type.blank?</code>
        </li>
      
        <li class="covered" data-hits="285" data-linenumber="87">
          <span class="hits">285</span>
          
          <code class="ruby">      values = Status.possible_values(self.annotated, self.context)</code>
        </li>
      
        <li class="covered" data-hits="1695" data-linenumber="88">
          <span class="hits">1695</span>
          
          <code class="ruby">      errors.add(:base, &#39;Status not valid&#39;) unless values[:statuses].collect{ |s| s[:id] }.include?(self.status)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f5cadf1f2c0488fee9307824c1ab4f84fe7e5068">
  <div class="header">
    <h3>app/models/annotations/tag.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>19</b> relevant lines. 
      <span class="green"><b>19</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Tag</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  include AnnotationBase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :tag, String, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  attribute :full_tag, String, presence: true, mapping: { index: &#39;not_analyzed&#39; }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :tag</code>
        </li>
      
        <li class="covered" data-hits="90" data-linenumber="8">
          <span class="hits">90</span>
          
          <code class="ruby">  validates :tag, uniqueness: { fields: [:annotated_type, :annotated_id, :context_type, :context_id] }, if: lambda { |t| t.id.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :normalize_tag, :store_full_tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="13">
          <span class="hits">5</span>
          
          <code class="ruby">    { tag: self.tag }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="17">
          <span class="hits">2</span>
          
          <code class="ruby">    user = User.where(email: value).last</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="18">
          <span class="hits">2</span>
          
          <code class="ruby">    user.nil? ? nil : user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def target_id_callback(value, mapping_ids)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def normalize_tag</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="28">
          <span class="hits">89</span>
          
          <code class="ruby">    self.tag = self.tag.gsub(/^#/, &#39;&#39;) unless self.tag.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def store_full_tag</code>
        </li>
      
        <li class="covered" data-hits="89" data-linenumber="32">
          <span class="hits">89</span>
          
          <code class="ruby">    self.full_tag = self.tag</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="12f3a743395a5763d8cff3db7fe8339e32e240e0">
  <div class="header">
    <h3>app/models/api_key.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>16</b> relevant lines. 
      <span class="green"><b>16</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApiKey &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :access_token, :expire_at</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_uniqueness_of :access_token</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :generate_access_token, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :calculate_expiration_date, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  # Reimplement this method in your application</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.applications</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="12">
          <span class="hits">6</span>
          
          <code class="ruby">    [nil]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="15">
          <span class="hits">10</span>
          
          <code class="ruby">  validates :application, inclusion: { in: proc { ApiKey.applications } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  def generate_access_token</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="20">
          <span class="hits">9</span>
          
          <code class="ruby">    loop do</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="21">
          <span class="hits">9</span>
          
          <code class="ruby">      self.access_token = SecureRandom.hex</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="22">
          <span class="hits">9</span>
          
          <code class="ruby">      break unless ApiKey.where(access_token: access_token).exists?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def calculate_expiration_date</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="27">
          <span class="hits">9</span>
          
          <code class="ruby">    self.expire_at = Time.now.since(30.days)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7f985d79dadc651cdebf7e9693a510a08b984513">
  <div class="header">
    <h3>app/models/bot.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>6</b> relevant lines. 
      <span class="green"><b>6</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Bot &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :name, :avatar</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :avatar, ImageUploader</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def profile_image</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    CONFIG[&#39;checkdesk_base_url&#39;] + self.avatar.url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="bbcb987bb5d3b5ee1044844318eb3ce9b7b976a8">
  <div class="header">
    <h3>app/models/concerns/annotation_base.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>217</b> relevant lines. 
      <span class="green"><b>217</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module AnnotationBase</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  module Association</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">      base.send :extend, ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">      def define_annotators_method</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="11">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :annotators do |context=nil|</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="12">
          <span class="hits">31</span>
          
          <code class="ruby">          query = self.annotation_query(context)</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="13">
          <span class="hits">31</span>
          
          <code class="ruby">          query[:bool][:must] &lt;&lt; { match: { annotator_type: &#39;User&#39; } }</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="14">
          <span class="hits">31</span>
          
          <code class="ruby">          aggs = { g: { terms: { field: :annotator_id } } }</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="15">
          <span class="hits">31</span>
          
          <code class="ruby">          annotators = []</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="16">
          <span class="hits">31</span>
          
          <code class="ruby">          Annotation.search(query: query, aggs: aggs).response[&#39;aggregations&#39;][&#39;g&#39;][&#39;buckets&#39;].each do |result|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">            # result[&#39;doc_count&#39;] is the number of annotations by this user</code>
        </li>
      
        <li class="covered" data-hits="24" data-linenumber="18">
          <span class="hits">24</span>
          
          <code class="ruby">            annotators &lt;&lt; User.find(result[&#39;key&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="20">
          <span class="hits">31</span>
          
          <code class="ruby">          annotators</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      def has_annotations</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="25">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :annotation_query do |type=nil, context=nil|</code>
        </li>
      
        <li class="covered" data-hits="997" data-linenumber="26">
          <span class="hits">997</span>
          
          <code class="ruby">          matches = [{ match: { annotated_type: self.class.name } }, { match: { annotated_id: self.id.to_s } }]</code>
        </li>
      
        <li class="covered" data-hits="997" data-linenumber="27">
          <span class="hits">997</span>
          
          <code class="ruby">          if context.kind_of?(ActiveRecord::Base)</code>
        </li>
      
        <li class="covered" data-hits="281" data-linenumber="28">
          <span class="hits">281</span>
          
          <code class="ruby">            matches &lt;&lt; { match: { context_type: context.class.name } }</code>
        </li>
      
        <li class="covered" data-hits="281" data-linenumber="29">
          <span class="hits">281</span>
          
          <code class="ruby">            matches &lt;&lt; { match: { context_id: context.id.to_s } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="covered" data-hits="997" data-linenumber="31">
          <span class="hits">997</span>
          
          <code class="ruby">          matches &lt;&lt; { terms: { annotation_type: [*type] } } unless type.nil?</code>
        </li>
      
        <li class="covered" data-hits="997" data-linenumber="32">
          <span class="hits">997</span>
          
          <code class="ruby">          { bool: { must: matches } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="35">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :annotation_relation do |type=nil, context=nil|</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="36">
          <span class="hits">966</span>
          
          <code class="ruby">          query = self.annotation_query(type, context)</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="37">
          <span class="hits">966</span>
          
          <code class="ruby">          params = { query: query, sort: [{ created_at: { order: &#39;desc&#39; }}, &#39;_score&#39;] }</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="38">
          <span class="hits">966</span>
          
          <code class="ruby">          params[:filter] = { missing: { field: &#39;context_id&#39; } } if context === &#39;none&#39;</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="39">
          <span class="hits">966</span>
          
          <code class="ruby">          params[:filter] = { exists: { field: &#39;context_id&#39; } } if context === &#39;some&#39;</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="40">
          <span class="hits">966</span>
          
          <code class="ruby">          ElasticsearchRelation.new(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="43">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :annotations do |type=nil, context=nil|</code>
        </li>
      
        <li class="covered" data-hits="953" data-linenumber="44">
          <span class="hits">953</span>
          
          <code class="ruby">          self.annotation_relation(type, context).all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="47">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :annotations_count do |type=nil, context=nil|</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">          self.annotation_relation(type, context).count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="51">
          <span class="hits">8</span>
          
          <code class="ruby">        define_method :add_annotation do |annotation|</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="52">
          <span class="hits">40</span>
          
          <code class="ruby">          annotation.annotated = self</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="53">
          <span class="hits">40</span>
          
          <code class="ruby">          annotation.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="56">
          <span class="hits">8</span>
          
          <code class="ruby">        define_annotators_method</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="61">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="62">
          <span class="hits">6</span>
          
          <code class="ruby">    include CheckdeskElasticSearchModel</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="63">
          <span class="hits">6</span>
          
          <code class="ruby">    include ActiveModel::Validations</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="64">
          <span class="hits">6</span>
          
          <code class="ruby">    include PaperTrail::Model</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="65">
          <span class="hits">6</span>
          
          <code class="ruby">    include CheckdeskPermissions</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="66">
          <span class="hits">6</span>
          
          <code class="ruby">    include CheckdeskNotifications::Slack</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="67">
          <span class="hits">6</span>
          
          <code class="ruby">    include CheckdeskNotifications::Pusher</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="69">
          <span class="hits">6</span>
          
          <code class="ruby">    index_name CONFIG[&#39;elasticsearch_index&#39;].blank? ? [Rails.application.engine_name, Rails.env, &#39;annotations&#39;].join(&#39;_&#39;) : CONFIG[&#39;elasticsearch_index&#39;]</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="70">
          <span class="hits">6</span>
          
          <code class="ruby">    document_type &#39;annotation&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="72">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :annotation_type, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="73">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :version_index, Integer</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="74">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :annotated_type, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="75">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :annotated_id, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="76">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :context_type, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="77">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :context_id, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="78">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :annotator_type, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="79">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :annotator_id, String</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="80">
          <span class="hits">6</span>
          
          <code class="ruby">    attribute :entities, Array</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="82">
          <span class="hits">6</span>
          
          <code class="ruby">    notifies_pusher on: :save,</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="83">
          <span class="hits">1433</span>
          
          <code class="ruby">                    if: proc { |a| a.annotated_type === &#39;Media&#39; &amp;&amp; a.context_type === &#39;Project&#39; },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">                    event: &#39;media_updated&#39;,</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="85">
          <span class="hits">336</span>
          
          <code class="ruby">                    targets: proc { |a| [a.context, a.annotated] },</code>
        </li>
      
        <li class="covered" data-hits="336" data-linenumber="86">
          <span class="hits">336</span>
          
          <code class="ruby">                    data: proc { |a| a.to_json }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="88">
          <span class="hits">6</span>
          
          <code class="ruby">    before_validation :set_type_and_event, :set_annotator</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="90">
          <span class="hits">6</span>
          
          <code class="ruby">    has_paper_trail on: [:update], save_changes: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="92">
          <span class="hits">6</span>
          
          <code class="ruby">    after_save do</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="93">
          <span class="hits">1433</span>
          
          <code class="ruby">      Annotation.gateway.client.indices.refresh</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="94">
          <span class="hits">1433</span>
          
          <code class="ruby">      self.send(:record_update, true) unless self.attribute_changed?(:version_index)</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="95">
          <span class="hits">1433</span>
          
          <code class="ruby">      reset_changes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="98">
          <span class="hits">6</span>
          
          <code class="ruby">    before_save :check_ability, :changes</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="99">
          <span class="hits">6</span>
          
          <code class="ruby">    before_destroy :check_destroy_ability</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="103">
          <span class="hits">1</span>
          
          <code class="ruby">    def has_many(name, scope = nil, options = {}, &amp;extension)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">      # Do nothing... instead, we are going to generate each collection we need</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="106">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="107">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_commit(*args, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="108">
          
          
          <code class="ruby">      # Nothing - there is no commit in ElasticSearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">    def after_rollback(*args, &amp;block)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">      # Nothing - there is no rollback in ElasticSearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    # We don&#39;t have associations, so we don&#39;t need it</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">    def reflect_on_all_associations(_macro = nil)</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="117">
          <span class="hits">6</span>
          
          <code class="ruby">      []</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="120">
          <span class="hits">1</span>
          
          <code class="ruby">    def column_names</code>
        </li>
      
        <li class="covered" data-hits="9322" data-linenumber="121">
          <span class="hits">9322</span>
          
          <code class="ruby">      self.attribute_set.to_a.map(&amp;:name)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="123">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="124">
          <span class="hits">1</span>
          
          <code class="ruby">    def columns_hash</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="125">
          <span class="hits">5</span>
          
          <code class="ruby">      hash = {}</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="126">
          <span class="hits">5</span>
          
          <code class="ruby">      self.attribute_set.to_a.each do |a|</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="127">
          <span class="hits">67</span>
          
          <code class="ruby">        name = a.name.to_s</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="128">
          <span class="hits">67</span>
          
          <code class="ruby">        type = a.type.to_s.gsub(&#39;Axiom::Types::&#39;, &#39;&#39;).downcase.to_sym</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="129">
          <span class="hits">67</span>
          
          <code class="ruby">        type = :datetime if type === :time</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="130">
          <span class="hits">67</span>
          
          <code class="ruby">        hash[name] = OpenStruct.new({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">          name: name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">          type: type</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">        })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="135">
          <span class="hits">5</span>
          
          <code class="ruby">      hash</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="138">
          <span class="hits">1</span>
          
          <code class="ruby">    def columns</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="139">
          <span class="hits">5</span>
          
          <code class="ruby">      objs = []</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="140">
          <span class="hits">5</span>
          
          <code class="ruby">      self.attribute_set.to_a.each do |a|</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">        objs &lt;&lt; OpenStruct.new({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">          name: a.name.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">          sql_type: a.type.to_s.gsub(&#39;Axiom::Types::&#39;, &#39;&#39;)</code>
        </li>
      
        <li class="covered" data-hits="67" data-linenumber="144">
          <span class="hits">67</span>
          
          <code class="ruby">        })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="146">
          <span class="hits">5</span>
          
          <code class="ruby">      objs</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="147">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="148">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">    def abstract_class?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="150">
          <span class="hits">5</span>
          
          <code class="ruby">      false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">    def delete_all</code>
        </li>
      
        <li class="covered" data-hits="592" data-linenumber="154">
          <span class="hits">592</span>
          
          <code class="ruby">      self.delete_index</code>
        </li>
      
        <li class="covered" data-hits="592" data-linenumber="155">
          <span class="hits">592</span>
          
          <code class="ruby">      self.create_index</code>
        </li>
      
        <li class="covered" data-hits="592" data-linenumber="156">
          <span class="hits">592</span>
          
          <code class="ruby">      sleep 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="157">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="158">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="159">
          <span class="hits">1</span>
          
          <code class="ruby">    def all_sorted(order = &#39;asc&#39;, field = &#39;created_at&#39;)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="160">
          <span class="hits">5</span>
          
          <code class="ruby">      type = self.name.parameterize</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="161">
          <span class="hits">5</span>
          
          <code class="ruby">      query = type === &#39;annotation&#39; ? { match_all: {} } : { bool: { must: [{ match: { annotation_type: type } }] } }</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="162">
          <span class="hits">5</span>
          
          <code class="ruby">      self.search(query: query, sort: [{ field =&gt; { order: order }}, &#39;_score&#39;], size: 10000).results</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">    def length</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="166">
          <span class="hits">66</span>
          
          <code class="ruby">      type = self.name.parameterize</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="167">
          <span class="hits">66</span>
          
          <code class="ruby">      self.count({ query: { bool: { must: [{ match: { annotation_type: type } }] } } })</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="169">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="170">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="171">
          <span class="hits">1</span>
          
          <code class="ruby">  def versions(options = {})</code>
        </li>
      
        <li class="covered" data-hits="3002" data-linenumber="172">
          <span class="hits">3002</span>
          
          <code class="ruby">    PaperTrail::Version.where(options).where(item_type: self.class.to_s, item_id: self.id).order(&#39;id ASC&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="175">
          <span class="hits">1</span>
          
          <code class="ruby">  def changed</code>
        </li>
      
        <li class="covered" data-hits="12175" data-linenumber="176">
          <span class="hits">12175</span>
          
          <code class="ruby">    self.changes.keys</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">  def changed_attributes</code>
        </li>
      
        <li class="covered" data-hits="1425" data-linenumber="180">
          <span class="hits">1425</span>
          
          <code class="ruby">    ca = {}</code>
        </li>
      
        <li class="covered" data-hits="1425" data-linenumber="181">
          <span class="hits">1425</span>
          
          <code class="ruby">    self.changed.each do |key|</code>
        </li>
      
        <li class="covered" data-hits="9317" data-linenumber="182">
          <span class="hits">9317</span>
          
          <code class="ruby">      ca[key] = self.changes[key][0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1425" data-linenumber="184">
          <span class="hits">1425</span>
          
          <code class="ruby">    ca</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">  def changes</code>
        </li>
      
        <li class="covered" data-hits="24350" data-linenumber="188">
          <span class="hits">24350</span>
          
          <code class="ruby">    unless @changes</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="189">
          <span class="hits">1433</span>
          
          <code class="ruby">      changed = self.attributes</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="190">
          <span class="hits">1433</span>
          
          <code class="ruby">      unchanged = self.id.nil? ? {} : self.class.find(self.id).attributes</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="191">
          <span class="hits">1433</span>
          
          <code class="ruby">      @changes = {}</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="192">
          <span class="hits">1433</span>
          
          <code class="ruby">      changed.each do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="23808" data-linenumber="193">
          <span class="hits">23808</span>
          
          <code class="ruby">        next if [:created_at, :updated_at].include?(k)</code>
        </li>
      
        <li class="covered" data-hits="20942" data-linenumber="194">
          <span class="hits">20942</span>
          
          <code class="ruby">        @changes[k] = [unchanged[k], v] unless unchanged[k] == v</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="24350" data-linenumber="197">
          <span class="hits">24350</span>
          
          <code class="ruby">    @changes</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="200">
          <span class="hits">1</span>
          
          <code class="ruby">  def attribute_changed?(attr)</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="201">
          <span class="hits">1433</span>
          
          <code class="ruby">    self.changed.map(&amp;:to_sym).include?(attr.to_sym)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="204">
          <span class="hits">1</span>
          
          <code class="ruby">  def attribute_names</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="205">
          <span class="hits">5</span>
          
          <code class="ruby">    self.class.column_names</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="208">
          <span class="hits">1</span>
          
          <code class="ruby">  def has_attribute?(attr)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="209">
          <span class="hits">5</span>
          
          <code class="ruby">    self.attribute_names.include?(attr)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="211">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="212">
          <span class="hits">1</span>
          
          <code class="ruby">  def revert(steps = 1, should_save = false)</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="213">
          <span class="hits">38</span>
          
          <code class="ruby">    current_version = self.version_index.blank? ? (self.versions.size - 1) : self.version_index.to_i</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="214">
          <span class="hits">38</span>
          
          <code class="ruby">    new_version = current_version - steps</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="215">
          <span class="hits">38</span>
          
          <code class="ruby">    if new_version &gt;= 0 &amp;&amp; new_version &lt; self.versions.size</code>
        </li>
      
        <li class="covered" data-hits="428" data-linenumber="216">
          <span class="hits">428</span>
          
          <code class="ruby">      object = JSON.parse(self.versions[new_version].object).reject{ |k, _v| [:updated_at, :created_at].include?(k.to_sym) }.merge({ version_index: new_version })</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="217">
          <span class="hits">30</span>
          
          <code class="ruby">      objchanges = JSON.parse(self.versions[new_version].object_changes)</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="218">
          <span class="hits">30</span>
          
          <code class="ruby">      object.each do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="368" data-linenumber="219">
          <span class="hits">368</span>
          
          <code class="ruby">        self.send(&quot;#{k}=&quot;, v)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="220">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="221">
          <span class="hits">30</span>
          
          <code class="ruby">      objchanges.each do |k, v|</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="222">
          <span class="hits">62</span>
          
          <code class="ruby">        self.send(&quot;#{k}=&quot;, v[1])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="223">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="30" data-linenumber="224">
          <span class="hits">30</span>
          
          <code class="ruby">      self.save if should_save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="38" data-linenumber="226">
          <span class="hits">38</span>
          
          <code class="ruby">    self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="227">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="228">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="229">
          <span class="hits">1</span>
          
          <code class="ruby">  def revert_and_save(steps = 1)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="230">
          <span class="hits">8</span>
          
          <code class="ruby">    self.reload</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="231">
          <span class="hits">8</span>
          
          <code class="ruby">    self.revert(steps, true)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="233">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="234">
          <span class="hits">1</span>
          
          <code class="ruby">  def source</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="235">
          <span class="hits">9</span>
          
          <code class="ruby">    self.annotated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="236">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="237">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="238">
          <span class="hits">1</span>
          
          <code class="ruby">  def media</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="239">
          <span class="hits">8</span>
          
          <code class="ruby">    self.annotated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="240">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="241">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="242">
          <span class="hits">1</span>
          
          <code class="ruby">  def project</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="243">
          <span class="hits">4</span>
          
          <code class="ruby">    self.annotated</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="244">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="246">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotated</code>
        </li>
      
        <li class="covered" data-hits="2733" data-linenumber="247">
          <span class="hits">2733</span>
          
          <code class="ruby">    self.load_polymorphic(&#39;annotated&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="249">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="250">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotated=(obj)</code>
        </li>
      
        <li class="covered" data-hits="1150" data-linenumber="251">
          <span class="hits">1150</span>
          
          <code class="ruby">    self.set_polymorphic(&#39;annotated&#39;, obj) unless obj.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="252">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="254">
          <span class="hits">1</span>
          
          <code class="ruby">  def context</code>
        </li>
      
        <li class="covered" data-hits="1316" data-linenumber="255">
          <span class="hits">1316</span>
          
          <code class="ruby">    self.load_polymorphic(&#39;context&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="258">
          <span class="hits">1</span>
          
          <code class="ruby">  def context=(obj)</code>
        </li>
      
        <li class="covered" data-hits="503" data-linenumber="259">
          <span class="hits">503</span>
          
          <code class="ruby">    self.set_polymorphic(&#39;context&#39;, obj) unless obj.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="262">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator</code>
        </li>
      
        <li class="covered" data-hits="1468" data-linenumber="263">
          <span class="hits">1468</span>
          
          <code class="ruby">    self.load_polymorphic(&#39;annotator&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="264">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="265">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="266">
          <span class="hits">1</span>
          
          <code class="ruby">  def annotator=(obj)</code>
        </li>
      
        <li class="covered" data-hits="1097" data-linenumber="267">
          <span class="hits">1097</span>
          
          <code class="ruby">    self.set_polymorphic(&#39;annotator&#39;, obj) unless obj.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="268">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="269">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="270">
          
          
          <code class="ruby">  # Overwrite in the annotation type and expose the specific fields of that type</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="271">
          <span class="hits">1</span>
          
          <code class="ruby">  def content</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="272">
          <span class="hits">1</span>
          
          <code class="ruby">    {}.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="273">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="274">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="275">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user</code>
        </li>
      
        <li class="covered" data-hits="2240" data-linenumber="276">
          <span class="hits">2240</span>
          
          <code class="ruby">    @current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="277">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="278">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="279">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_user=(user)</code>
        </li>
      
        <li class="covered" data-hits="171" data-linenumber="280">
          <span class="hits">171</span>
          
          <code class="ruby">    @current_user = user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="281">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="282">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="283">
          <span class="hits">1</span>
          
          <code class="ruby">  def context_team</code>
        </li>
      
        <li class="covered" data-hits="41" data-linenumber="284">
          <span class="hits">41</span>
          
          <code class="ruby">    @context_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="285">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="286">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="287">
          <span class="hits">1</span>
          
          <code class="ruby">  def context_team=(team)</code>
        </li>
      
        <li class="covered" data-hits="130" data-linenumber="288">
          <span class="hits">130</span>
          
          <code class="ruby">    @context_team = team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="289">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="290">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="291">
          <span class="hits">1</span>
          
          <code class="ruby">  def origin</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="292">
          <span class="hits">4</span>
          
          <code class="ruby">    @origin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="293">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="294">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="295">
          <span class="hits">1</span>
          
          <code class="ruby">  def origin=(origin)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="296">
          <span class="hits">8</span>
          
          <code class="ruby">    @origin = origin</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="297">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="298">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="299">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_annotation?</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="300">
          <span class="hits">11</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="301">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="302">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="303">
          <span class="hits">1</span>
          
          <code class="ruby">  def ==(annotation)</code>
        </li>
      
        <li class="covered" data-hits="19" data-linenumber="304">
          <span class="hits">19</span>
          
          <code class="ruby">    self.id == annotation.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="305">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="306">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="307">
          <span class="hits">1</span>
          
          <code class="ruby">  def dbid</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="308">
          <span class="hits">1</span>
          
          <code class="ruby">    self.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="309">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="310">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="311">
          <span class="hits">1</span>
          
          <code class="ruby">  def save!</code>
        </li>
      
        <li class="covered" data-hits="1242" data-linenumber="312">
          <span class="hits">1242</span>
          
          <code class="ruby">    raise &#39;Sorry, this is not valid&#39; unless self.save</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="313">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="314">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="315">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="316">
          <span class="hits">202</span>
          
          <code class="ruby">    obj = self.context.nil? ? self.annotated : self.context</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="317">
          <span class="hits">202</span>
          
          <code class="ruby">    team = []</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="318">
          <span class="hits">202</span>
          
          <code class="ruby">    unless obj.nil?</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="319">
          <span class="hits">202</span>
          
          <code class="ruby">      team = obj.respond_to?(:team) ? [obj.team.id] : obj.get_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="320">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="202" data-linenumber="321">
          <span class="hits">202</span>
          
          <code class="ruby">    team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="322">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="323">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="324">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_team</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="325">
          <span class="hits">40</span>
          
          <code class="ruby">    self.context.team if self.context_type === &#39;Project&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="326">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="327">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="328">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_notify?</code>
        </li>
      
        <li class="covered" data-hits="461" data-linenumber="329">
          <span class="hits">461</span>
          
          <code class="ruby">    self.current_user.present? &amp;&amp; self.current_team.present? &amp;&amp; self.current_team.setting(:slack_notifications_enabled).to_i === 1 &amp;&amp; self.annotated_type === &#39;Media&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="330">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="331">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="332">
          
          
          <code class="ruby">  # Supports only media for the time being</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="333">
          <span class="hits">1</span>
          
          <code class="ruby">  def entity_objects</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="334">
          <span class="hits">4</span>
          
          <code class="ruby">    objects = []</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="335">
          <span class="hits">4</span>
          
          <code class="ruby">    self.entities.collect do |e|</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="336">
          <span class="hits">6</span>
          
          <code class="ruby">      pm = ProjectMedia.where(id: e).last</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="337">
          <span class="hits">6</span>
          
          <code class="ruby">      unless pm.nil?</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="338">
          <span class="hits">6</span>
          
          <code class="ruby">        media = pm.media</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="339">
          <span class="hits">6</span>
          
          <code class="ruby">        media.project_id = pm.project_id</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="340">
          <span class="hits">6</span>
          
          <code class="ruby">        objects &lt;&lt; media</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="341">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="342">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="343">
          <span class="hits">4</span>
          
          <code class="ruby">    objects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="344">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="345">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="346">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="347">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="348">
          <span class="hits">1</span>
          
          <code class="ruby">  def load_polymorphic(name)</code>
        </li>
      
        <li class="covered" data-hits="5517" data-linenumber="349">
          <span class="hits">5517</span>
          
          <code class="ruby">    type, id = self.send(&quot;#{name}_type&quot;), self.send(&quot;#{name}_id&quot;)</code>
        </li>
      
        <li class="covered" data-hits="5517" data-linenumber="350">
          <span class="hits">5517</span>
          
          <code class="ruby">    return nil if type.blank? &amp;&amp; id.blank?</code>
        </li>
      
        <li class="covered" data-hits="5049" data-linenumber="351">
          <span class="hits">5049</span>
          
          <code class="ruby">    Rails.cache.fetch(&quot;find_#{type.parameterize}_#{id}&quot;, expires_in: 30.seconds) do</code>
        </li>
      
        <li class="covered" data-hits="1317" data-linenumber="352">
          <span class="hits">1317</span>
          
          <code class="ruby">      type.constantize.find(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="353">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="354">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="355">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="356">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_polymorphic(name, obj)</code>
        </li>
      
        <li class="covered" data-hits="2536" data-linenumber="357">
          <span class="hits">2536</span>
          
          <code class="ruby">    self.send(&quot;#{name}_type=&quot;, obj.class.name)</code>
        </li>
      
        <li class="covered" data-hits="2536" data-linenumber="358">
          <span class="hits">2536</span>
          
          <code class="ruby">    self.send(&quot;#{name}_id=&quot;, obj.id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="359">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="360">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="361">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="362">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="363">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_type_and_event</code>
        </li>
      
        <li class="covered" data-hits="1455" data-linenumber="364">
          <span class="hits">1455</span>
          
          <code class="ruby">    self.annotation_type ||= self.class.name.parameterize</code>
        </li>
      
        <li class="covered" data-hits="1455" data-linenumber="365">
          <span class="hits">1455</span>
          
          <code class="ruby">    self.paper_trail_event = &#39;create&#39; if self.versions.count === 0</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="366">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="367">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="368">
          <span class="hits">1</span>
          
          <code class="ruby">  def reset_changes</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="369">
          <span class="hits">1433</span>
          
          <code class="ruby">    @changes = nil</code>
        </li>
      
        <li class="covered" data-hits="1433" data-linenumber="370">
          <span class="hits">1433</span>
          
          <code class="ruby">    self.reload</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="371">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="372">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="373">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_annotator</code>
        </li>
      
        <li class="covered" data-hits="1455" data-linenumber="374">
          <span class="hits">1455</span>
          
          <code class="ruby">    self.annotator = self.current_user if self.annotator.nil? &amp;&amp; !self.current_user.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="375">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="376">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="eb028b454ca60e1573e195f1829ec036a6b81af3">
  <div class="header">
    <h3>app/models/concerns/checkdesk_elastic_search_model.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>27</b> relevant lines. 
      <span class="green"><b>27</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CheckdeskElasticSearchModel</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  included do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="5">
          <span class="hits">6</span>
          
          <code class="ruby">    include ActiveModel::Validations</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="6">
          <span class="hits">6</span>
          
          <code class="ruby">    include ActiveModel::Validations::Callbacks</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="7">
          <span class="hits">6</span>
          
          <code class="ruby">    include Elasticsearch::Persistence::Model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="9">
          <span class="hits">6</span>
          
          <code class="ruby">    index_name [Rails.application.engine_name, Rails.env, self.name.parameterize].join(&#39;_&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="11">
          <span class="hits">6</span>
          
          <code class="ruby">    settings analysis: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      char_filter: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">        space_hashtags: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">          type: &#39;mapping&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">          mappings: [&#39;#=&gt;|#&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      filter: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">        hashtag_as_alphanum: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">          type: &#39;word_delimiter&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">          type_table: [&#39;# =&gt; ALPHANUM&#39;, &#39;@ =&gt; ALPHANUM&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">      },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">      analyzer: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">        hashtag: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">          type: &#39;custom&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">          char_filter: &#39;space_hashtags&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">          tokenizer: &#39;whitespace&#39;,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">          filter: [&#39;lowercase&#39;, &#39;hashtag_as_alphanum&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    } do </code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="33">
          <span class="hits">6</span>
          
          <code class="ruby">      mapping do</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="34">
          <span class="hits">6</span>
          
          <code class="ruby">        indexes :title, type: &#39;string&#39;, analyzer: &#39;hashtag&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="35">
          <span class="hits">6</span>
          
          <code class="ruby">        indexes :description, type: &#39;string&#39;, analyzer: &#39;hashtag&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="36">
          <span class="hits">6</span>
          
          <code class="ruby">        indexes :quote, type: &#39;string&#39;, analyzer: &#39;hashtag&#39;</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="37">
          <span class="hits">6</span>
          
          <code class="ruby">        indexes :text, type: &#39;string&#39;, analyzer: &#39;hashtag&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def reload</code>
        </li>
      
        <li class="covered" data-hits="1586" data-linenumber="43">
          <span class="hits">1586</span>
          
          <code class="ruby">    self.id ? self.class.find(self.id) : self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    def create_index</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="48">
          <span class="hits">787</span>
          
          <code class="ruby">      client = self.gateway.client</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="49">
          <span class="hits">787</span>
          
          <code class="ruby">      index_name = self.index_name</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="50">
          <span class="hits">787</span>
          
          <code class="ruby">      settings = self.settings.to_hash</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="51">
          <span class="hits">787</span>
          
          <code class="ruby">      mappings = self.mappings.to_hash</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="52">
          <span class="hits">787</span>
          
          <code class="ruby">      client.indices.create index: index_name, body: { settings: settings.to_hash, mappings: mappings.to_hash }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">    def delete_index</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="56">
          <span class="hits">787</span>
          
          <code class="ruby">      client = self.gateway.client</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="57">
          <span class="hits">787</span>
          
          <code class="ruby">      index_name = self.index_name</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="58">
          <span class="hits">787</span>
          
          <code class="ruby">      if client.indices.exists? index: index_name</code>
        </li>
      
        <li class="covered" data-hits="787" data-linenumber="59">
          <span class="hits">787</span>
          
          <code class="ruby">        client.indices.delete index: index_name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="32b95d772fe6b3f9e9dcee786fcbe617a74e4396">
  <div class="header">
    <h3>app/models/concerns/media_information.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>49</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">require &#39;active_support/concern&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">module MediaInformation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  extend ActiveSupport::Concern</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_information</code>
        </li>
      
        <li class="covered" data-hits="525" data-linenumber="7">
          <span class="hits">525</span>
          
          <code class="ruby">    info = self.parse_information</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="525" data-linenumber="9">
          <span class="hits">525</span>
          
          <code class="ruby">    unless self.information_blank?</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="10">
          <span class="hits">68</span>
          
          <code class="ruby">      em_context = self.get_embed_context</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="11">
          <span class="hits">68</span>
          
          <code class="ruby">      em_none = self.get_embed_regardless_context</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="13">
          <span class="hits">68</span>
          
          <code class="ruby">      em = if em_context.nil? and em_none.nil?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="14">
          <span class="hits">10</span>
          
          <code class="ruby">             self.set_information_for_context(em_none)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">           elsif self.project.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">             self.set_information_for_context(em_none)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">           else</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="18">
          <span class="hits">57</span>
          
          <code class="ruby">             self.set_information_for_context_with_no_pender(em_context, em_none)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">           end</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="20">
          <span class="hits">68</span>
          
          <code class="ruby">      self.set_information_for_embed(em, info)</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="21">
          <span class="hits">68</span>
          
          <code class="ruby">      self.information = {}.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def information_blank?</code>
        </li>
      
        <li class="covered" data-hits="593" data-linenumber="28">
          <span class="hits">593</span>
          
          <code class="ruby">    self.parse_information.all? { |_k, v| v.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_embed_context</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="32">
          <span class="hits">68</span>
          
          <code class="ruby">    self.annotations(&#39;embed&#39;, self.project).last unless self.project.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="35">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_embed_regardless_context</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="36">
          <span class="hits">68</span>
          
          <code class="ruby">    self.annotations(&#39;embed&#39;, &#39;none&#39;).last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">  def parse_information</code>
        </li>
      
        <li class="covered" data-hits="1050" data-linenumber="40">
          <span class="hits">1050</span>
          
          <code class="ruby">    self.information.blank? ? {} : JSON.parse(self.information)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_information_for_context_with_no_pender(em_context, em_none)</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="44">
          <span class="hits">57</span>
          
          <code class="ruby">    em = em_context unless em_context.nil?</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="45">
          <span class="hits">57</span>
          
          <code class="ruby">    if em.nil?</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="46">
          <span class="hits">55</span>
          
          <code class="ruby">      em = set_information_for_context(em_none)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      # set search context and update Pender annotations</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="48">
          <span class="hits">55</span>
          
          <code class="ruby">      update_pender_search_context</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="50">
          <span class="hits">57</span>
          
          <code class="ruby">    em</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_information_for_context(em_none)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="54">
          <span class="hits">66</span>
          
          <code class="ruby">    em = em_none.nil? ? Embed.new : em_none</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="55">
          <span class="hits">66</span>
          
          <code class="ruby">    if em_none.nil?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="56">
          <span class="hits">10</span>
          
          <code class="ruby">      em = Embed.new</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="57">
          <span class="hits">10</span>
          
          <code class="ruby">      em.embed = self.information</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="58">
          <span class="hits">10</span>
          
          <code class="ruby">      em.annotated = self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">      # clone existing one and reset id and annotator fields</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="61">
          <span class="hits">56</span>
          
          <code class="ruby">      em = em_none</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="62">
          <span class="hits">56</span>
          
          <code class="ruby">      em.id = em.annotator_id = em.annotator_type = nil</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="64">
          <span class="hits">66</span>
          
          <code class="ruby">    em.annotator = self.current_user unless self.current_user.nil?</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="65">
          <span class="hits">66</span>
          
          <code class="ruby">    em.context = self.project</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="66">
          <span class="hits">66</span>
          
          <code class="ruby">    em.search_context = [self.project_id]</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="67">
          <span class="hits">66</span>
          
          <code class="ruby">    em</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">  def update_pender_search_context</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="71">
          <span class="hits">55</span>
          
          <code class="ruby">    pender = self.annotations(&#39;embed&#39;, &#39;none&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="72">
          <span class="hits">55</span>
          
          <code class="ruby">    unless pender.nil?</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="73">
          <span class="hits">55</span>
          
          <code class="ruby">      pender.search_context = pender.search_context - [self.project_id]</code>
        </li>
      
        <li class="covered" data-hits="55" data-linenumber="74">
          <span class="hits">55</span>
          
          <code class="ruby">      pender.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_information_for_embed(em, info)</code>
        </li>
      
        <li class="covered" data-hits="155" data-linenumber="79">
          <span class="hits">155</span>
          
          <code class="ruby">    info.each{ |k, v| em.send(&quot;#{k}=&quot;, v) if em.respond_to?(k) and !v.blank? }</code>
        </li>
      
        <li class="covered" data-hits="68" data-linenumber="80">
          <span class="hits">68</span>
          
          <code class="ruby">    em.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="ad8104e28d4e9063e838ea863f42803874b249eb">
  <div class="header">
    <h3>app/models/contact.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Contact &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  phony_normalize :phone, default_country_code: &#39;US&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :phone, phony_plausible: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="95dd7eb1bf720832205d2878edbfa6d329fd7900">
  <div class="header">
    <h3>app/models/media.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>128</b> relevant lines. 
      <span class="green"><b>128</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Media &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :project_id, :duplicated_of, :information, :project_object</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_paper_trail on: [:create, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :account</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :project_medias</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :projects, through: :project_medias</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  has_annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  include PenderData</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  include MediaInformation</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :validate_pender_result, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :pender_result_is_an_item, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :url_is_unique, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_url_nil_if_empty, :set_user, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :set_pender_result_as_annotation, :set_information, :set_project, :set_account</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  after_update :set_information</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  after_rollback :duplicate</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_team</code>
        </li>
      
        <li class="covered" data-hits="54" data-linenumber="25">
          <span class="hits">54</span>
          
          <code class="ruby">    self.project.team if self.project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="29">
          <span class="hits">2</span>
          
          <code class="ruby">    user_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def account_id_callback(value, mapping_ids)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def jsondata(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="37">
          <span class="hits">5</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="38">
          <span class="hits">5</span>
          
          <code class="ruby">    self.data(context).to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def project_media(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="42">
          <span class="hits">2</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="43">
          <span class="hits">2</span>
          
          <code class="ruby">    self.project_medias.find_by(:project_id =&gt; context.id) unless context.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_in_context(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="48">
          <span class="hits">1</span>
          
          <code class="ruby">    self.user if context.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">    pm = project_media(context)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">    pm.user unless pm.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def cached_annotations(type = nil, context = nil)</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="54">
          <span class="hits">301</span>
          
          <code class="ruby">    return self.annotations(type, context) if self.no_cache</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="55">
          <span class="hits">301</span>
          
          <code class="ruby">    @cached_annotations ||= self.annotations</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="56">
          <span class="hits">301</span>
          
          <code class="ruby">    type = [type].flatten</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="57">
          <span class="hits">301</span>
          
          <code class="ruby">    cached_annotations_filtered(type, context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def data(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="61">
          <span class="hits">21</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="62">
          <span class="hits">21</span>
          
          <code class="ruby">    em_pender = self.cached_annotations(&#39;embed&#39;, context).last unless context.nil?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="63">
          <span class="hits">21</span>
          
          <code class="ruby">    em_pender = self.cached_annotations(&#39;embed&#39;, &#39;none&#39;).last if em_pender.nil?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="64">
          <span class="hits">21</span>
          
          <code class="ruby">    embed = JSON.parse(em_pender.embed) unless em_pender.nil?</code>
        </li>
      
        <li class="covered" data-hits="101" data-linenumber="65">
          <span class="hits">101</span>
          
          <code class="ruby">    self.overriden_embed_attributes.each{ |k| sk = k.to_s; embed[sk] = em_pender[sk] unless em_pender[sk].nil? } unless embed.nil?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="66">
          <span class="hits">21</span>
          
          <code class="ruby">    embed</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">  def tags(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="71">
          <span class="hits">2</span>
          
          <code class="ruby">    self.cached_annotations(&#39;tag&#39;, context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">  def last_status(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="248" data-linenumber="75">
          <span class="hits">248</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="248" data-linenumber="76">
          <span class="hits">248</span>
          
          <code class="ruby">    last = self.cached_annotations(&#39;status&#39;, context).first</code>
        </li>
      
        <li class="covered" data-hits="248" data-linenumber="77">
          <span class="hits">248</span>
          
          <code class="ruby">    last.nil? ? Status.default_id(self, context) : last.status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">  def published(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="81">
          <span class="hits">1</span>
          
          <code class="ruby">    context = self.get_media_context(context)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">    return self.created_at.to_i.to_s if context.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">    pm = project_media(context)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="84">
          <span class="hits">1</span>
          
          <code class="ruby">    pm.created_at.to_i.to_s unless pm.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="88">
          <span class="hits">177</span>
          
          <code class="ruby">    self.projects.map(&amp;:team_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="90">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="91">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team_objects</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="92">
          <span class="hits">40</span>
          
          <code class="ruby">    self.projects.map(&amp;:team)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="93">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="95">
          <span class="hits">1</span>
          
          <code class="ruby">  def associate_to_project</code>
        </li>
      
        <li class="covered" data-hits="258" data-linenumber="96">
          <span class="hits">258</span>
          
          <code class="ruby">    if !self.project_id.blank? &amp;&amp; !ProjectMedia.where(project_id: self.project_id, media_id: self.id).exists?</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="97">
          <span class="hits">148</span>
          
          <code class="ruby">      pm = ProjectMedia.new</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="98">
          <span class="hits">148</span>
          
          <code class="ruby">      pm.project_id = self.project_id</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="99">
          <span class="hits">148</span>
          
          <code class="ruby">      pm.media = self</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="100">
          <span class="hits">148</span>
          
          <code class="ruby">      pm.user = pm.current_user = self.current_user</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="101">
          <span class="hits">148</span>
          
          <code class="ruby">      pm.context_team = self.context_team</code>
        </li>
      
        <li class="covered" data-hits="148" data-linenumber="102">
          <span class="hits">148</span>
          
          <code class="ruby">      pm.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def relay_id</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="107">
          <span class="hits">4</span>
          
          <code class="ruby">    str = &quot;Media/#{self.id}&quot;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="108">
          <span class="hits">4</span>
          
          <code class="ruby">    str += &quot;/#{self.project_id}&quot; unless self.project_id.nil?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="109">
          <span class="hits">4</span>
          
          <code class="ruby">    Base64.encode64(str)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="112">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_media_context(context = nil)</code>
        </li>
      
        <li class="covered" data-hits="280" data-linenumber="113">
          <span class="hits">280</span>
          
          <code class="ruby">    context.nil? ? self.project : context</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="116">
          <span class="hits">1</span>
          
          <code class="ruby">  def domain</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="117">
          <span class="hits">3</span>
          
          <code class="ruby">    host = URI.parse(self.url).host unless self.url.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="118">
          <span class="hits">3</span>
          
          <code class="ruby">    host.nil? ? nil : host.gsub(/^(www|m)\./, &#39;&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="119">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="121">
          <span class="hits">1</span>
          
          <code class="ruby">  def project</code>
        </li>
      
        <li class="covered" data-hits="698" data-linenumber="122">
          <span class="hits">698</span>
          
          <code class="ruby">    return self.project_object unless self.project_object.nil?</code>
        </li>
      
        <li class="covered" data-hits="698" data-linenumber="123">
          <span class="hits">698</span>
          
          <code class="ruby">    if self.project_id</code>
        </li>
      
        <li class="covered" data-hits="664" data-linenumber="124">
          <span class="hits">664</span>
          
          <code class="ruby">      Rails.cache.fetch(&quot;project_#{self.project_id}&quot;, expires_in: 30.seconds) do</code>
        </li>
      
        <li class="covered" data-hits="57" data-linenumber="125">
          <span class="hits">57</span>
          
          <code class="ruby">        Project.find(self.project_id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="129">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="130">
          <span class="hits">1</span>
          
          <code class="ruby">  def overriden_embed_attributes</code>
        </li>
      
        <li class="covered" data-hits="263" data-linenumber="131">
          <span class="hits">263</span>
          
          <code class="ruby">    %W(title description username quote)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="132">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="134">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="136">
          <span class="hits">1</span>
          
          <code class="ruby">  def cached_annotations_filtered(type, context)</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="137">
          <span class="hits">301</span>
          
          <code class="ruby">    ret = @cached_annotations</code>
        </li>
      
        <li class="covered" data-hits="807" data-linenumber="138">
          <span class="hits">807</span>
          
          <code class="ruby">    ret = ret.select{ |a| type.include?(a.annotation_type) } unless type.nil?</code>
        </li>
      
        <li class="covered" data-hits="403" data-linenumber="139">
          <span class="hits">403</span>
          
          <code class="ruby">    ret = ret.select{ |a| a.context_type == context.class.name &amp;&amp; a.context_id == context.id.to_s } if context.kind_of?(ActiveRecord::Base)</code>
        </li>
      
        <li class="covered" data-hits="312" data-linenumber="140">
          <span class="hits">312</span>
          
          <code class="ruby">    ret = ret.select{ |a| a.context_id.blank? } if context == &#39;none&#39;</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="141">
          <span class="hits">301</span>
          
          <code class="ruby">    ret = ret.select{ |a| !a.context_id.blank? } if context == &#39;some&#39;</code>
        </li>
      
        <li class="covered" data-hits="301" data-linenumber="142">
          <span class="hits">301</span>
          
          <code class="ruby">    ret</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="145">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="146">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="147">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_url_nil_if_empty</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="148">
          <span class="hits">261</span>
          
          <code class="ruby">    self.url = nil if self.url.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_user</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="152">
          <span class="hits">261</span>
          
          <code class="ruby">    self.user = self.current_user unless self.current_user.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="153">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="154">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="155">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_account</code>
        </li>
      
        <li class="covered" data-hits="255" data-linenumber="156">
          <span class="hits">255</span>
          
          <code class="ruby">    unless self.pender_data.nil?</code>
        </li>
      
        <li class="covered" data-hits="243" data-linenumber="157">
          <span class="hits">243</span>
          
          <code class="ruby">      account = Account.new</code>
        </li>
      
        <li class="covered" data-hits="243" data-linenumber="158">
          <span class="hits">243</span>
          
          <code class="ruby">      account.url = self.pender_data[&#39;author_url&#39;]</code>
        </li>
      
        <li class="covered" data-hits="243" data-linenumber="159">
          <span class="hits">243</span>
          
          <code class="ruby">      if account.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="160">
          <span class="hits">2</span>
          
          <code class="ruby">        self.account = account</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="241" data-linenumber="162">
          <span class="hits">241</span>
          
          <code class="ruby">        self.account = Account.where(url: account.url).last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="243" data-linenumber="164">
          <span class="hits">243</span>
          
          <code class="ruby">      self.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="165">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="166">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="168">
          <span class="hits">1</span>
          
          <code class="ruby">  def pender_result_is_an_item</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="169">
          <span class="hits">261</span>
          
          <code class="ruby">    unless self.pender_data.nil?</code>
        </li>
      
        <li class="covered" data-hits="248" data-linenumber="170">
          <span class="hits">248</span>
          
          <code class="ruby">      errors.add(:base, &#39;Sorry, this is not a valid media item&#39;) unless self.pender_data[&#39;type&#39;] == &#39;item&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="171">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="172">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="174">
          <span class="hits">1</span>
          
          <code class="ruby">  def url_is_unique</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="175">
          <span class="hits">261</span>
          
          <code class="ruby">    unless self.url.nil?</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="176">
          <span class="hits">249</span>
          
          <code class="ruby">      existing = Media.where(url: self.url).first</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="177">
          <span class="hits">249</span>
          
          <code class="ruby">      self.duplicated_of = existing</code>
        </li>
      
        <li class="covered" data-hits="249" data-linenumber="178">
          <span class="hits">249</span>
          
          <code class="ruby">      errors.add(:base, &quot;Media with this URL exists and has id #{existing.id}&quot;) unless existing.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="180">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="182">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_project</code>
        </li>
      
        <li class="covered" data-hits="255" data-linenumber="183">
          <span class="hits">255</span>
          
          <code class="ruby">    self.associate_to_project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="186">
          <span class="hits">1</span>
          
          <code class="ruby">  def duplicate</code>
        </li>
      
        <li class="covered" data-hits="264" data-linenumber="187">
          <span class="hits">264</span>
          
          <code class="ruby">    dup = self.duplicated_of</code>
        </li>
      
        <li class="covered" data-hits="264" data-linenumber="188">
          <span class="hits">264</span>
          
          <code class="ruby">    unless dup.blank?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="189">
          <span class="hits">3</span>
          
          <code class="ruby">      dup.project_id = self.project_id</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="190">
          <span class="hits">3</span>
          
          <code class="ruby">      dup.context_team = self.context_team</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="191">
          <span class="hits">3</span>
          
          <code class="ruby">      dup.current_user = self.current_user</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="192">
          <span class="hits">3</span>
          
          <code class="ruby">      dup.origin = self.origin</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="193">
          <span class="hits">3</span>
          
          <code class="ruby">      dup.associate_to_project</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="194">
          <span class="hits">3</span>
          
          <code class="ruby">      return false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="261" data-linenumber="196">
          <span class="hits">261</span>
          
          <code class="ruby">    true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="2ff7b80c00a5ff7cf5f01a879f83114dd3dd19cf">
  <div class="header">
    <h3>app/models/project.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>49</b> relevant lines. 
      <span class="green"><b>49</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Project &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_paper_trail on: [:create, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :project_sources</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :sources , through: :project_sources</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :project_medias</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :medias , through: :project_medias</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :lead_image, ImageUploader</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_description_and_team_and_user, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :title</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :lead_image, size: true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  has_annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_slack on: :create,</code>
        </li>
      
        <li class="covered" data-hits="876" data-linenumber="22">
          <span class="hits">876</span>
          
          <code class="ruby">                 if: proc { |p| p.current_user.present? &amp;&amp; p.team.setting(:slack_notifications_enabled).to_i === 1 },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="23">
          <span class="hits">2</span>
          
          <code class="ruby">                 message: proc { |p| &quot;*#{p.current_user.name}* created a project: &lt;#{p.origin}/project/#{p.id}|*#{p.title}*&gt;&quot; },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="24">
          <span class="hits">2</span>
          
          <code class="ruby">                 channel: proc { |p| p.setting(:slack_channel) || p.team.setting(:slack_channel) },</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="25">
          <span class="hits">2</span>
          
          <code class="ruby">                 webhook: proc { |p| p.team.setting(:slack_webhook) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_pusher on: :create,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">                  event: &#39;project_created&#39;,</code>
        </li>
      
        <li class="covered" data-hits="876" data-linenumber="29">
          <span class="hits">876</span>
          
          <code class="ruby">                  targets: proc { |p| [p.team] },</code>
        </li>
      
        <li class="covered" data-hits="876" data-linenumber="30">
          <span class="hits">876</span>
          
          <code class="ruby">                  data: proc { |p| p.to_json }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  include CheckdeskSettings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="35">
          <span class="hits">2</span>
          
          <code class="ruby">    user_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">  def team_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="39">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def lead_image_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="43">
          <span class="hits">3</span>
          
          <code class="ruby">    image_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">    CONFIG[&#39;checkdesk_base_url&#39;] + self.lead_image.url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="50">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json(options = {})</code>
        </li>
      
        <li class="covered" data-hits="1854" data-linenumber="51">
          <span class="hits">1854</span>
          
          <code class="ruby">    project = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      dbid: self.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      title: self.title,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">      id: Base64.encode64(&quot;Project/#{self.id}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="1854" data-linenumber="56">
          <span class="hits">1854</span>
          
          <code class="ruby">    unless options[:without_team]</code>
        </li>
      
        <li class="covered" data-hits="879" data-linenumber="57">
          <span class="hits">879</span>
          
          <code class="ruby">      project[:team] = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">        id: Base64.encode64(&quot;Team/#{self.id}&quot;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">        dbid: self.team_id,</code>
        </li>
      
        <li class="covered" data-hits="975" data-linenumber="60">
          <span class="hits">975</span>
          
          <code class="ruby">        projects: { edges: self.team.projects.collect{ |p| { node: p.as_json(without_team: true) } } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="1854" data-linenumber="63">
          <span class="hits">1854</span>
          
          <code class="ruby">    project</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="66">
          <span class="hits">1</span>
          
          <code class="ruby">  def eager_loaded_medias</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="67">
          <span class="hits">3</span>
          
          <code class="ruby">    self.medias.to_a.collect do |media|</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="68">
          <span class="hits">22</span>
          
          <code class="ruby">      media.project_id = self.id</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="69">
          <span class="hits">22</span>
          
          <code class="ruby">      media</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def medias_count</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="74">
          <span class="hits">1</span>
          
          <code class="ruby">    self.medias.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="77">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_description_and_team_and_user</code>
        </li>
      
        <li class="covered" data-hits="881" data-linenumber="80">
          <span class="hits">881</span>
          
          <code class="ruby">    self.description ||= &#39;&#39;</code>
        </li>
      
        <li class="covered" data-hits="881" data-linenumber="81">
          <span class="hits">881</span>
          
          <code class="ruby">    if !self.current_user.nil? &amp;&amp; !self.team_id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">      self.team = self.current_user.current_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="881" data-linenumber="84">
          <span class="hits">881</span>
          
          <code class="ruby">    self.user ||= self.current_user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0a7be7c0297d29217017a8fe3b4027cb126debd0">
  <div class="header">
    <h3>app/models/project_media.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProjectMedia &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :project</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :media</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :set_search_context, :set_initial_media_status</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_slack on: :create,</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="11">
          <span class="hits">204</span>
          
          <code class="ruby">                 if: proc { |pm| m = pm.media; m.current_user.present? &amp;&amp; m.current_team.present? &amp;&amp; m.current_team.setting(:slack_notifications_enabled).to_i === 1 },</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="12">
          <span class="hits">4</span>
          
          <code class="ruby">                 message: proc { |pm| pm.slack_notification_message },</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="13">
          <span class="hits">4</span>
          
          <code class="ruby">                 channel: proc { |pm| m = pm.media; m.project.setting(:slack_channel) || m.current_team.setting(:slack_channel) },</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="14">
          <span class="hits">4</span>
          
          <code class="ruby">                 webhook: proc { |pm| m = pm.media; m.current_team.setting(:slack_webhook) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_pusher on: :create,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">                  event: &#39;media_updated&#39;,</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="18">
          <span class="hits">204</span>
          
          <code class="ruby">                  targets: proc { |pm| [pm.project] },</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="19">
          <span class="hits">204</span>
          
          <code class="ruby">                  data: proc { |pm| pm.media.to_json }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="22">
          <span class="hits">96</span>
          
          <code class="ruby">    p = self.project</code>
        </li>
      
        <li class="covered" data-hits="96" data-linenumber="23">
          <span class="hits">96</span>
          
          <code class="ruby">    p.nil? ? [] : [p.team_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def media_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def project_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_initial_media_status</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="35">
          <span class="hits">204</span>
          
          <code class="ruby">    st = Status.new</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="36">
          <span class="hits">204</span>
          
          <code class="ruby">    st.annotated = self.media</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="37">
          <span class="hits">204</span>
          
          <code class="ruby">    st.context = self.project</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="38">
          <span class="hits">204</span>
          
          <code class="ruby">    st.annotator = self.user</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="39">
          <span class="hits">204</span>
          
          <code class="ruby">    st.status = Status.default_id(self.media, self.project)</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="40">
          <span class="hits">204</span>
          
          <code class="ruby">    st.created_at = self.created_at</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="41">
          <span class="hits">204</span>
          
          <code class="ruby">    st.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def slack_notification_message</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="45">
          <span class="hits">4</span>
          
          <code class="ruby">    m = self.media</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="46">
          <span class="hits">4</span>
          
          <code class="ruby">    data = m.data(self.project)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="47">
          <span class="hits">4</span>
          
          <code class="ruby">    type, text = data[&#39;quote&#39;].blank? ?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      [ &#39;link&#39;, data[&#39;title&#39;] ] :</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      [ &#39;claim&#39;, data[&#39;quote&#39;] ]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="50">
          <span class="hits">4</span>
          
          <code class="ruby">    &quot;*#{m.user.name}* added a new #{type}: &lt;#{m.origin}/project/#{m.project_id}/media/#{m.id}|*#{text}*&gt;&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_search_context</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="56">
          <span class="hits">204</span>
          
          <code class="ruby">    em_context = self.media.annotations(&#39;embed&#39;, self.project).last unless self.project.nil?</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="57">
          <span class="hits">204</span>
          
          <code class="ruby">    if em_context.nil?</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="58">
          <span class="hits">152</span>
          
          <code class="ruby">      em_none = self.media.annotations(&#39;embed&#39;, &#39;none&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="59">
          <span class="hits">152</span>
          
          <code class="ruby">      unless em_none.nil?</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="60">
          <span class="hits">152</span>
          
          <code class="ruby">        em_none.search_context &lt;&lt; self.project.id</code>
        </li>
      
        <li class="covered" data-hits="152" data-linenumber="61">
          <span class="hits">152</span>
          
          <code class="ruby">        em_none.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="28c562ab4f62fc6de3885f6bdc4454bb9efa42c9">
  <div class="header">
    <h3>app/models/project_source.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ProjectSource &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :project</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :source</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="8">
          <span class="hits">36</span>
          
          <code class="ruby">    p = self.project</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="9">
          <span class="hits">36</span>
          
          <code class="ruby">    p.nil? ? [] : [p.team_id]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="942b3b7a41e308986ea96418186940f10e0403c7">
  <div class="header">
    <h3>app/models/root_level.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>4</b> relevant lines. 
      <span class="green"><b>4</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class RootLevel &lt; Struct.new :id</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  STATIC = new(id: &#39;root&#39;).freeze</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.find(_)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    STATIC</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="0f854e7758b6b180753f93614b80fb9442eb5ba1">
  <div class="header">
    <h3>app/models/source.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>31</b> relevant lines. 
      <span class="green"><b>31</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Source &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  has_paper_trail on: [:create, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :accounts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :project_sources</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :projects , through: :project_sources</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    user_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="18">
          <span class="hits">3</span>
          
          <code class="ruby">    image_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def medias</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="22">
          <span class="hits">20</span>
          
          <code class="ruby">    Media.where(account_id: self.account_ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_team</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="26">
          <span class="hits">13</span>
          
          <code class="ruby">    teams = []</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="27">
          <span class="hits">13</span>
          
          <code class="ruby">    projects = self.projects.map(&amp;:id)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="28">
          <span class="hits">13</span>
          
          <code class="ruby">    teams = Project.where(:id =&gt; projects).map(&amp;:team_id).uniq unless projects.empty?</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="29">
          <span class="hits">13</span>
          
          <code class="ruby">    return teams</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def image</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">    self.avatar</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def description</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="37">
          <span class="hits">3</span>
          
          <code class="ruby">    return self.slogan unless self.slogan == self.name</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="38">
          <span class="hits">2</span>
          
          <code class="ruby">    self.accounts.empty? ? &#39;&#39; : self.accounts.first.data[&#39;description&#39;].to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">  def collaborators</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="42">
          <span class="hits">21</span>
          
          <code class="ruby">    self.annotators</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="45">
          <span class="hits">1</span>
          
          <code class="ruby">  def tags</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="46">
          <span class="hits">20</span>
          
          <code class="ruby">    self.annotations(&#39;tag&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def comments</code>
        </li>
      
        <li class="covered" data-hits="20" data-linenumber="50">
          <span class="hits">20</span>
          
          <code class="ruby">    self.annotations(&#39;comment&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="4c3b580a8e85fe2ecc67a93da50f020707d6b2ac">
  <div class="header">
    <h3>app/models/team.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>97</b> relevant lines. 
      <span class="green"><b>97</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class Team &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  has_paper_trail on: [:create, :update]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :projects</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :accounts</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :team_users</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :users, through: :team_users</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :contacts</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :logo, ImageUploader</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :normalize_subdomain, on: :create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :name</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_presence_of :subdomain</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  validates_format_of :subdomain, :with =&gt; /\A[[:alnum:]-]+\z/, :message =&gt; &#39;accepts only letters, numbers and hyphens&#39;, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :subdomain, length: { in: 4..63 }, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :subdomain, uniqueness: true, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :subdomain_is_available, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :logo, size: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :slack_webhook_format</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :custom_media_statuses_format</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :custom_source_statuses_format</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :add_user_to_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">  has_annotations</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  include CheckdeskSettings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="32">
          <span class="hits">1</span>
          
          <code class="ruby">  def logo_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="33">
          <span class="hits">3</span>
          
          <code class="ruby">    image_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="36">
          <span class="hits">1</span>
          
          <code class="ruby">  def avatar</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">    CONFIG[&#39;checkdesk_base_url&#39;] + self.logo.url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  def members_count</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="41">
          <span class="hits">1</span>
          
          <code class="ruby">    self.users.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="43">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="44">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json(_options = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby">      dbid: self.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">      id: Base64.encode64(&quot;Team/#{self.id}&quot;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      avatar: self.avatar,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      name: self.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      projects: self.recent_projects,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      subdomain: self.subdomain</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="52">
          <span class="hits">3</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="55">
          <span class="hits">1</span>
          
          <code class="ruby">  def owners</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="56">
          <span class="hits">325</span>
          
          <code class="ruby">    self.users.where(&#39;team_users.role&#39; =&gt; &#39;owner&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def recent_projects</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="60">
          <span class="hits">7</span>
          
          <code class="ruby">    self.projects.order(&#39;id DESC&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">  def contact=(info)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="64">
          <span class="hits">2</span>
          
          <code class="ruby">    contact = self.contacts.first || Contact.new</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="65">
          <span class="hits">2</span>
          
          <code class="ruby">    info = JSON.parse(info)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="66">
          <span class="hits">2</span>
          
          <code class="ruby">    contact.web = info[&#39;web&#39;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="67">
          <span class="hits">2</span>
          
          <code class="ruby">    contact.phone = info[&#39;phone&#39;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="68">
          <span class="hits">2</span>
          
          <code class="ruby">    contact.location = info[&#39;location&#39;]</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="69">
          <span class="hits">2</span>
          
          <code class="ruby">    contact.team = self</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="70">
          <span class="hits">2</span>
          
          <code class="ruby">    contact.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def verification_statuses(type)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="74">
          <span class="hits">4</span>
          
          <code class="ruby">    statuses = self.send(&quot;get_#{type}_verification_statuses&quot;) || Status.core_verification_statuses(type)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="75">
          <span class="hits">4</span>
          
          <code class="ruby">    statuses.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">  def recipients(requestor)</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="79">
          <span class="hits">325</span>
          
          <code class="ruby">    owners = self.owners</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="80">
          <span class="hits">325</span>
          
          <code class="ruby">    recipients = []</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="81">
          <span class="hits">325</span>
          
          <code class="ruby">    if !owners.empty? &amp;&amp; !owners.include?(requestor)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="82">
          <span class="hits">44</span>
          
          <code class="ruby">      recipients = owners.map(&amp;:email).reject{ |m| m.blank? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="84">
          <span class="hits">325</span>
          
          <code class="ruby">    recipients</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="87">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def custom_statuses_format(type)</code>
        </li>
      
        <li class="covered" data-hits="2018" data-linenumber="90">
          <span class="hits">2018</span>
          
          <code class="ruby">    statuses = self.send(&quot;get_#{type}_verification_statuses&quot;)</code>
        </li>
      
        <li class="covered" data-hits="2018" data-linenumber="91">
          <span class="hits">2018</span>
          
          <code class="ruby">    unless statuses.nil?</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="92">
          <span class="hits">7</span>
          
          <code class="ruby">      if statuses[:label].blank? || !statuses[:statuses].is_a?(Array) || statuses[:statuses].size === 0</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:base, &#39;Invalid format for custom verification statuses&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="6" data-linenumber="95">
          <span class="hits">6</span>
          
          <code class="ruby">        statuses[:statuses].each do |status|</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="96">
          <span class="hits">9</span>
          
          <code class="ruby">          errors.add(:base, &#39;Invalid format for custom verification status&#39;) if status.keys.sort != [:description, :id, :label, :style]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="98">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="99">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="102">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">  def add_user_to_team</code>
        </li>
      
        <li class="covered" data-hits="969" data-linenumber="105">
          <span class="hits">969</span>
          
          <code class="ruby">    user = self.current_user</code>
        </li>
      
        <li class="covered" data-hits="969" data-linenumber="106">
          <span class="hits">969</span>
          
          <code class="ruby">    unless user.nil?</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="107">
          <span class="hits">40</span>
          
          <code class="ruby">      tu = TeamUser.new</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="108">
          <span class="hits">40</span>
          
          <code class="ruby">      tu.user = user</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="109">
          <span class="hits">40</span>
          
          <code class="ruby">      tu.team = self</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="110">
          <span class="hits">40</span>
          
          <code class="ruby">      tu.role = &#39;owner&#39;</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="111">
          <span class="hits">40</span>
          
          <code class="ruby">      tu.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="113">
          <span class="hits">40</span>
          
          <code class="ruby">      user.current_team_id = self.id</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="114">
          <span class="hits">40</span>
          
          <code class="ruby">      user.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="115">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="118">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.subdomain_from_name(name)</code>
        </li>
      
        <li class="covered" data-hits="940" data-linenumber="119">
          <span class="hits">940</span>
          
          <code class="ruby">    name.parameterize.underscore.dasherize.ljust(4, &#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="120">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="121">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="122">
          <span class="hits">1</span>
          
          <code class="ruby">  def subdomain_is_available</code>
        </li>
      
        <li class="covered" data-hits="981" data-linenumber="123">
          <span class="hits">981</span>
          
          <code class="ruby">    unless self.origin.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="124">
          <span class="hits">4</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="125">
          <span class="hits">4</span>
          
          <code class="ruby">        r = Regexp.new CONFIG[&#39;checkdesk_client&#39;]</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="126">
          <span class="hits">4</span>
          
          <code class="ruby">        m = origin.match(r)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="127">
          <span class="hits">4</span>
          
          <code class="ruby">        url = &#39;&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="128">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="129">
          <span class="hits">4</span>
          
          <code class="ruby">        if m[1].blank?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="130">
          <span class="hits">3</span>
          
          <code class="ruby">          url = m[0].gsub(/(^https?:\/\/)/, &#39;\1&#39; + self.subdomain + &#39;.&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="132">
          <span class="hits">1</span>
          
          <code class="ruby">          url = m[0].gsub(m[1], self.subdomain)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="135">
          <span class="hits">4</span>
          
          <code class="ruby">        uri = URI.parse(url)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="136">
          <span class="hits">4</span>
          
          <code class="ruby">        request = Net::HTTP::Head.new(uri)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="137">
          <span class="hits">8</span>
          
          <code class="ruby">        response = Net::HTTP.start(uri.hostname, uri.port, use_ssl: uri.scheme == &quot;https&quot;) { |http| http.request(request) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="138">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="139">
          <span class="hits">3</span>
          
          <code class="ruby">        errors.add(:base, &#39;Subdomain is not available&#39;) unless response[&#39;X-Check-Web&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">      rescue</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="141">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:base, &#39;Subdomain is not available&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="144">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="145">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="146">
          <span class="hits">1</span>
          
          <code class="ruby">  def slack_webhook_format</code>
        </li>
      
        <li class="covered" data-hits="1009" data-linenumber="147">
          <span class="hits">1009</span>
          
          <code class="ruby">    webhook = self.get_slack_webhook</code>
        </li>
      
        <li class="covered" data-hits="1009" data-linenumber="148">
          <span class="hits">1009</span>
          
          <code class="ruby">    if !webhook.blank? &amp;&amp; /\Ahttps?:\/\/hooks\.slack\.com\/services\/[^\s]+\z/.match(webhook).nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="149">
          <span class="hits">1</span>
          
          <code class="ruby">      errors.add(:base, &#39;Slack webhook format is wrong&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="152">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="153">
          <span class="hits">1</span>
          
          <code class="ruby">  def normalize_subdomain</code>
        </li>
      
        <li class="covered" data-hits="981" data-linenumber="154">
          <span class="hits">981</span>
          
          <code class="ruby">    self.subdomain = self.subdomain.downcase unless self.subdomain.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="155">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="156">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="157">
          <span class="hits">1</span>
          
          <code class="ruby">  def custom_media_statuses_format</code>
        </li>
      
        <li class="covered" data-hits="1009" data-linenumber="158">
          <span class="hits">1009</span>
          
          <code class="ruby">    self.custom_statuses_format(:media)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="159">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="160">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="161">
          <span class="hits">1</span>
          
          <code class="ruby">  def custom_source_statuses_format</code>
        </li>
      
        <li class="covered" data-hits="1009" data-linenumber="162">
          <span class="hits">1009</span>
          
          <code class="ruby">    self.custom_statuses_format(:source)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="53de79526c85ee9e7f09fb0bca9ad269824b0e4a">
  <div class="header">
    <h3>app/models/team_user.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>36</b> relevant lines. 
      <span class="green"><b>36</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class TeamUser &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  belongs_to :user</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :status, presence: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :status, inclusion: { in: %w(member requested invited banned), message: &quot;%{value} is not a valid team member status&quot; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :role, inclusion: { in: %w(admin owner editor journalist contributor), message: &quot;%{value} is not a valid team role&quot; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :user_id, uniqueness: { scope: :team_id, message: &quot;User already joined this team&quot; }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :user_is_member_in_slack_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">  before_validation :set_role_default_value, on: :create</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :send_email_to_team_owners</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  after_save :send_email_to_requestor</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  notifies_slack on: :create,</code>
        </li>
      
        <li class="covered" data-hits="326" data-linenumber="18">
          <span class="hits">326</span>
          
          <code class="ruby">                 if: proc { |tu| tu.current_user.present? &amp;&amp; tu.team.setting(:slack_notifications_enabled).to_i === 1 },</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">                 message: proc { |tu| &quot;*#{tu.user.name}* joined &lt;#{tu.origin.gsub(/(https?:\/\/[^\/]+).*/, &#39;\1&#39;)}|*#{tu.team.name}*&gt;&quot; },</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">                 channel: proc { |tu| tu.team.setting(:slack_channel) },</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">                 webhook: proc { |tu| tu.team.setting(:slack_webhook) }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_id_callback(value, _mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">    user_callback(value)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="27">
          <span class="hits">1</span>
          
          <code class="ruby">  def team_id_callback(value, mapping_ids = nil)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">    mapping_ids[value]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="31">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json(_options = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">      id: self.team.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      name: self.team.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">      role: self.role,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      status: self.status</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="37">
          <span class="hits">4</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="40">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_email_to_team_owners</code>
        </li>
      
        <li class="covered" data-hits="326" data-linenumber="43">
          <span class="hits">326</span>
          
          <code class="ruby">    TeamUserMailer.request_to_join(self.team, self.user, self.origin).deliver_now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_email_to_requestor</code>
        </li>
      
        <li class="covered" data-hits="384" data-linenumber="47">
          <span class="hits">384</span>
          
          <code class="ruby">    if self.status_was === &#39;requested&#39; &amp;&amp; [&#39;member&#39;, &#39;banned&#39;].include?(self.status)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="48">
          <span class="hits">2</span>
          
          <code class="ruby">      accepted = self.status === &#39;member&#39;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="49">
          <span class="hits">2</span>
          
          <code class="ruby">      TeamUserMailer.request_to_join_processed(self.team, self.user, accepted, self.origin).deliver_now</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_role_default_value</code>
        </li>
      
        <li class="covered" data-hits="333" data-linenumber="54">
          <span class="hits">333</span>
          
          <code class="ruby">    self.role = &#39;contributor&#39; if self.role.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  # Validate that a Slack user is part of the team&#39;s `slack_teams` setting.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  # The `slack_teams` should be a hash of the form:</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby">  # { &#39;Slack team 1 id&#39; =&gt; &#39;Slack team 1 name&#39;, &#39;Slack team 2 id&#39; =&gt; &#39;Slack team 2 name&#39;, ... }</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_is_member_in_slack_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">    if self.user.provider == &#39;slack&#39; &amp;&amp;</code>
        </li>
      
        <li class="covered" data-hits="396" data-linenumber="62">
          <span class="hits">396</span>
          
          <code class="ruby">        self.team.setting(:slack_teams)&amp;.is_a?(Hash) &amp;&amp;</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="63">
          <span class="hits">3</span>
          
          <code class="ruby">        (!self.team.setting(:slack_teams)&amp;.keys&amp;.include? self.user.omniauth_info&amp;.dig(&#39;info&#39;, &#39;team_id&#39;))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="65">
          <span class="hits">2</span>
          
          <code class="ruby">        errors.add(:base, &quot;Sorry, you cannot join #{self.team.name} because it is restricted to members of the Slack #{&quot;team&quot;.pluralize(self.team.setting(:slack_teams).values.length)} #{self.team.setting(:slack_teams).values.join(&#39;, &#39;)}.&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="b0537800926380b7cdf65d6d3ffdafb22f58f28c">
  <div class="header">
    <h3>app/models/user.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>113</b> relevant lines. 
      <span class="green"><b>113</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class User &lt; ActiveRecord::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessible :email, :login, :name, :profile_image, :password, :password_confirmation, :image</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  attr_accessor :url</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">  has_one :source</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :team_users</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :teams, through: :team_users</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">  has_many :projects</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  devise :database_authenticatable, :registerable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">         :recoverable, :rememberable, :trackable, :validatable,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">         :omniauthable, omniauth_providers: [:twitter, :facebook, :slack]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  after_create :set_image, :create_source_and_account, :send_welcome_email</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  before_save :set_token, :set_login, :set_uuid</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  mount_uploader :image, ImageUploader</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  validates :image, size: true</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">  validate :user_is_member_in_current_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  serialize :omniauth_info</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  include CheckdeskSettings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  ROLES = %w[contributor journalist editor owner admin]</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">  def role?(base_role, context_team)</code>
        </li>
      
        <li class="covered" data-hits="1978" data-linenumber="27">
          <span class="hits">1978</span>
          
          <code class="ruby">    ROLES.index(base_role.to_s) &lt;= ROLES.index(self.role(context_team)) unless self.role(context_team).nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def role(context_team)</code>
        </li>
      
        <li class="covered" data-hits="3588" data-linenumber="31">
          <span class="hits">3588</span>
          
          <code class="ruby">    context_team = self.current_team if context_team.nil?</code>
        </li>
      
        <li class="covered" data-hits="3588" data-linenumber="32">
          <span class="hits">3588</span>
          
          <code class="ruby">    role = nil</code>
        </li>
      
        <li class="covered" data-hits="3588" data-linenumber="33">
          <span class="hits">3588</span>
          
          <code class="ruby">    unless context_team.nil?</code>
        </li>
      
        <li class="covered" data-hits="3343" data-linenumber="34">
          <span class="hits">3343</span>
          
          <code class="ruby">      role = Rails.cache.fetch(&quot;role_#{context_team.id}_#{self.id}&quot;, expires_in: 30.seconds) do</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="35">
          <span class="hits">204</span>
          
          <code class="ruby">        tu = TeamUser.where(team_id: context_team.id, user_id: self.id, status: &#39;member&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="204" data-linenumber="36">
          <span class="hits">204</span>
          
          <code class="ruby">        tu.nil? ? nil : tu.role.to_s</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="3588" data-linenumber="39">
          <span class="hits">3588</span>
          
          <code class="ruby">    role</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.from_omniauth(auth)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="43">
          <span class="hits">11</span>
          
          <code class="ruby">    token = User.token(auth.provider, auth.uid, auth.credentials.token, auth.credentials.secret)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="44">
          <span class="hits">11</span>
          
          <code class="ruby">    user = User.where(provider: auth.provider, uuid: auth.uid).first || User.new</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="45">
          <span class="hits">11</span>
          
          <code class="ruby">    user.email = user.email.presence || auth.info.email</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="46">
          <span class="hits">11</span>
          
          <code class="ruby">    user.password ||= Devise.friendly_token[0,20]</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="47">
          <span class="hits">11</span>
          
          <code class="ruby">    user.name = auth.info.name</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="48">
          <span class="hits">11</span>
          
          <code class="ruby">    user.uuid = auth.uid</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="49">
          <span class="hits">11</span>
          
          <code class="ruby">    user.provider = auth.provider</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="50">
          <span class="hits">11</span>
          
          <code class="ruby">    user.profile_image = auth.info.image</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">    user.token = token</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="52">
          <span class="hits">11</span>
          
          <code class="ruby">    user.url = auth.url</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="53">
          <span class="hits">11</span>
          
          <code class="ruby">    user.login = auth.info.nickname || auth.info.name.tr(&#39; &#39;, &#39;-&#39;).downcase</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="54">
          <span class="hits">11</span>
          
          <code class="ruby">    user.omniauth_info = auth.as_json</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="55">
          <span class="hits">11</span>
          
          <code class="ruby">    user.save!</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="56">
          <span class="hits">10</span>
          
          <code class="ruby">    user.reload</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="59">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.token(provider, id, token, secret)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="60">
          
          
          <code class="ruby">    Base64.encode64({</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      provider: provider.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby">      id: id.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">      token: token.to_s,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">      secret: secret.to_s</code>
        </li>
      
        <li class="covered" data-hits="17" data-linenumber="65">
          <span class="hits">17</span>
          
          <code class="ruby">    }.to_json).gsub(&quot;\n&quot;, &#39;++n&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="68">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.from_token(token)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    JSON.parse(Base64.decode64(token.gsub(&#39;++n&#39;, &quot;\n&quot;)))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">  def as_json(_options = {})</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="73">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      id: Base64.encode64(&quot;User/#{self.id}&quot;),</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      dbid: self.id,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">      name: self.name,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">      email: self.email,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">      login: self.login,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">      uuid: self.uuid,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="80">
          
          
          <code class="ruby">      provider: self.provider,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">      token: self.token,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">      current_team: self.current_team,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="83">
          
          
          <code class="ruby">      teams: self.user_teams,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      team_ids: self.team_ids,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">      permissions: self.permissions</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="86">
          <span class="hits">8</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="89">
          <span class="hits">1</span>
          
          <code class="ruby">  def email_required?</code>
        </li>
      
        <li class="covered" data-hits="2231" data-linenumber="90">
          <span class="hits">2231</span>
          
          <code class="ruby">    self.provider.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  def password_required?</code>
        </li>
      
        <li class="covered" data-hits="4462" data-linenumber="94">
          <span class="hits">4462</span>
          
          <code class="ruby">    super &amp;&amp; self.provider.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def current_team</code>
        </li>
      
        <li class="covered" data-hits="588" data-linenumber="98">
          <span class="hits">588</span>
          
          <code class="ruby">    if self.current_team_id.blank?</code>
        </li>
      
        <li class="covered" data-hits="544" data-linenumber="99">
          <span class="hits">544</span>
          
          <code class="ruby">      tu = TeamUser.where(user_id: self.id, status: &#39;member&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="544" data-linenumber="100">
          <span class="hits">544</span>
          
          <code class="ruby">      tu.team unless tu.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="101">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="102">
          <span class="hits">44</span>
          
          <code class="ruby">      Team.where(id: self.current_team_id).last</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_teams</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="107">
          <span class="hits">9</span>
          
          <code class="ruby">    team_users = TeamUser.where(user_id: self.id)</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="108">
          <span class="hits">9</span>
          
          <code class="ruby">    teams = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="109">
          <span class="hits">9</span>
          
          <code class="ruby">    team_users.each do |tu|</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="110">
          <span class="hits">4</span>
          
          <code class="ruby">      teams[tu.team.name] = tu.as_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="112">
          <span class="hits">9</span>
          
          <code class="ruby">    teams.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="113">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="114">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="115">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_member_of?(team)</code>
        </li>
      
        <li class="covered" data-hits="66" data-linenumber="116">
          <span class="hits">66</span>
          
          <code class="ruby">    !self.team_users.select{ |tu| tu.team_id == team.id &amp;&amp; tu.status == &#39;member&#39; }.empty?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="117">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="119">
          <span class="hits">1</span>
          
          <code class="ruby">  def handle</code>
        </li>
      
        <li class="covered" data-hits="328" data-linenumber="120">
          <span class="hits">328</span>
          
          <code class="ruby">    if self.provider.blank?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="121">
          <span class="hits">2</span>
          
          <code class="ruby">      self.email</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="122">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="326" data-linenumber="123">
          <span class="hits">326</span>
          
          <code class="ruby">      provider = self.provider.capitalize</code>
        </li>
      
        <li class="covered" data-hits="326" data-linenumber="124">
          <span class="hits">326</span>
          
          <code class="ruby">      if !self.omniauth_info.nil?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="125">
          <span class="hits">5</span>
          
          <code class="ruby">        if self.provider == &#39;slack&#39;</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="126">
          <span class="hits">4</span>
          
          <code class="ruby">          provider = self.omniauth_info.dig(&#39;extra&#39;, &#39;raw_info&#39;, &#39;url&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">          provider = self.omniauth_info.dig(&#39;url&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="129">
          <span class="hits">1</span>
          
          <code class="ruby">          return provider if !provider.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="130">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="131">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="325" data-linenumber="132">
          <span class="hits">325</span>
          
          <code class="ruby">      &quot;#{self.login} at #{provider}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="133">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="134">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="136">
          
          
          <code class="ruby">  # Whether two users are members of any same team</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="137">
          <span class="hits">1</span>
          
          <code class="ruby">  def is_a_colleague_of?(user)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="138">
          <span class="hits">13</span>
          
          <code class="ruby">    results = TeamUser.find_by_sql([&#39;SELECT COUNT(*) AS count FROM team_users tu1 INNER JOIN team_users tu2 ON tu1.team_id = tu2.team_id WHERE tu1.user_id = :user1 AND tu2.user_id = :user2 AND tu1.status = :status AND tu2.status = :status&#39;, { user1: self.id, user2: user.id, status: &#39;member&#39; }])</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="139">
          <span class="hits">13</span>
          
          <code class="ruby">    results.first.count.to_i &gt;= 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="140">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="142">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="143">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="144">
          <span class="hits">1</span>
          
          <code class="ruby">  def create_source_and_account</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="145">
          <span class="hits">2152</span>
          
          <code class="ruby">    source = Source.new</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="146">
          <span class="hits">2152</span>
          
          <code class="ruby">    source.user = self</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="147">
          <span class="hits">2152</span>
          
          <code class="ruby">    source.name = self.name</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="148">
          <span class="hits">2152</span>
          
          <code class="ruby">    source.avatar = self.profile_image</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="149">
          <span class="hits">2152</span>
          
          <code class="ruby">    source.slogan = self.name</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="150">
          <span class="hits">2152</span>
          
          <code class="ruby">    source.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="151">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="2151" data-linenumber="152">
          <span class="hits">2151</span>
          
          <code class="ruby">    if !self.provider.blank? &amp;&amp; !self.url.blank?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="153">
          <span class="hits">10</span>
          
          <code class="ruby">      begin</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="154">
          <span class="hits">10</span>
          
          <code class="ruby">        account = Account.new</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="155">
          <span class="hits">10</span>
          
          <code class="ruby">        account.user = self</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="156">
          <span class="hits">10</span>
          
          <code class="ruby">        account.source = source</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="157">
          <span class="hits">10</span>
          
          <code class="ruby">        account.url = self.url</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="158">
          <span class="hits">10</span>
          
          <code class="ruby">        account.save</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="159">
          <span class="hits">2</span>
          
          <code class="ruby">      rescue Errno::ECONNREFUSED =&gt; e</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="160">
          <span class="hits">2</span>
          
          <code class="ruby">        Rails.logger.info &quot;Could not create account for user ##{self.id}: #{e.message}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="161">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="164">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="165">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_token</code>
        </li>
      
        <li class="covered" data-hits="2233" data-linenumber="166">
          <span class="hits">2233</span>
          
          <code class="ruby">    self.token = User.token(&#39;checkdesk&#39;, self.id, Devise.friendly_token[0, 8], Devise.friendly_token[0, 8]) if self.token.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="167">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="168">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="169">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_login</code>
        </li>
      
        <li class="covered" data-hits="2233" data-linenumber="170">
          <span class="hits">2233</span>
          
          <code class="ruby">    if self.login.blank?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="171">
          <span class="hits">5</span>
          
          <code class="ruby">      if self.email.blank?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="172">
          <span class="hits">1</span>
          
          <code class="ruby">        self.login = self.name.tr(&#39; &#39;, &#39;-&#39;).downcase</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="173">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="174">
          <span class="hits">4</span>
          
          <code class="ruby">        self.login = self.email.split(&#39;@&#39;)[0]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="176">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="179">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_uuid</code>
        </li>
      
        <li class="covered" data-hits="2233" data-linenumber="180">
          <span class="hits">2233</span>
          
          <code class="ruby">    self.uuid = (&#39;checkdesk_&#39; + Digest::MD5.hexdigest(self.email)) if self.uuid.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="182">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="183">
          <span class="hits">1</span>
          
          <code class="ruby">  def send_welcome_email</code>
        </li>
      
        <li class="covered" data-hits="2151" data-linenumber="184">
          <span class="hits">2151</span>
          
          <code class="ruby">    RegistrationMailer.welcome_email(self).deliver_now if self.provider.blank? &amp;&amp; CONFIG[&#39;send_welcome_email_on_registration&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="185">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="186">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="187">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_image</code>
        </li>
      
        <li class="covered" data-hits="2152" data-linenumber="188">
          <span class="hits">2152</span>
          
          <code class="ruby">    if self.profile_image.blank?</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="189">
          <span class="hits">4</span>
          
          <code class="ruby">      self.profile_image = CONFIG[&#39;checkdesk_base_url&#39;] + User.find(self.id).image.url</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="190">
          <span class="hits">4</span>
          
          <code class="ruby">      self.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="192">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="194">
          <span class="hits">1</span>
          
          <code class="ruby">  def user_is_member_in_current_team</code>
        </li>
      
        <li class="covered" data-hits="2231" data-linenumber="195">
          <span class="hits">2231</span>
          
          <code class="ruby">    unless self.current_team_id.blank?</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="196">
          <span class="hits">56</span>
          
          <code class="ruby">      tu = TeamUser.where(user_id: self.id, team_id: self.current_team_id, status: &#39;member&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="56" data-linenumber="197">
          <span class="hits">56</span>
          
          <code class="ruby">      errors.add(:base, &quot;User not a member in team #{self.current_team_id}&quot;) if tu.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="e7ae00f2fff863f10826ae9cac50e31e7031020e">
  <div class="header">
    <h3>app/uploaders/image_uploader.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>9</b> relevant lines. 
      <span class="green"><b>9</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># encoding: utf-8</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">class ImageUploader &lt; CarrierWave::Uploader::Base</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">  include CarrierWave::MiniMagick</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  storage :file</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">  # Override the directory where uploaded files will be stored.</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  # This is a sensible default for uploaders that are meant to be mounted:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">  def store_dir</code>
        </li>
      
        <li class="covered" data-hits="1846" data-linenumber="11">
          <span class="hits">1846</span>
          
          <code class="ruby">   &quot;uploads/#{model.class.to_s.underscore}/#{model.id}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  # Provide a default URL as a default if there hasn&#39;t been a file uploaded:</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def default_url</code>
        </li>
      
        <li class="covered" data-hits="1851" data-linenumber="16">
          <span class="hits">1851</span>
          
          <code class="ruby">    &quot;/images/#{model.class.to_s.underscore}.png&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  # Add a white list of extensions which are allowed to be uploaded.</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">  def extension_white_list</code>
        </li>
      
        <li class="covered" data-hits="3723" data-linenumber="21">
          <span class="hits">3723</span>
          
          <code class="ruby">    %w(jpg jpeg gif png)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="f3b23561a9fcf2345abfa09b39f63d04c3d61fd4">
  <div class="header">
    <h3>lib/api_constraints.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>8</b> relevant lines. 
      <span class="green"><b>8</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class ApiConstraints</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(options)</code>
        </li>
      
        <li class="covered" data-hits="608" data-linenumber="3">
          <span class="hits">608</span>
          
          <code class="ruby">    @version = options[:version]</code>
        </li>
      
        <li class="covered" data-hits="608" data-linenumber="4">
          <span class="hits">608</span>
          
          <code class="ruby">    @default = options[:default]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def matches?(req)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="8">
          <span class="hits">2</span>
          
          <code class="ruby">    @default || req.headers[&#39;Accept&#39;].include?(ApiConstraints.accept(@version))</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.accept(version = 1)</code>
        </li>
      
        <li class="covered" data-hits="114" data-linenumber="12">
          <span class="hits">114</span>
          
          <code class="ruby">    &quot;application/vnd.lapis.v#{version}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="31f9451ecbc63c7a488abf4fc5cd289b19926677">
  <div class="header">
    <h3>lib/check_search.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>148</b> relevant lines. 
      <span class="green"><b>148</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class CheckSearch</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(options, context_team = nil)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">    # options include keywords, projects, tags, status</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="5">
          <span class="hits">65</span>
          
          <code class="ruby">    @options = JSON.parse(options)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="6">
          <span class="hits">65</span>
          
          <code class="ruby">    if @options[&quot;projects&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="32" data-linenumber="7">
          <span class="hits">32</span>
          
          <code class="ruby">      @options[&quot;projects&quot;] = context_team.projects.map(&amp;:id) unless context_team.nil?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    # set sort options</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="10">
          <span class="hits">65</span>
          
          <code class="ruby">    @options[&#39;sort&#39;] = @options[&#39;sort&#39;] ||= &#39;recent_added&#39;</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="11">
          <span class="hits">65</span>
          
          <code class="ruby">    @options[&#39;sort_type&#39;] = @options[&#39;sort_type&#39;] ||= &#39;DESC&#39;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">  def id</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="15">
          <span class="hits">5</span>
          
          <code class="ruby">    Base64.encode64(&quot;CheckSearch/#{@options.to_json}&quot;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">  def create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">    # query_a to fetch keyword/context</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="20">
          <span class="hits">61</span>
          
          <code class="ruby">    ids = {}</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="21">
          <span class="hits">61</span>
          
          <code class="ruby">    if @options[&quot;keyword&quot;].blank? and @options[&quot;tags&quot;].blank? and @options[&quot;status&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="22">
          <span class="hits">10</span>
          
          <code class="ruby">      ids = build_search_query_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="24">
          <span class="hits">51</span>
          
          <code class="ruby">      ids = build_search_query_for_non_blank</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="25">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">    # query_c to fetch status</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="27">
          <span class="hits">61</span>
          
          <code class="ruby">    ids = build_search_query_for_status(ids) unless @options[&quot;status&quot;].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">    # query to collect latest timestamp for media activities</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="29">
          <span class="hits">61</span>
          
          <code class="ruby">    ids = build_search_query_recent_activity(ids) if self.allow_sort_by_recent_activity?</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="30">
          <span class="hits">61</span>
          
          <code class="ruby">    check_search_sort(ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_result</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="34">
          <span class="hits">61</span>
          
          <code class="ruby">    self.create</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">  def medias</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">    # should loop in search result and return media</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="39">
          
          
          <code class="ruby">    # for now all results are medias</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="40">
          <span class="hits">9</span>
          
          <code class="ruby">    @search_result ||= self.search_result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="43">
          <span class="hits">1</span>
          
          <code class="ruby">  def number_of_results</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="44">
          <span class="hits">5</span>
          
          <code class="ruby">    self.medias.count</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="46">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="47">
          <span class="hits">1</span>
          
          <code class="ruby">  protected</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="49">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_for_status(ids)</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="50">
          <span class="hits">14</span>
          
          <code class="ruby">    ids_c = build_search_query_c</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="51">
          <span class="hits">14</span>
          
          <code class="ruby">    if !ids.blank? and !ids_c.blank?</code>
        </li>
      
        <li class="covered" data-hits="16" data-linenumber="52">
          <span class="hits">16</span>
          
          <code class="ruby">      ids = ids.keep_if { |k, _v| ids_c.key? k }</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="53">
          <span class="hits">7</span>
          
          <code class="ruby">      ids = fetch_media_projects(ids, ids, ids_c)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="54">
          
          
          <code class="ruby">    elsif !ids_c.blank?</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="55">
          <span class="hits">5</span>
          
          <code class="ruby">      ids = ids_c</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="57">
          <span class="hits">14</span>
          
          <code class="ruby">    ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="58">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="60">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_for_non_blank</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="61">
          <span class="hits">51</span>
          
          <code class="ruby">    ids_a = build_search_query_a unless @options[&quot;keyword&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="62">
          <span class="hits">51</span>
          
          <code class="ruby">    ids_b = build_search_query_b unless @options[&quot;tags&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="63">
          <span class="hits">51</span>
          
          <code class="ruby">    ids = []</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="64">
          <span class="hits">51</span>
          
          <code class="ruby">    if !ids_a.blank? and !ids_b.blank?</code>
        </li>
      
        <li class="covered" data-hits="36" data-linenumber="65">
          <span class="hits">36</span>
          
          <code class="ruby">      ids = ids_a.keep_if { |k, _v| ids_b.key? k }</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="66">
          <span class="hits">11</span>
          
          <code class="ruby">      ids = fetch_media_projects(ids, ids_a, ids_b)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="68">
          <span class="hits">40</span>
          
          <code class="ruby">      ids = build_search_query_for_keywords_or_tags(ids, ids_a, ids_b)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="51" data-linenumber="70">
          <span class="hits">51</span>
          
          <code class="ruby">    ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_for_keywords_or_tags(ids, ids_a, ids_b)</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="74">
          <span class="hits">40</span>
          
          <code class="ruby">    ret = ids</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="75">
          <span class="hits">40</span>
          
          <code class="ruby">    if !ids_a.blank?</code>
        </li>
      
        <li class="covered" data-hits="22" data-linenumber="76">
          <span class="hits">22</span>
          
          <code class="ruby">      ret = ids_a</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">    elsif !ids_b.blank?</code>
        </li>
      
        <li class="covered" data-hits="9" data-linenumber="78">
          <span class="hits">9</span>
          
          <code class="ruby">      ret = ids_b</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="79">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="40" data-linenumber="80">
          <span class="hits">40</span>
          
          <code class="ruby">    ret</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">  def should_add_key?(context)</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="84">
          <span class="hits">177</span>
          
          <code class="ruby">    add_key = true</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="85">
          <span class="hits">177</span>
          
          <code class="ruby">    unless @options[&#39;status&#39;].blank?</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="86">
          <span class="hits">48</span>
          
          <code class="ruby">      if context[:recent_activity][:hits][:hits][0][:_source].has_key?(:status) &amp;&amp; !@options[&#39;status&#39;].include?(context[:recent_activity][:hits][:hits][0][:_source][:status])</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="87">
          <span class="hits">10</span>
          
          <code class="ruby">        add_key = false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="90">
          <span class="hits">177</span>
          
          <code class="ruby">    add_key</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="91">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="92">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="93">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_search_buckets(query, aggs)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="94">
          <span class="hits">92</span>
          
          <code class="ruby">    Annotation.search(query: query, aggs: aggs, size: 10000).response[&#39;aggregations&#39;][&#39;annotated&#39;][&#39;buckets&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="96">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="97">
          <span class="hits">1</span>
          
          <code class="ruby">  def allow_sort_by_recent_activity?</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="98">
          <span class="hits">61</span>
          
          <code class="ruby">    if @options[&#39;sort&#39;] == &#39;recent_activity&#39;</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="99">
          <span class="hits">13</span>
          
          <code class="ruby">      return true if @options[&quot;status&quot;].blank? or @options[&quot;tags&quot;].blank? or !@options[&quot;keyword&quot;].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="100">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="48" data-linenumber="101">
          <span class="hits">48</span>
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="102">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="104">
          <span class="hits">1</span>
          
          <code class="ruby">  def search_ignore_context?(context_ids, id)</code>
        </li>
      
        <li class="covered" data-hits="175" data-linenumber="105">
          <span class="hits">175</span>
          
          <code class="ruby">    unless @options[&#39;projects&#39;].include? id.to_i</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="106">
          <span class="hits">5</span>
          
          <code class="ruby">      return true unless context_ids.has_key? id.to_i</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="107">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="170" data-linenumber="108">
          <span class="hits">170</span>
          
          <code class="ruby">    false</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="109">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="111">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="113">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_a</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="114">
          <span class="hits">44</span>
          
          <code class="ruby">    if @options[&quot;keyword&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="115">
          <span class="hits">10</span>
          
          <code class="ruby">      query = { match_all: {} }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="116">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="34" data-linenumber="117">
          <span class="hits">34</span>
          
          <code class="ruby">      query = { query_string: { query: @options[&quot;keyword&quot;], fields:  %w(title description quote text), default_operator: &quot;AND&quot; } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="118">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="119">
          <span class="hits">44</span>
          
          <code class="ruby">    filters = [{terms: { annotation_type: %w(embed comment) } } ]</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="120">
          <span class="hits">44</span>
          
          <code class="ruby">    filters &lt;&lt; {term: { annotated_type: &quot;media&quot;}}</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="121">
          <span class="hits">44</span>
          
          <code class="ruby">    context_ids = @options[&quot;projects&quot;].blank? ? [0] : @options[&quot;projects&quot;]</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="122">
          <span class="hits">44</span>
          
          <code class="ruby">    context_filters = [ {terms: { context_id: context_ids } } ]</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="123">
          <span class="hits">44</span>
          
          <code class="ruby">    context_filters &lt;&lt; {terms: { search_context: context_ids } }</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="124">
          <span class="hits">44</span>
          
          <code class="ruby">    filter = { bool: { should: [ context_filters ] , must: [ filters ] } }</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="125">
          <span class="hits">44</span>
          
          <code class="ruby">    get_search_result(query, filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="126">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="127">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="128">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_b</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="129">
          <span class="hits">21</span>
          
          <code class="ruby">    query = { match_all: {} }</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="130">
          <span class="hits">21</span>
          
          <code class="ruby">    filters = []</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="131">
          <span class="hits">21</span>
          
          <code class="ruby">    unless @options[&quot;tags&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="42" data-linenumber="132">
          <span class="hits">42</span>
          
          <code class="ruby">      tags = @options[&quot;tags&quot;].collect{ |t| t.delete(&#39;#&#39;) }</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="133">
          <span class="hits">21</span>
          
          <code class="ruby">      tags.each do |tag|</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="134">
          <span class="hits">21</span>
          
          <code class="ruby">        filters &lt;&lt; { match: { full_tag: { query: tag, operator: &#39;and&#39; } } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="135">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="136">
          <span class="hits">21</span>
          
          <code class="ruby">      filters &lt;&lt; { terms: { tag: tags } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="137">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="138">
          <span class="hits">21</span>
          
          <code class="ruby">    filter = { bool: { should: filters } }</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="139">
          <span class="hits">21</span>
          
          <code class="ruby">    filter[:bool][:must] = { terms: { context_id: @options[&quot;projects&quot;]} } unless @options[&quot;projects&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="140">
          <span class="hits">21</span>
          
          <code class="ruby">    get_search_result(query, filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="141">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="142">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="143">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_c</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="144">
          <span class="hits">14</span>
          
          <code class="ruby">    query = { match_all: {} }</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="145">
          <span class="hits">14</span>
          
          <code class="ruby">    filters = [ {term: { annotation_type: &quot;status&quot; } } ]</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="146">
          <span class="hits">14</span>
          
          <code class="ruby">    filters &lt;&lt; { terms: { context_id: @options[&quot;projects&quot;]} } unless @options[&quot;projects&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="147">
          <span class="hits">14</span>
          
          <code class="ruby">    filter = { bool: { must: [ filters ] } }</code>
        </li>
      
        <li class="covered" data-hits="14" data-linenumber="148">
          <span class="hits">14</span>
          
          <code class="ruby">    get_search_result(query, filter)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="149">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="150">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="151">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query_recent_activity(media_ids)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="152">
          <span class="hits">13</span>
          
          <code class="ruby">    query = { match_all: {} }</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="153">
          <span class="hits">13</span>
          
          <code class="ruby">    types = [&#39;flag&#39;, &#39;status&#39;]</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="154">
          <span class="hits">13</span>
          
          <code class="ruby">    types &lt;&lt; &#39;tag&#39; if @options[&#39;tag&#39;].blank?</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="155">
          <span class="hits">13</span>
          
          <code class="ruby">    types &lt;&lt; &#39;comment&#39; unless @options[&quot;keyword&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="156">
          <span class="hits">13</span>
          
          <code class="ruby">    filters = []</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="157">
          <span class="hits">13</span>
          
          <code class="ruby">    filters &lt;&lt; { terms: { annotation_type: types } }</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="158">
          <span class="hits">13</span>
          
          <code class="ruby">    filters &lt;&lt; { terms: { context_id: @options[&quot;projects&quot;]} } unless @options[&quot;projects&quot;].blank?</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="159">
          <span class="hits">13</span>
          
          <code class="ruby">    filter = { bool: { must: [ filters ] } }</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="160">
          <span class="hits">13</span>
          
          <code class="ruby">    ids = get_search_result(query, filter)</code>
        </li>
      
        <li class="covered" data-hits="13" data-linenumber="161">
          <span class="hits">13</span>
          
          <code class="ruby">    fetch_media_projects(media_ids, media_ids, ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="162">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="163">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="164">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_search_result(query, filter)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="165">
          <span class="hits">92</span>
          
          <code class="ruby">    q, g = build_search_query(query, filter)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="166">
          <span class="hits">92</span>
          
          <code class="ruby">    ids = {}</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="167">
          <span class="hits">92</span>
          
          <code class="ruby">    self.get_search_buckets(q, g).each do |result|</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="168">
          <span class="hits">174</span>
          
          <code class="ruby">      context_ids = {}</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="169">
          <span class="hits">174</span>
          
          <code class="ruby">      result[:context][:buckets].each do |context|</code>
        </li>
      
        <li class="covered" data-hits="177" data-linenumber="170">
          <span class="hits">177</span>
          
          <code class="ruby">        if self.should_add_key?(context)</code>
        </li>
      
        <li class="covered" data-hits="167" data-linenumber="171">
          <span class="hits">167</span>
          
          <code class="ruby">          if context[&#39;key&#39;] == &#39;no_key&#39;</code>
        </li>
      
        <li class="covered" data-hits="21" data-linenumber="172">
          <span class="hits">21</span>
          
          <code class="ruby">            context[:recent_activity][:hits][:hits][0][:_source][:search_context].each do |sc|</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="173">
          <span class="hits">29</span>
          
          <code class="ruby">              context_ids[sc.to_i] = context[:recent_activity][:hits][:hits][0][:sort][0] unless self.search_ignore_context?(context_ids, sc)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="174">
          
          
          <code class="ruby">            end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="175">
          
          
          <code class="ruby">          else</code>
        </li>
      
        <li class="covered" data-hits="146" data-linenumber="176">
          <span class="hits">146</span>
          
          <code class="ruby">            context_ids[context[&#39;key&#39;].to_i] = context[:recent_activity][:hits][:hits][0][:sort][0] unless self.search_ignore_context?(context_ids, context[&#39;key&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="177">
          
          
          <code class="ruby">          end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="178">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="179">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="covered" data-hits="174" data-linenumber="180">
          <span class="hits">174</span>
          
          <code class="ruby">      ids[result[&#39;key&#39;].to_i] = context_ids unless context_ids.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="181">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="182">
          <span class="hits">92</span>
          
          <code class="ruby">    ids</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="183">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="184">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="185">
          <span class="hits">1</span>
          
          <code class="ruby">  def build_search_query(query, filter)</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="186">
          <span class="hits">92</span>
          
          <code class="ruby">    q = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="187">
          
          
          <code class="ruby">      filtered: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="188">
          
          
          <code class="ruby">        query: query,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="189">
          
          
          <code class="ruby">        filter: filter</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="190">
          
          
          <code class="ruby">      }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="191">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="192">
          <span class="hits">92</span>
          
          <code class="ruby">    g = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="193">
          
          
          <code class="ruby">      annotated: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="194">
          
          
          <code class="ruby">        terms: { field: :annotated_id, size: 10000 },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="195">
          
          
          <code class="ruby">        aggs: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="196">
          
          
          <code class="ruby">          context: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="197">
          
          
          <code class="ruby">            terms: { field: :context_id, missing: :no_key },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="198">
          
          
          <code class="ruby">              aggs: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="199">
          
          
          <code class="ruby">                recent_activity: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="200">
          
          
          <code class="ruby">                  top_hits: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="201">
          
          
          <code class="ruby">                    sort: [ { created_at: { order: :desc, ignore_unmapped: true } } ],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="202">
          
          
          <code class="ruby">                    _source: { include: %w(status context_id search_context) },</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="203">
          
          
          <code class="ruby">                    size: 1</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="204">
          
          
          <code class="ruby">                  }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="205">
          
          
          <code class="ruby">                }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="206">
          
          
          <code class="ruby">              }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="207">
          
          
          <code class="ruby">            }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="208">
          
          
          <code class="ruby">          }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="209">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="210">
          
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="covered" data-hits="92" data-linenumber="211">
          <span class="hits">92</span>
          
          <code class="ruby">    return q, g</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="212">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="213">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="214">
          <span class="hits">1</span>
          
          <code class="ruby">  def fetch_media_projects(ids, ids_a, ids_b)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="215">
          
          
          <code class="ruby">    # Get max timestamp for ProjectMedia accross different arrays.</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="216">
          <span class="hits">31</span>
          
          <code class="ruby">    ids_p = {}</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="217">
          <span class="hits">31</span>
          
          <code class="ruby">    ids.each do |k, _v|</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="218">
          <span class="hits">59</span>
          
          <code class="ruby">      v_a = ids_a[k]</code>
        </li>
      
        <li class="covered" data-hits="59" data-linenumber="219">
          <span class="hits">59</span>
          
          <code class="ruby">      v_b = ids_b.key?(k) ? ids_b[k] : {}</code>
        </li>
      
        <li class="covered" data-hits="119" data-linenumber="220">
          <span class="hits">119</span>
          
          <code class="ruby">      ids_p[k] = v_a.keep_if { |kp, _vp| v_b.key? kp }</code>
        </li>
      
        <li class="covered" data-hits="119" data-linenumber="221">
          <span class="hits">119</span>
          
          <code class="ruby">      ids_p[k].each{|km, _vm| ids_p[k][km] = [v_a[km], v_b[km]].max}</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="222">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="31" data-linenumber="223">
          <span class="hits">31</span>
          
          <code class="ruby">    ids_p</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="224">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="225">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="226">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_search_sort(ids)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="227">
          <span class="hits">61</span>
          
          <code class="ruby">    ids = prepare_ids_for_sort(ids)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="228">
          <span class="hits">61</span>
          
          <code class="ruby">    ids_sort = Array.new</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="229">
          
          
          <code class="ruby">    # sort array based on sort type &#39;DESC&#39; or &#39;ASC&#39;</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="230">
          <span class="hits">61</span>
          
          <code class="ruby">    if @options[&#39;sort_type&#39;].upcase == &#39;DESC&#39;</code>
        </li>
      
        <li class="covered" data-hits="58" data-linenumber="231">
          <span class="hits">58</span>
          
          <code class="ruby">      ids = ids.sort_by(&amp;:reverse).reverse</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="232">
          
          
          <code class="ruby">    else</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="233">
          <span class="hits">3</span>
          
          <code class="ruby">      ids = ids.sort_by(&amp;:reverse)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="234">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="235">
          
          
          <code class="ruby">    # load medias wither therir projects</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="236">
          <span class="hits">61</span>
          
          <code class="ruby">    ids.each do |k, _v|</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="237">
          <span class="hits">105</span>
          
          <code class="ruby">      p, m = k.split(&#39;-&#39;)</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="238">
          <span class="hits">105</span>
          
          <code class="ruby">      media = Media.where(id: m.to_i).last</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="239">
          <span class="hits">105</span>
          
          <code class="ruby">      unless media.nil?</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="240">
          <span class="hits">104</span>
          
          <code class="ruby">        media.project_id = p.to_i unless p.blank?</code>
        </li>
      
        <li class="covered" data-hits="104" data-linenumber="241">
          <span class="hits">104</span>
          
          <code class="ruby">        ids_sort &lt;&lt; media</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="242">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="243">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="244">
          <span class="hits">61</span>
          
          <code class="ruby">    ids_sort</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="245">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="246">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="247">
          <span class="hits">1</span>
          
          <code class="ruby">  def prepare_ids_for_sort(ids)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="248">
          
          
          <code class="ruby">    # construct an array with key [project-media] and value [timestamp/id]</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="249">
          <span class="hits">61</span>
          
          <code class="ruby">    result = {}</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="250">
          <span class="hits">61</span>
          
          <code class="ruby">    ids.each do |m, v|</code>
        </li>
      
        <li class="covered" data-hits="100" data-linenumber="251">
          <span class="hits">100</span>
          
          <code class="ruby">      v.each do |p, t|</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="252">
          <span class="hits">105</span>
          
          <code class="ruby">        pm = [p, m].join(&#39;-&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="253">
          
          
          <code class="ruby">        # set value either timestamp or media id based on sort key</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="254">
          <span class="hits">105</span>
          
          <code class="ruby">        t = m if @options[&#39;sort&#39;] == &#39;recent_added&#39;</code>
        </li>
      
        <li class="covered" data-hits="105" data-linenumber="255">
          <span class="hits">105</span>
          
          <code class="ruby">        result[pm] = t</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="256">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="257">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="258">
          <span class="hits">61</span>
          
          <code class="ruby">    result</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="259">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="260">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="261">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="7eb2c6f064613e949685ee0e7007136ca797bf6b">
  <div class="header">
    <h3>lib/checkdesk_notifications/pusher.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>42</b> relevant lines. 
      <span class="green"><b>42</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CheckdeskNotifications</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Pusher</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">      base.send :extend, ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    def pusher_channel</code>
        </li>
      
        <li class="covered" data-hits="1752" data-linenumber="8">
          <span class="hits">1752</span>
          
          <code class="ruby">      &#39;check-channel-&#39; + Digest::MD5.hexdigest(self.class.name + &#39;:&#39; + self.id.to_s + &#39;:pusher_channel&#39;)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">      def pusher_options</code>
        </li>
      
        <li class="covered" data-hits="2513" data-linenumber="13">
          <span class="hits">2513</span>
          
          <code class="ruby">        @pusher_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      def send_to_pusher(channels, event, data)</code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="17">
          <span class="hits">1416</span>
          
          <code class="ruby">        ::Pusher.trigger(channels, event, { message: data }) unless CONFIG[&#39;pusher_key&#39;].blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      def pusher_options=(options)</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="21">
          <span class="hits">8</span>
          
          <code class="ruby">        @pusher_options = options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="24">
          <span class="hits">1</span>
          
          <code class="ruby">      def notifies_pusher(options = {})</code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="25">
          <span class="hits">8</span>
          
          <code class="ruby">        send(&quot;after_#{options[:on]}&quot;, :notify_pusher)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="27">
          <span class="hits">8</span>
          
          <code class="ruby">        self.pusher_options = options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="8" data-linenumber="29">
          <span class="hits">8</span>
          
          <code class="ruby">        send :include, InstanceMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="33">
          <span class="hits">1</span>
          
          <code class="ruby">    module InstanceMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">      def sent_to_pusher</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="35">
          <span class="hits">3</span>
          
          <code class="ruby">        @sent_to_pusher</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      def sent_to_pusher=(bool)</code>
        </li>
      
        <li class="covered" data-hits="1412" data-linenumber="39">
          <span class="hits">1412</span>
          
          <code class="ruby">        @sent_to_pusher = bool</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      def parse_pusher_options</code>
        </li>
      
        <li class="covered" data-hits="2513" data-linenumber="43">
          <span class="hits">2513</span>
          
          <code class="ruby">        options = self.class.pusher_options</code>
        </li>
      
        <li class="covered" data-hits="2513" data-linenumber="44">
          <span class="hits">2513</span>
          
          <code class="ruby">        return if options.has_key?(:if) &amp;&amp; !options[:if].call(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="46">
          <span class="hits">1416</span>
          
          <code class="ruby">        event = options[:event]</code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="47">
          <span class="hits">1416</span>
          
          <code class="ruby">        targets = options[:targets].call(self)</code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="48">
          <span class="hits">1416</span>
          
          <code class="ruby">        data = options[:data].call(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="50">
          <span class="hits">1416</span>
          
          <code class="ruby">        [event, targets, data]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="53">
          <span class="hits">1</span>
          
          <code class="ruby">      def notify_pusher</code>
        </li>
      
        <li class="covered" data-hits="2513" data-linenumber="54">
          <span class="hits">2513</span>
          
          <code class="ruby">        event, targets, data = self.parse_pusher_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="2513" data-linenumber="56">
          <span class="hits">2513</span>
          
          <code class="ruby">        return if event.blank? || targets.blank? || data.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="57">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="58">
          <span class="hits">1416</span>
          
          <code class="ruby">        channels = targets.map(&amp;:pusher_channel)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1416" data-linenumber="60">
          <span class="hits">1416</span>
          
          <code class="ruby">        Rails.env === &#39;test&#39; ? self.request_pusher(channels, event, data) : CheckdeskNotifications::Pusher::Worker.perform_in(1.second, channels, event, data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="62">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="63">
          <span class="hits">1</span>
          
          <code class="ruby">      def request_pusher(channels, event, data)</code>
        </li>
      
        <li class="covered" data-hits="1412" data-linenumber="64">
          <span class="hits">1412</span>
          
          <code class="ruby">        self.class.send_to_pusher(channels, event, data)</code>
        </li>
      
        <li class="covered" data-hits="1412" data-linenumber="65">
          <span class="hits">1412</span>
          
          <code class="ruby">        self.sent_to_pusher = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="69">
          <span class="hits">1</span>
          
          <code class="ruby">    class Worker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="70">
          <span class="hits">1</span>
          
          <code class="ruby">      include ::Sidekiq::Worker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="71">
          <span class="hits">1</span>
          
          <code class="ruby">      include CheckdeskNotifications::Pusher::ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="73">
          <span class="hits">1</span>
          
          <code class="ruby">      def perform(channels, event, data)</code>
        </li>
      
        <li class="covered" data-hits="4" data-linenumber="74">
          <span class="hits">4</span>
          
          <code class="ruby">        send_to_pusher(channels, event, data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a9bb98762266d03027e7aa1d80cac7f2981b8ad2">
  <div class="header">
    <h3>lib/checkdesk_notifications/slack.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>46</b> relevant lines. 
      <span class="green"><b>46</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CheckdeskNotifications</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  module Slack</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">      base.send :extend, ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    class Request &lt; ::Net::HTTP</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby">  </code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">      def slack_options</code>
        </li>
      
        <li class="covered" data-hits="1867" data-linenumber="12">
          <span class="hits">1867</span>
          
          <code class="ruby">        @slack_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      def slack_options=(options)</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="16">
          <span class="hits">5</span>
          
          <code class="ruby">        @slack_options = options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="17">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="18">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      def request(webhook, data)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="20">
          <span class="hits">11</span>
          
          <code class="ruby">        url = URI.parse(webhook)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="21">
          <span class="hits">11</span>
          
          <code class="ruby">        http = CheckdeskNotifications::Slack::Request.new(url.host, url.port)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="22">
          <span class="hits">11</span>
          
          <code class="ruby">        http.use_ssl = true</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="23">
          <span class="hits">11</span>
          
          <code class="ruby">        request = Net::HTTP::Post.new(url.request_uri)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="24">
          <span class="hits">11</span>
          
          <code class="ruby">        request.set_form_data(data)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="25">
          <span class="hits">11</span>
          
          <code class="ruby">        http.request(request)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="26">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="28">
          <span class="hits">1</span>
          
          <code class="ruby">      def notifies_slack(options = {})</code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="29">
          <span class="hits">5</span>
          
          <code class="ruby">        send(&quot;after_#{options[:on]}&quot;, :notify_slack)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="31">
          <span class="hits">5</span>
          
          <code class="ruby">        self.slack_options = options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">        </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="33">
          <span class="hits">5</span>
          
          <code class="ruby">        send :include, InstanceMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="35">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="37">
          <span class="hits">1</span>
          
          <code class="ruby">    module InstanceMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="38">
          <span class="hits">1</span>
          
          <code class="ruby">      def sent_to_slack</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="39">
          <span class="hits">11</span>
          
          <code class="ruby">        @sent_to_slack</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="40">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="41">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="42">
          <span class="hits">1</span>
          
          <code class="ruby">      def sent_to_slack=(bool)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="43">
          <span class="hits">10</span>
          
          <code class="ruby">        @sent_to_slack = bool</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">      def parse_slack_options</code>
        </li>
      
        <li class="covered" data-hits="1867" data-linenumber="47">
          <span class="hits">1867</span>
          
          <code class="ruby">        options = self.class.slack_options</code>
        </li>
      
        <li class="covered" data-hits="1867" data-linenumber="48">
          <span class="hits">1867</span>
          
          <code class="ruby">        return if options.has_key?(:if) &amp;&amp; !options[:if].call(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="50">
          <span class="hits">11</span>
          
          <code class="ruby">        webhook = options[:webhook].call(self)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="51">
          <span class="hits">11</span>
          
          <code class="ruby">        channel = options[:channel].call(self)</code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="52">
          <span class="hits">11</span>
          
          <code class="ruby">        message = options[:message].call(self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="54">
          <span class="hits">11</span>
          
          <code class="ruby">        [webhook, channel, message]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">      def notify_slack</code>
        </li>
      
        <li class="covered" data-hits="1867" data-linenumber="58">
          <span class="hits">1867</span>
          
          <code class="ruby">        webhook, channel, message = self.parse_slack_options</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="59">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1867" data-linenumber="60">
          <span class="hits">1867</span>
          
          <code class="ruby">        return if webhook.blank? || channel.blank? || message.blank?</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="61">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="62">
          <span class="hits">11</span>
          
          <code class="ruby">        data = {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="63">
          
          
          <code class="ruby">          payload: {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="64">
          
          
          <code class="ruby">            channel: channel,</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="65">
          
          
          <code class="ruby">            text: message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby">          }.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="67">
          
          
          <code class="ruby">        }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="68">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="11" data-linenumber="69">
          <span class="hits">11</span>
          
          <code class="ruby">        Rails.env === &#39;test&#39; ? self.request_slack(webhook, data) : CheckdeskNotifications::Slack::Worker.perform_async(webhook, data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="71">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="72">
          <span class="hits">1</span>
          
          <code class="ruby">      def request_slack(webhook, data)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="73">
          <span class="hits">10</span>
          
          <code class="ruby">        self.class.request(webhook, data)</code>
        </li>
      
        <li class="covered" data-hits="10" data-linenumber="74">
          <span class="hits">10</span>
          
          <code class="ruby">        self.sent_to_slack = true</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="76">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="78">
          <span class="hits">1</span>
          
          <code class="ruby">    class Worker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">      include ::Sidekiq::Worker</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="80">
          <span class="hits">1</span>
          
          <code class="ruby">      include CheckdeskNotifications::Slack::ClassMethods</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="81">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="82">
          <span class="hits">1</span>
          
          <code class="ruby">      def perform(webhook, data)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="83">
          <span class="hits">1</span>
          
          <code class="ruby">        request(webhook, data)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="84">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="85">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="87">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="3576ac61feea84965940cf4a5fe49e3434da3509">
  <div class="header">
    <h3>lib/checkdesk_permissions.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>65</b> relevant lines. 
      <span class="green"><b>65</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module CheckdeskPermissions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="7" data-linenumber="4">
          <span class="hits">7</span>
          
          <code class="ruby">    base.extend(ClassMethods)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  class AccessDenied &lt; ::StandardError</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    attr_reader :message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="9">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(message)</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="11">
          <span class="hits">18</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="12">
          <span class="hits">18</span>
          
          <code class="ruby">      @message = message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  module ClassMethods</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">    def find_if_can(id, current_user, context_team, ability = nil)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="18">
          <span class="hits">65</span>
          
          <code class="ruby">      id = id.id if id.is_a?(ActiveRecord::Base)</code>
        </li>
      
        <li class="covered" data-hits="65" data-linenumber="19">
          <span class="hits">65</span>
          
          <code class="ruby">      if current_user.nil?</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">        self.find(id)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="64" data-linenumber="22">
          <span class="hits">64</span>
          
          <code class="ruby">        model = self.name == &#39;Project&#39; ? self.eager_load(medias: { projects: :team }).order(&#39;medias.id DESC&#39;).where(id: id)[0] : self.find(id)</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="23">
          <span class="hits">62</span>
          
          <code class="ruby">        raise ActiveRecord::RecordNotFound if model.nil?</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="24">
          <span class="hits">62</span>
          
          <code class="ruby">        ability ||= Ability.new(current_user, context_team)</code>
        </li>
      
        <li class="covered" data-hits="62" data-linenumber="25">
          <span class="hits">62</span>
          
          <code class="ruby">        if ability.can?(:read, model)</code>
        </li>
      
        <li class="covered" data-hits="44" data-linenumber="26">
          <span class="hits">44</span>
          
          <code class="ruby">          model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">        else</code>
        </li>
      
        <li class="covered" data-hits="18" data-linenumber="28">
          <span class="hits">18</span>
          
          <code class="ruby">          raise AccessDenied, &quot;Sorry, you can&#39;t read this #{model.class.name.downcase}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="30">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="31">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def permissions(ability = nil)</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="35">
          <span class="hits">91</span>
          
          <code class="ruby">    perms = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="36">
          <span class="hits">91</span>
          
          <code class="ruby">    unless self.current_user.nil?</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="37">
          <span class="hits">83</span>
          
          <code class="ruby">      ability ||= Ability.new(self.current_user, self.context_team)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="38">
          <span class="hits">83</span>
          
          <code class="ruby">      perms[&quot;read #{self.class}&quot;] = ability.can?(:read, self)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="39">
          <span class="hits">83</span>
          
          <code class="ruby">      perms[&quot;update #{self.class}&quot;] = ability.can?(:update, self)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="40">
          <span class="hits">83</span>
          
          <code class="ruby">      perms[&quot;destroy #{self.class}&quot;] = ability.can?(:destroy, self)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="41">
          <span class="hits">83</span>
          
          <code class="ruby">      perms = perms.merge self.set_create_permissions(self.class.name, ability)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="42">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="91" data-linenumber="43">
          <span class="hits">91</span>
          
          <code class="ruby">    perms.to_json</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="44">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="45">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="46">
          <span class="hits">1</span>
          
          <code class="ruby">  def get_create_permissions</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="47">
          
          
          <code class="ruby">    {</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="48">
          
          
          <code class="ruby">      &#39;Team&#39; =&gt; [Project, Account, TeamUser, User, Contact],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="49">
          
          
          <code class="ruby">      &#39;Account&#39; =&gt; [Media],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="50">
          
          
          <code class="ruby">      &#39;Media&#39; =&gt; [ProjectMedia, Comment, Flag, Status, Tag],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="51">
          
          
          <code class="ruby">      &#39;Project&#39; =&gt; [ProjectSource, Source, Media, ProjectMedia],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="52">
          
          
          <code class="ruby">      &#39;Source&#39; =&gt; [Account, ProjectSource, Project],</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="53">
          
          
          <code class="ruby">      &#39;User&#39; =&gt; [Source, TeamUser, Team, Project]</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="54">
          <span class="hits">83</span>
          
          <code class="ruby">    }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="55">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="56">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="57">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_create_permissions(obj, ability = nil)</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="58">
          <span class="hits">83</span>
          
          <code class="ruby">    create = self.get_create_permissions</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="59">
          <span class="hits">83</span>
          
          <code class="ruby">    perms = Hash.new</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="60">
          <span class="hits">83</span>
          
          <code class="ruby">    unless create[obj].nil?</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="61">
          <span class="hits">61</span>
          
          <code class="ruby">      ability ||= Ability.new(self.current_user, self.context_team)</code>
        </li>
      
        <li class="covered" data-hits="61" data-linenumber="62">
          <span class="hits">61</span>
          
          <code class="ruby">      create[obj].each do |data|</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="63">
          <span class="hits">252</span>
          
          <code class="ruby">        model = data.new</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="64">
          <span class="hits">252</span>
          
          <code class="ruby">        model.current_user = self.current_user</code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="65">
          <span class="hits">252</span>
          
          <code class="ruby">        model.context_team = self.context_team</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="66">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="67">
          <span class="hits">252</span>
          
          <code class="ruby">        if model.respond_to?(:team_id) and self.context_team.present?</code>
        </li>
      
        <li class="covered" data-hits="52" data-linenumber="68">
          <span class="hits">52</span>
          
          <code class="ruby">          model.team_id = self.context_team.id</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="69">
          
          
          <code class="ruby">        end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="70">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="71">
          <span class="hits">252</span>
          
          <code class="ruby">        model = self.set_project_for_permissions(model) if self.respond_to?(:project)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="72">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="252" data-linenumber="73">
          <span class="hits">252</span>
          
          <code class="ruby">        perms[&quot;create #{data}&quot;] = ability.can?(:create, model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="74">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="75">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="83" data-linenumber="76">
          <span class="hits">83</span>
          
          <code class="ruby">    perms</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="77">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="78">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="79">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_project_for_permissions(model)</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="80">
          <span class="hits">140</span>
          
          <code class="ruby">    if self.class.name == &#39;Media&#39;</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="81">
          <span class="hits">140</span>
          
          <code class="ruby">      model = self.set_media_for_permissions(model)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="82">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="83">
          <span class="hits">140</span>
          
          <code class="ruby">    unless self.project.nil?</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="84">
          <span class="hits">140</span>
          
          <code class="ruby">      model.project_id = self.project.id if model.respond_to?(:project_id)</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="85">
          <span class="hits">140</span>
          
          <code class="ruby">      model.context = self.project if model.respond_to?(:context)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="86">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="87">
          <span class="hits">140</span>
          
          <code class="ruby">    model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="88">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="89">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="90">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_media_for_permissions(model)</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="91">
          <span class="hits">140</span>
          
          <code class="ruby">    model.media_id = self.id if model.respond_to?(:media_id)</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="92">
          <span class="hits">140</span>
          
          <code class="ruby">    model.annotated = self if model.respond_to?(:annotated)</code>
        </li>
      
        <li class="covered" data-hits="140" data-linenumber="93">
          <span class="hits">140</span>
          
          <code class="ruby">    model</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="94">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="95">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="96">
          <span class="hits">1</span>
          
          <code class="ruby">  private</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="97">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="98">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_ability</code>
        </li>
      
        <li class="covered" data-hits="16767" data-linenumber="99">
          <span class="hits">16767</span>
          
          <code class="ruby">    unless self.current_user.nil?</code>
        </li>
      
        <li class="covered" data-hits="206" data-linenumber="100">
          <span class="hits">206</span>
          
          <code class="ruby">      ability = Ability.new(self.current_user,  self.context_team)</code>
        </li>
      
        <li class="covered" data-hits="206" data-linenumber="101">
          <span class="hits">206</span>
          
          <code class="ruby">      op = self.new_record? ? :create : :update</code>
        </li>
      
        <li class="covered" data-hits="206" data-linenumber="102">
          <span class="hits">206</span>
          
          <code class="ruby">      raise &quot;No permission to #{op} #{self.class}&quot; unless ability.can?(op, self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="103">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="104">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="105">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="106">
          <span class="hits">1</span>
          
          <code class="ruby">  def check_destroy_ability</code>
        </li>
      
        <li class="covered" data-hits="29" data-linenumber="107">
          <span class="hits">29</span>
          
          <code class="ruby">    unless self.current_user.nil?</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="108">
          <span class="hits">27</span>
          
          <code class="ruby">      ability = Ability.new(self.current_user, self.context_team)</code>
        </li>
      
        <li class="covered" data-hits="27" data-linenumber="109">
          <span class="hits">27</span>
          
          <code class="ruby">      raise &quot;No permission to delete #{self.class}&quot; unless ability.can?(:destroy, self)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="110">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="111">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="112">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="94205aaea0069904f3ccc0d3f0b5cdfc53f3fa28">
  <div class="header">
    <h3>lib/checkdesk_settings.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>18</b> relevant lines. 
      <span class="green"><b>18</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># Check Settings Module</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"># Add to the model: include CheckdeskSettings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="3">
          
          
          <code class="ruby"># It must have a &quot;settings&quot; column already</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby"># Settings have key and value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"># How to get a setting value: object.setting(key)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"># How to set a setting value: object.set_key = value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">module CheckdeskSettings</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">  def self.included(base)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="10">
          <span class="hits">3</span>
          
          <code class="ruby">    base.class_eval do</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="11">
          <span class="hits">3</span>
          
          <code class="ruby">      serialize :settings</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">  def setting(key)</code>
        </li>
      
        <li class="covered" data-hits="3800" data-linenumber="16">
          <span class="hits">3800</span>
          
          <code class="ruby">    self.settings = {} if self.settings.blank?</code>
        </li>
      
        <li class="covered" data-hits="3800" data-linenumber="17">
          <span class="hits">3800</span>
          
          <code class="ruby">    value = self.settings[key.to_s] || self.settings[key.to_sym]</code>
        </li>
      
        <li class="covered" data-hits="3800" data-linenumber="18">
          <span class="hits">3800</span>
          
          <code class="ruby">    unless value.nil?</code>
        </li>
      
        <li class="covered" data-hits="81" data-linenumber="19">
          <span class="hits">81</span>
          
          <code class="ruby">      value.is_a?(Numeric) ? value.to_s : value</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="21">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="23">
          <span class="hits">1</span>
          
          <code class="ruby">  def method_missing(method, *args, &amp;block)</code>
        </li>
      
        <li class="covered" data-hits="3739" data-linenumber="24">
          <span class="hits">3739</span>
          
          <code class="ruby">    match = /^(set|get)_([^=]+)=?$/.match(method)</code>
        </li>
      
        <li class="covered" data-hits="3739" data-linenumber="25">
          <span class="hits">3739</span>
          
          <code class="ruby">    if match.nil?</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="26">
          <span class="hits">3</span>
          
          <code class="ruby">      super</code>
        </li>
      
        <li class="covered" data-hits="3736" data-linenumber="27">
          <span class="hits">3736</span>
          
          <code class="ruby">    elsif match[1] === &#39;set&#39;</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="28">
          <span class="hits">37</span>
          
          <code class="ruby">      self.settings = {} if self.settings.blank?</code>
        </li>
      
        <li class="covered" data-hits="37" data-linenumber="29">
          <span class="hits">37</span>
          
          <code class="ruby">      self.settings[match[2].to_sym] = args.first</code>
        </li>
      
        <li class="covered" data-hits="3699" data-linenumber="30">
          <span class="hits">3699</span>
          
          <code class="ruby">    elsif match[1] === &#39;get&#39;</code>
        </li>
      
        <li class="covered" data-hits="3699" data-linenumber="31">
          <span class="hits">3699</span>
          
          <code class="ruby">      self.setting(match[2])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="34">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="debf438822ec05ab1cfa495e0a9ad2ba633736af">
  <div class="header">
    <h3>lib/elasticsearch_relation.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>15</b> relevant lines. 
      <span class="green"><b>15</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="never" data-hits="" data-linenumber="1">
          
          
          <code class="ruby"># This class tries to reproduce an ActiveRecord relation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">class ElasticsearchRelation</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def initialize(params = {})</code>
        </li>
      
        <li class="covered" data-hits="966" data-linenumber="4">
          <span class="hits">966</span>
          
          <code class="ruby">    @params = { size: 10000 }.merge(params)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">  def offset(x)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    @params[:from] = x</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">  def limit(x)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">    @params[:size] = x</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">    self</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="16">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">  def all</code>
        </li>
      
        <li class="covered" data-hits="1857" data-linenumber="18">
          <span class="hits">1857</span>
          
          <code class="ruby">    Annotation.search(@params).results.map(&amp;:load).reject{ |x| x.nil? }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="19">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="20">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">  def count</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="22">
          <span class="hits">1</span>
          
          <code class="ruby">    Annotation.search(@params).total</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="25">
          <span class="hits">1</span>
          
          <code class="ruby">  def to_a</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="26">
          <span class="hits">1</span>
          
          <code class="ruby">    all</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="5df55892d31f2442e9ab62a4f1675fb46e807bf6">
  <div class="header">
    <h3>lib/error_codes.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>12</b> relevant lines. 
      <span class="green"><b>12</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module LapisConstants</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class ErrorCodes</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    UNAUTHORIZED = 1</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="4">
          <span class="hits">1</span>
          
          <code class="ruby">    MISSING_PARAMETERS = 2</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="5">
          <span class="hits">1</span>
          
          <code class="ruby">    ID_NOT_FOUND = 3</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">    INVALID_VALUE = 4</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">    UNKNOWN = 5</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    AUTH = 6</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="9">
          <span class="hits">1</span>
          
          <code class="ruby">    WARNING = 7</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="10">
          <span class="hits">1</span>
          
          <code class="ruby">    MISSING_OBJECT = 8</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="11">
          <span class="hits">1</span>
          
          <code class="ruby">    DUPLICATED = 9</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    ALL = %w(UNAUTHORIZED MISSING_PARAMETERS ID_NOT_FOUND INVALID_VALUE UNKNOWN AUTH WARNING MISSING_OBJECT DUPLICATED)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="a75ad0f04f8e207e652252e25bb23901ca19da3c">
  <div class="header">
    <h3>lib/included_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>5</b> relevant lines. 
      <span class="green"><b>5</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class IncludedValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="373" data-linenumber="3">
          <span class="hits">373</span>
          
          <code class="ruby">    values = options[:values]</code>
        </li>
      
        <li class="covered" data-hits="373" data-linenumber="4">
          <span class="hits">373</span>
          
          <code class="ruby">    unless values.include?(value) </code>
        </li>
      
        <li class="covered" data-hits="5" data-linenumber="5">
          <span class="hits">5</span>
          
          <code class="ruby">      record.errors[attribute] &lt;&lt; &quot;must be one of: #{values.join(&#39;, &#39;)}&quot;</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="c8de647c1f40167ae57f62658c920c14da08f39d">
  <div class="header">
    <h3>lib/lapis_webhook.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>17</b> relevant lines. 
      <span class="green"><b>17</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module Lapis</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  class Webhook</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">    def initialize(url, payload)</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="4">
          <span class="hits">3</span>
          
          <code class="ruby">      @url = url</code>
        </li>
      
        <li class="covered" data-hits="3" data-linenumber="5">
          <span class="hits">3</span>
          
          <code class="ruby">      @payload = payload</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="6">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="8">
          <span class="hits">1</span>
          
          <code class="ruby">    def notification_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="9">
          <span class="hits">2</span>
          
          <code class="ruby">      &#39;sha1=&#39; + OpenSSL::HMAC.hexdigest(OpenSSL::Digest.new(&#39;sha1&#39;), CONFIG[&#39;secret_token&#39;], payload)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="12">
          <span class="hits">1</span>
          
          <code class="ruby">    def notify</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="13">
          <span class="hits">1</span>
          
          <code class="ruby">      payload = @payload.to_json</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="14">
          <span class="hits">1</span>
          
          <code class="ruby">      uri = URI(@url)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="15">
          <span class="hits">1</span>
          
          <code class="ruby">      http = Net::HTTP.new(uri.host, uri.port)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">      http.use_ssl = uri.scheme == &#39;https&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="17">
          <span class="hits">1</span>
          
          <code class="ruby">      request = Net::HTTP::Post.new(uri.path)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="18">
          <span class="hits">1</span>
          
          <code class="ruby">      request.body = payload</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="19">
          <span class="hits">1</span>
          
          <code class="ruby">      request[&#39;X-Signature&#39;] = notification_signature(payload)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="20">
          <span class="hits">1</span>
          
          <code class="ruby">      request[&#39;Content-Type&#39;] = &#39;application/json&#39;</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="21">
          <span class="hits">1</span>
          
          <code class="ruby">      http.request(request)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="22">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="23">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="24">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="582157495b5e8c8d9770329f955152ad9285292a">
  <div class="header">
    <h3>lib/pender_data.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>23</b> relevant lines. 
      <span class="green"><b>23</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">module PenderData</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="2">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="3">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_pender_result</code>
        </li>
      
        <li class="covered" data-hits="812" data-linenumber="4">
          <span class="hits">812</span>
          
          <code class="ruby">    unless self.url.blank?</code>
        </li>
      
        <li class="covered" data-hits="559" data-linenumber="5">
          <span class="hits">559</span>
          
          <code class="ruby">      result = PenderClient::Request.get_medias(CONFIG[&#39;pender_host&#39;], { url: self.url }, CONFIG[&#39;pender_key&#39;])</code>
        </li>
      
        <li class="covered" data-hits="558" data-linenumber="6">
          <span class="hits">558</span>
          
          <code class="ruby">      if (result[&#39;type&#39;] == &#39;error&#39;)</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="7">
          <span class="hits">1</span>
          
          <code class="ruby">        errors.add(:base, result[&#39;data&#39;][&#39;message&#39;])</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="8">
          
          
          <code class="ruby">      else</code>
        </li>
      
        <li class="covered" data-hits="557" data-linenumber="9">
          <span class="hits">557</span>
          
          <code class="ruby">        self.pender_data= result[&#39;data&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">        # set url with normalized pender URL</code>
        </li>
      
        <li class="covered" data-hits="557" data-linenumber="11">
          <span class="hits">557</span>
          
          <code class="ruby">        self.url = result[&#39;data&#39;][&#39;url&#39;]</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">      end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="16">
          <span class="hits">1</span>
          
          <code class="ruby">  def set_pender_result_as_annotation</code>
        </li>
      
        <li class="covered" data-hits="559" data-linenumber="17">
          <span class="hits">559</span>
          
          <code class="ruby">    unless self.pender_data.nil?</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="18">
          <span class="hits">547</span>
          
          <code class="ruby">      data = self.pender_data</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="19">
          <span class="hits">547</span>
          
          <code class="ruby">      pender = Bot.where(name: &#39;Pender&#39;).last</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="20">
          <span class="hits">547</span>
          
          <code class="ruby">      em = Embed.new</code>
        </li>
      
        <li class="covered" data-hits="1519" data-linenumber="21">
          <span class="hits">1519</span>
          
          <code class="ruby">      self.overriden_embed_attributes.each{|k| em[k.to_s] = data[k.to_s]} if self.respond_to?&#39;overriden_embed_attributes&#39;</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="22">
          <span class="hits">547</span>
          
          <code class="ruby">      em.published_at = data[&#39;published_at&#39;].to_time.to_i unless data[&#39;published_at&#39;].nil?</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="23">
          <span class="hits">547</span>
          
          <code class="ruby">      em.embed = data.to_json</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="24">
          <span class="hits">547</span>
          
          <code class="ruby">      em.annotated = self</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="25">
          <span class="hits">547</span>
          
          <code class="ruby">      em.annotator = pender unless pender.nil?</code>
        </li>
      
        <li class="covered" data-hits="547" data-linenumber="26">
          <span class="hits">547</span>
          
          <code class="ruby">      em.save!</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="27">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="28">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="29">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="30">
          <span class="hits">1</span>
          
          <code class="ruby">  def pender_data</code>
        </li>
      
        <li class="covered" data-hits="3285" data-linenumber="31">
          <span class="hits">3285</span>
          
          <code class="ruby">    @pender_data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="32">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="33">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="34">
          <span class="hits">1</span>
          
          <code class="ruby">  def pender_data=(data)</code>
        </li>
      
        <li class="covered" data-hits="557" data-linenumber="35">
          <span class="hits">557</span>
          
          <code class="ruby">    @pender_data = data</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="36">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="37">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="38">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="1aa5c011ec09e9aa836d38fafb63758aeb8c32f0">
  <div class="header">
    <h3>lib/size_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>7</b> relevant lines. 
      <span class="green"><b>7</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class SizeValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def invalid_size?(w, h)</code>
        </li>
      
        <li class="covered" data-hits="1905" data-linenumber="3">
          <span class="hits">1905</span>
          
          <code class="ruby">    w &lt; 200 || w &gt; 600 || h &lt; 200 || h &gt; 600</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="4">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="5">
          
          
          <code class="ruby"></code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="6">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, value)</code>
        </li>
      
        <li class="covered" data-hits="4144" data-linenumber="7">
          <span class="hits">4144</span>
          
          <code class="ruby">    if !value.nil? &amp;&amp; !value.path.blank?</code>
        </li>
      
        <li class="covered" data-hits="1905" data-linenumber="8">
          <span class="hits">1905</span>
          
          <code class="ruby">      w, h = ::MiniMagick::Image.open(value.path)[:dimensions]</code>
        </li>
      
        <li class="covered" data-hits="1905" data-linenumber="9">
          <span class="hits">1905</span>
          
          <code class="ruby">      record.errors[attribute] &lt;&lt; &quot;must be between 200 x 200 and 600 x 600 pixels&quot; if invalid_size?(w, h)</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="10">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="11">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="12">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
        <div class="source_table" id="9cd5dfed828d46b47f5dd444b1e7a4eae80aa3ed">
  <div class="header">
    <h3>lib/uniqueness_validator.rb</h3>
    <h4><span class="green">100.0 %</span> covered</h4>
    <div>
      <b>11</b> relevant lines. 
      <span class="green"><b>11</b> lines covered</span> and
      <span class="red"><b>0</b> lines missed.</span>
    </div>
  </div>
  
  <pre>
    <ol>
      
        <li class="covered" data-hits="1" data-linenumber="1">
          <span class="hits">1</span>
          
          <code class="ruby">class UniquenessValidator &lt; ActiveModel::EachValidator</code>
        </li>
      
        <li class="covered" data-hits="1" data-linenumber="2">
          <span class="hits">1</span>
          
          <code class="ruby">  def validate_each(record, attribute, _value)</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="3">
          <span class="hits">71</span>
          
          <code class="ruby">    fields = options[:fields] + [attribute]</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="4">
          <span class="hits">71</span>
          
          <code class="ruby">    matches = []</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="5">
          <span class="hits">71</span>
          
          <code class="ruby">    fields.each do |field|</code>
        </li>
      
        <li class="covered" data-hits="355" data-linenumber="6">
          <span class="hits">355</span>
          
          <code class="ruby">      matches &lt;&lt; { match: { field =&gt; record.send(field).to_s } }</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="7">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="covered" data-hits="75" data-linenumber="8">
          <span class="hits">75</span>
          
          <code class="ruby">    existing = record.class.search(query: { bool: { must: matches } }).results.select{ |a| a.send(attribute) === record.send(attribute) }</code>
        </li>
      
        <li class="covered" data-hits="71" data-linenumber="9">
          <span class="hits">71</span>
          
          <code class="ruby">    unless existing.empty?</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="10">
          <span class="hits">2</span>
          
          <code class="ruby">      message = &quot;This #{attribute} already exists&quot;</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="11">
          <span class="hits">2</span>
          
          <code class="ruby">      record.errors[attribute] &lt;&lt; message</code>
        </li>
      
        <li class="covered" data-hits="2" data-linenumber="12">
          <span class="hits">2</span>
          
          <code class="ruby">      raise message</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="13">
          
          
          <code class="ruby">    end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="14">
          
          
          <code class="ruby">  end</code>
        </li>
      
        <li class="never" data-hits="" data-linenumber="15">
          
          
          <code class="ruby">end</code>
        </li>
      
    </ol>
  </pre>
</div>
      
      </div>
    </div>
  </body>
</html>
